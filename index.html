<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="preconnect" href="//cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="//fonts.googleapis.com" crossorigin>
    <meta name="baidu-site-verification" content="codeva-foKWrwyBZw" />
    <meta name="description" content="专业的八字感情方位查询、情侣匹配测试、命理感情年份预测工具，提供精准的命理分析和感情建议。">
    <meta name="keywords" content="八字感情查询,情侣匹配测试,命理感情年份,感情方位查询,八字算命,命理工具">
    <meta name="author" content="命理感情查询工具">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.fatenet.cn">
    

    <meta property="og:title" content="八字感情方位查询_情侣匹配测试_命理感情年份预测工具">
    <meta property="og:description" content="专业的八字感情方位查询、情侣匹配测试、命理感情年份预测工具，提供精准的命理分析和感情建议。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.fatenet.cn">
    <meta property="og:image" content="https://www.fatenet.cn/taiji%20logo.png">
    <meta property="og:site_name" content="命理感情查询工具">
    
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="八字感情方位查询_情侣匹配测试_命理感情年份预测工具">
    <meta name="twitter:description" content="专业的八字感情方位查询、情侣匹配测试、命理感情年份预测工具，提供精准的命理分析和感情建议。">
    <meta name="twitter:image" content="https://www.fatenet.cn/taiji%20logo.png">
    
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"命理感情查询工具","url":"https://www.fatenet.cn","description":"专业的八字感情方位查询、情侣匹配测试、命理感情年份预测工具","potentialAction":{"@type":"SearchAction","target":"https://www.fatenet.cn/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
    
    <title>八字感情方位查询_情侣匹配测试_命理感情年份预测工具</title>
    <link rel="icon" type="image/png" href="taiji logo.png" sizes="32x32">
    <link rel="icon" type="image/png" href="taiji logo.png" sizes="16x16">
    <script src="https://cdn.tailwindcss.com" defer></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入中国风字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet" crossorigin>
    <style>
        /* 白色极简设计风格 */
        /* 基础变量 */
        :root {
            --primary-color: #ffffff;
            --secondary-color: #f8f9fa;
            --accent-color: #333333;
            --gold-accent: #c8a952;
            --text-color: #333333;
            --light-text: #666666;
            --border-color: #e0e0e0;
            --bg-color: #ffffff;
            --card-bg: #ffffff;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --shadow-light: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            min-height: 100vh;
            overflow-x: hidden;
            box-sizing: border-box;

            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        

        html::-webkit-scrollbar,
        body::-webkit-scrollbar {
            display: none !important;
            width: 0 !important;
            height: 0 !important;
        }
        

        @supports not (scrollbar-gutter: stable) {
            body {
                padding-right: calc(100vw - 100%);
            }
        }
        
        /* 淡入动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* 匹配结果样式增强 */
        #match-score h3 {
            text-align: center;
            margin-bottom: 1rem;
        }
        #match-score p {
            line-height: 1.6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Serif SC', 'Ma Shan Zheng', 'ZCOOL XiaoWei', 'PingFang SC', 'Microsoft YaHei', serif;
            line-height: 1.7;
            color: var(--text-color);
            background-color: var(--bg-color);
            min-height: 100vh;
        }
        
        /* 排版样式 */
        h1, h2, h3, h4, h5, h6 {
            margin-bottom: 1rem;
            font-weight: 600;
            line-height: 1.3;
            letter-spacing: -0.025em;
        }
        
        h1 {
            font-size: 1.25rem !important;
            color: var(--text-color) !important;
            text-align: center !important;
            font-weight: 700 !important;
            font-family: 'Noto Serif SC', 'Ma Shan Zheng', 'ZCOOL XiaoWei', 'STZhongsong', 'SimSun', serif !important;
        }
        
        h2 {
            font-size: 1.75rem;
            color: var(--text-color);
            text-align: left;
        }
        
        h3 {
            font-size: 1.25rem;
            color: var(--text-color);
        }
        
        p {
            margin-bottom: 1rem;
            color: var(--light-text);
        }
        
        /* 容器样式 */
        .container {
            max-width: 900px !important;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            width: 100%;
            box-sizing: border-box;
            position: relative;
            display: block;
            clear: both;
        }
        
        /* 页面垂直居中容器 */
        .page-content {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        /* 按钮样式 */
        .btn-primary, .btn-secondary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
            text-decoration: none;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background-color: #444444;
            box-shadow: var(--shadow-medium);
        }
        
        .btn-secondary {
            background-color: transparent;
            color: var(--accent-color);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--secondary-color);
            box-shadow: var(--shadow-light);
        }
        
        /* 标签页样式 */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            padding-bottom: 0;
            width: 100%;
        }
        
        .tab-btn {
            padding: 0.75rem 1.25rem;
            background: transparent;
            border: none;
            color: var(--light-text);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            position: relative;
            transition: all 0.3s ease;
            min-width: auto;
            text-align: center;
            height: 48px;
            box-sizing: border-box;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        
        .tab-btn.active {
            color: var(--text-color);
            font-weight: 500;
            background-color: transparent;
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--accent-color);
            border-radius: 8px 8px 0 0;
        }
        
        .tab-btn:hover:not(.active) {
            color: var(--text-color);
        }
        
        /* 标签页内容样式 */
        .tab-content {
            display: none;
            height: auto;
            min-height: 500px;
            overflow-y: visible;
            /* 确保不显示滚动条 */
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .tab-content::-webkit-scrollbar {
            display: none !important;
            width: 0 !important;
            height: 0 !important;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        /* 卡片样式 */
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow-light);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            transition: box-shadow 0.3s ease;
        }
        
        .card:hover {
            box-shadow: var(--shadow-medium);
        }
        
        /* 表单样式 */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        /* 表单行布局 */
        .form-row {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        /* 保持其他输入元素的原始样式 */
        input[type="text"],
        input[type="number"],
        input[type="date"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 0.75rem 1rem;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.05);
        }
        
        /* 五行和天干地支下拉菜单样式 - 与语言选择菜单风格一致 */
        /* 使用!important确保样式优先级高于Tailwind CSS */
        .form-select,
        select {
            width: 100% !important;
            padding: 0.75rem 1rem !important;
            background-color: white !important;
            border: 1px solid #d1d5db !important;
            border-radius: 6px !important;
            color: #374151 !important;
            font-size: 1rem !important;
            font-weight: 500 !important;
            font-family: inherit !important;
            transition: all 0.2s ease !important;
            box-shadow: none !important;
            position: relative !important;
            appearance: none !important;
            cursor: pointer !important;
            /* 确保下拉箭头正确显示 */
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e") !important;
            background-position: right 0.5rem center !important;
            background-repeat: no-repeat !important;
            background-size: 1.25em 1.25em !important;
            padding-right: 2.5rem !important;
        }
        
        .form-select:focus,
        select:focus {
            outline: none !important;
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2) !important;
        }
        
        .form-select:hover,
        select:hover {
            background-color: #f9fafb !important;
            border-color: #93c5fd !important;
        }
        
        /* 重置select元素的默认样式 */
        select {
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
        }
        
        /* 自定义下拉菜单样式 */
        select::-webkit-scrollbar {
            width: 8px !important;
        }
        
        select::-webkit-scrollbar-track {
            background: #f1f5f9 !important;
            border-radius: 4px !important;
        }
        
        select::-webkit-scrollbar-thumb {
            background: #cbd5e1 !important;
            border-radius: 4px !important;
        }
        
        select::-webkit-scrollbar-thumb:hover {
            background: #94a3b8 !important;
        }
        
        /* 选项样式 */
        select option {
            background-color: white !important;
            color: #1f2937 !important;
            padding: 10px 12px !important;
            font-size: 14px !important;
            line-height: 1.4 !important;
            border: none !important;
        }
        
        select option:hover {
            background-color: #f3f4f6 !important;
        }
        
        select option:checked {
            background-color: #dbeafe !important;
            color: #2563eb !important;
            font-weight: 500 !important;
        }
        
        /* 确保选项列表有足够的高度 */
        select {
            max-height: 300px !important;
        }
        
        /* 单选按钮样式 */
        input[type="radio"] {
            width: 16px;
            height: 16px;
            margin-right: 0.5rem;
            cursor: pointer;
            accent-color: var(--accent-color);
        }
        
        /* 结果展示样式 */
        .result-section {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 2rem;
            padding-bottom: 4rem; /* 增加底部内边距，避免被页脚遮挡 */
            margin-top: 2rem;
            margin-bottom: 3rem; /* 增加底部外边距，确保与页脚有足够距离 */
            border: 1px solid var(--border-color);
            position: relative;
            z-index: 100; /* 确保结果区域在页面上层 */
        }
        
        .result-highlight {
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 3px solid var(--accent-color);
            background-color: var(--primary-color);
        }
        
        .result-highlight h4 {
            color: var(--text-color);
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }
        
        .info-box {
            background-color: var(--primary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.25rem;
            margin-top: 1.5rem;
        }
        
        .info-box h4 {
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }
        
        .info-box p {
            color: var(--light-text);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        /* 加载动画 */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 1rem;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--light-text);
            font-size: 0.95rem;
        }
        
        /* 性别选择样式 */
        .gender-selector {
            display: flex;
            gap: 2rem;
            justify-content: center; /* 水平居中 */
            align-items: center; /* 垂直居中 */
            margin-bottom: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .gender-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 1rem;
            border-radius: 8px;
            position: relative;
            width: 120px;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
        }
        
        .gender-option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-small);
        }
        
        .gender-option span {
            color: var(--text-color);
            font-weight: 500;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }
        
        /* 头像容器样式 */
        .avatar-container {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background-color: var(--bg-color);
        }
        
        .avatar-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* 隐藏单选按钮 */
        .gender-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        
        /* 选中状态 - 实现选中头像略大、加浅背景和选中边框 */
        .gender-option input[type="radio"]:checked + .avatar-container {
            width: 85px;
            height: 85px;
            background-color: rgba(255, 140, 0, 0.1); /* 浅橙色背景 */
            border: 3px solid var(--accent-color); /* 选中边框 */
        }
        
        .gender-option input[type="radio"]:checked ~ span {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        /* 选中状态的整体样式 */
        .gender-option input[type="radio"]:checked {
            background-color: rgba(255, 140, 0, 0.05);
        }
        
        /* 通过JavaScript添加选中样式，而不是使用:has()选择器 */
        
        /* 隐藏元素 */
        .hidden {
            display: none !important;
        }
        
        /* 错误输入框样式 */
        .error-input {
            border: 2px solid #ff0000 !important;
            background-color: #fff0f0 !important;
        }
        
        /* 错误柱子容器样式 */
        .error-pillar {
            border: 2px solid #ff0000;
            background-color: #fff0f0;
            border-radius: 4px;
            padding: 5px;
        }
        
        /* 响应式设计 */
        /* 响应式设计 - 移动端优化 */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem 1rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .card,
            .result-section {
                padding: 1.5rem;
            }
            
            .btn-primary,
            .btn-secondary {
                width: 100%;
                margin-bottom: 0.75rem;
            }
            
            .gender-selector {
                flex-direction: column;
                gap: 1rem;
                justify-content: center; /* 水平居中 */
                align-items: center; /* 垂直居中 */
                width: 100%; /* 确保占满容器宽度 */
            }
            
            /* 确保性别选择器的父容器也支持居中 */
            .form-group:has(.gender-selector) {
                display: flex;
                justify-content: center;
                align-items: center;
                width: 100%;
            }
            
            .tabs {
                flex-direction: column;
                gap: 0.5rem;
                padding: 8px;
                overflow-x: auto;
            }
            
            .tab-btn {
                text-align: center;
                width: 100%;
                min-width: auto;
                padding: 0.8rem 1rem;
                font-size: 0.95rem;
            }
        }
        
        /* 页面头部样式 */
        .page-header {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem 0;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .page-header h1 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
            font-family: 'Noto Serif SC', 'Ma Shan Zheng', 'ZCOOL QingKe HuangYou', 'SimSun', serif;
            white-space: nowrap;
        }
        
        .page-header p {
            color: var(--light-text);
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* 移除标题下方线段 */
        .page-header::after {
            content: none;
        }
        
        /* 网格布局 */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        /* 响应式设计 - 平板及以上优化 */
        @media (min-width: 768px) {
            .grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* 间距工具类 */
        .mt-4 { margin-top: 1.5rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .gap-4 { gap: 1rem; }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .header-logo {
            height: 48px;
            width: 48px;
            object-fit: contain;
            display: block;
            transform: none;
        }
        
        /* h1样式 - 确保标题样式正确 */
        h1 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
            font-family: 'Noto Serif SC', 'Ma Shan Zheng', 'ZCOOL QingKe HuangYou', 'SimSun', serif;
            white-space: nowrap;
        }
        
        /* 动画 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* 页脚样式 */
        footer {
            text-align: center;
            padding: 2rem;
            margin-top: 4rem;
            border-top: 1px solid var(--border-color);
            color: var(--light-text);
            font-size: 0.9rem;
        }
        
        footer p {
            margin-bottom: 0.5rem;
        }
        
        footer p:last-child {
            margin-bottom: 0;
        }
        
        /* 标题下方线段通过.page-header::after伪元素实现 */
    </style>
</head>
<body>
    <div class="container">
        <!-- 语言切换按钮 - 右对齐 -->
        <div id="language-switcher" class="absolute right-4 top-4 z-50">
            <div class="language-dropdown relative">
                <button id="language-dropdown-btn" class="language-btn px-3 py-1.5 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-center focus:outline-none" style="font-size: 12px;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 transition-transform duration-300 transform group-hover:rotate-12">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                        <path d="M2 12h20"></path>
                    </svg>
                    <span id="current-language-text">中文</span>
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300 transform group-hover:rotate-180">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                <div id="language-dropdown-menu" class="language-dropdown-menu absolute right-0 mt-1 w-48 bg-white rounded-lg shadow-lg transform scale-95 opacity-0 pointer-events-none transition-all duration-200 z-50">
                    <button data-lang="zh-CN" class="language-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200 flex items-center">
                        <span class="w-6 h-6 mr-3 flex items-center justify-center font-semibold">中</span>
                        中文
                    </button>
                    <button data-lang="en-US" class="language-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200 flex items-center">
                        <span class="w-6 h-6 mr-3 flex items-center justify-center font-semibold">EN</span>
                        English
                    </button>
                    <button data-lang="ja-JP" class="language-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200 flex items-center">
                        <span class="w-6 h-6 mr-3 flex items-center justify-center font-semibold">日</span>
                        日本語
                    </button>
                    <button data-lang="ko-KR" class="language-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200 flex items-center">
                        <span class="w-6 h-6 mr-3 flex items-center justify-center font-semibold">한</span>
                        한국어
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 页面标题 -->
        <header class="page-header">
            <div class="header-content">
                <img src="taiji logo.png" alt="命理工具Logo" class="header-logo" loading="lazy">
                <h1 data-translate="title">命理感情查询工具</h1>
            </div>
        </header>
        
        <style>
            /* 语言切换下拉菜单样式 */
            .language-dropdown {
                position: relative;
                display: inline-block;
            }
            
            /* 按钮悬停效果 - 地球图标旋转 */
            .language-dropdown:hover .language-btn svg:first-child {
                transform: rotate(12deg);
                transition: transform 0.3s ease;
            }
            
            /* 下拉箭头旋转动画 */
            .language-dropdown:hover .language-btn svg:last-child {
                transform: rotate(180deg);
                transition: transform 0.3s ease;
            }
            
            /* 下拉菜单基础样式 */
            .language-dropdown-menu {
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                overflow: hidden;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            }
            
            /* 显示状态的下拉菜单 */
            .language-dropdown-menu.show {
                opacity: 1;
                transform: scale(1) translateY(0);
                pointer-events: auto;
                top: calc(100% + 6px);
            }
            
            /* 激活状态的语言选项 */
            .language-dropdown-menu button.active {
                background-color: #e6f0ff;
                color: #4a90e2;
                font-weight: 600;
            }
            
            /* 悬停效果 */
            .language-dropdown-menu button:hover:not(.active) {
                background-color: #f0f4f8;
                transform: translateX(2px);
                transition: all 0.2s ease;
            }
            
            /* 点击反馈效果 */
            .language-dropdown-menu button:active {
                transform: scale(0.98);
            }
            
            /* 五行下拉菜单样式 */
            .element-dropdown {
                position: relative;
                width: 100%;
            }
            
            .element-btn {
                border: 1px solid #d1d5db;
                border-radius: 6px;
                background-color: white;
                color: #374151;
                font-weight: 500;
                transition: all 0.2s ease;
                box-shadow: none;
                padding: 0.75rem 1rem;
                font-size: 1rem;
                font-family: inherit;
                display: flex;
                align-items: center;
                justify-content: space-between;
                width: 100%;
                cursor: pointer;
            }
            
            .element-btn:hover {
                background-color: #f9fafb;
                border-color: #93c5fd;
            }
            
            .element-btn:focus {
                outline: none;
                border-color: #3b82f6;
                box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
            }
            
            .element-dropdown:hover .element-btn svg {
                transform: rotate(180deg);
                transition: transform 0.3s ease;
            }
            
            .element-dropdown-menu {
                border: 1px solid #d1d5db;
                border-radius: 6px;
                overflow: visible !important;
                height: auto;
                min-height: auto;
                max-height: 250px;
                overflow-y: auto;
                transition: opacity 0.2s ease;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                /* 确保内容完全可见 */
                white-space: nowrap;
                /* 添加默认定位 */
                position: absolute;
                left: 0;
                right: 0;
                width: 100%;
                opacity: 0;
                pointer-events: none;
                z-index: 9999;
                background-color: white;
            }
            
            /* 自定义滚动条 */
            .element-dropdown-menu::-webkit-scrollbar {
                width: 8px;
            }
            
            .element-dropdown-menu::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 4px;
            }
            
            .element-dropdown-menu::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 4px;
            }
            
            .element-dropdown-menu::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
            }
            
            /* 五行下拉菜单按钮基本样式 */
            .element-dropdown-menu button {
                display: block;
                width: 100%;
                padding: 10px 12px;
                border: none;
                background: none;
                text-align: left;
                cursor: pointer;
                font-size: 14px;
                line-height: 1.4;
                transition: all 0.2s ease;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                color: #1f2937;
            }
            
            .element-dropdown-menu.show {
                opacity: 1;
                pointer-events: auto;
                margin-top: 2px;
            }
            
            /* 默认显示在下方 */
            .element-dropdown-menu.show.bottom {
                top: 100%;
            }
            
            /* 空间不足时显示在上方 */
            .element-dropdown-menu.show.top {
                bottom: 100%;
                top: auto;
                margin-bottom: 2px;
            }
            
            .element-dropdown-menu button.active {
                background-color: #dbeafe;
                color: #2563eb;
                font-weight: 500;
            }
            
            .element-dropdown-menu button:hover:not(.active) {
                background-color: #f3f4f6;
            }
            
            .element-dropdown-menu button:active {
                transform: none;
            }
            
            /* 微动画效果类 */
            .scale-95 {
                transform: scale(0.95) !important;
            }
            
            .scale-98 {
                transform: scale(0.98);
            }
            
            /* 语言切换页面过渡效果 */
            .language-transition {
                transition: opacity 0.3s ease-in-out;
            }
            
            /* 语言选项前缀标识 - 使用国旗图标 */
            .language-option .w-6 {
                border-radius: 4px;
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: #f3f4f6;
                font-size: 10px;
                transition: all 0.2s ease;
            }
            
            .language-option:hover .w-6 {
                background-color: #e5e7eb;
                transform: scale(1.1);
            }
            
            .language-option.active .w-6 {
                background-color: #4a90e2;
                color: white;
            }
            
            /* 响应式设计 - 移动端优化 */
            @media (max-width: var(--breakpoint-md)) {
                .language-dropdown-menu {
                    width: 100%;
                    max-width: 280px;
                    left: 50%;
                    right: auto;
                    transform: translateX(-50%) scale(0.95) translateY(-10px);
                    opacity: 0;
                    pointer-events: none;
                }
                
                .language-dropdown-menu.show {
                    transform: translateX(-50%) scale(1) translateY(0);
                    opacity: 1;
                    pointer-events: auto;
                }
                
                /* 小屏幕按钮尺寸优化 */
                #language-dropdown-btn {
                    padding: 9px 15px;
                    font-size: 14px;
                }
                
                /* 小屏幕语言选项间距优化 */
                .language-option {
                    padding: 8px 12px !important;
                }
            }
            
            /* 大屏幕体验增强 */
            @media (min-width: 992px) {
                .language-dropdown-menu {
                    min-width: 200px;
                }
                
                .language-option {
                    padding: 10px 16px !important;
                }
            }
        </style>
        
        <!-- 标签页导航 -->
        <div class="tabs">
            <button class="tab-btn active" data-target="position" data-translate="tabPosition">感情方位查询</button>
            <button class="tab-btn" data-target="location-match" data-translate="tabLocationMatch">情侣方位匹配</button>
            <button class="tab-btn" data-target="timing" data-translate="tabTiming">感情年份预测</button>
        </div>
        
        <!-- 主要内容区域 -->
        <main>
            <!-- 感情方位查询模块 -->
        <div class="tab-content active" id="position">
            <div class="card">
                
                <div class="form-group">
                    <label class="form-label" data-translate="genderSelect">性别选择</label>
                    <div class="gender-selector">
                        <label class="gender-option">
                            <input type="radio" name="position-gender" value="male" checked>
                            <div class="avatar-container">
                                <img src="male_avatar.png" alt="男性" loading="lazy">
                            </div>
                            <span data-translate="male">男</span>
                        </label>
                        <label class="gender-option">
                            <input type="radio" name="position-gender" value="female">
                            <div class="avatar-container">
                                <img src="female_avatar.png" alt="女性" loading="lazy">
                            </div>
                            <span data-translate="female">女</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="position-day-master-element-btn" class="form-label" data-translate="dayMasterElement">日主五行</label>
                    <div class="element-dropdown relative">
                        <button id="position-day-master-element-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                            <span id="position-day-master-element-text" data-translate="wood">木</span>
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                        <div id="position-day-master-element-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb overflow-visible">
                            <button data-value="wood" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200" data-translate="wood">
                                木
                            </button>
                            <button data-value="fire" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="fire">
                                火
                            </button>
                            <button data-value="earth" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="earth">
                                土
                            </button>
                            <button data-value="metal" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="metal">
                                金
                            </button>
                            <button data-value="water" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="water">
                                水
                            </button>
                        </div>
                    </div>
                    <!-- 隐藏的input用于存储选中的值 -->
                    <input type="hidden" id="position-day-master-element" value="wood">
                </div>
                
                <div class="mt-4">
                    <button id="calculate-position-btn" class="btn-primary" data-translate="queryPosition">查询方位</button>
                </div>
            </div>
            
            <!-- 感情方位结果 -->
            <div id="position-result" class="result-section hidden">
                <div id="position-loading" class="loading-container">
                    <div class="loading-spinner"></div>
                    <p class="loading-text" data-translate="calculatingPosition">正在计算您的感情方位...</p>
                </div>
                <div id="position-content" class="hidden">
                    <div id="position-direction" class="result-highlight"></div>
                    <div id="position-explanation"></div>
                    <div class="info-box">
                        <h4 data-translate="warmTip">温馨提示</h4>
                        <p data-translate="positionTip">方位预测仅供参考，感情需要珍惜和经营。遇到合适的感情时，建议保持积极开放的心态。</p>
                    </div>
                </div>
            </div>
        </div>
            
            <!-- 情侣方位匹配模块 -->
            <div class="tab-content" id="location-match">
                <div class="card">
                    
                    <div class="form-group">
                        <div class="gender-selector">
                            <label class="gender-option">
                                <input type="radio" name="my-gender" value="male" checked>
                                <div class="avatar-container">
                                    <img src="male_avatar.png" alt="男性" loading="lazy">
                                </div>
                                <span data-translate="male">男</span>
                            </label>
                            <label class="gender-option">
                                <input type="radio" name="my-gender" value="female">
                                <div class="avatar-container">
                                    <img src="female_avatar.png" alt="女性" loading="lazy">
                                </div>
                                <span data-translate="female">女</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="my-location" class="form-label" data-translate="birthPlace">出生地</label>
                            <input type="text" id="my-location" class="form-input" data-translate-placeholder="birthPlacePlaceholder" placeholder="请输入您的出生地（如：荆州）">
                        </div>
                        
                        <div class="form-group">
                            <label for="my-element-btn" class="form-label" data-translate="dayMasterElement">日主五行</label>
                            <div class="element-dropdown relative">
                                <button id="my-element-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                    <span id="my-element-text" data-translate="wood">木</span>
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                                <div id="my-element-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                    <button data-value="wood" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200" data-translate="wood">
                                        木
                                    </button>
                                    <button data-value="fire" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="fire">
                                        火
                                    </button>
                                    <button data-value="earth" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="earth">
                                        土
                                    </button>
                                    <button data-value="metal" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="metal">
                                        金
                                    </button>
                                    <button data-value="water" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="water">
                                        水
                                    </button>
                                </div>
                            </div>
                            <!-- 隐藏的input用于存储选中的值 -->
                            <input type="hidden" id="my-element" value="wood">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="gender-selector">
                            <label class="gender-option">
                                <input type="radio" name="partner-gender" value="male">
                                <div class="avatar-container">
                                    <img src="male_avatar.png" alt="男性" loading="lazy">
                                </div>
                                <span data-translate="male">男</span>
                            </label>
                            <label class="gender-option">
                                <input type="radio" name="partner-gender" value="female" checked>
                                <div class="avatar-container">
                                    <img src="female_avatar.png" alt="女性" loading="lazy">
                                </div>
                                <span data-translate="female">女</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="partner-location" class="form-label" data-translate="birthPlace">出生地</label>
                            <input type="text" id="partner-location" class="form-input" data-translate-placeholder="partnerBirthPlacePlaceholder" placeholder="请输入对方的出生地（如：菏泽）">
                        </div>
                        
                        <div class="form-group">
                            <label for="partner-element-btn" class="form-label" data-translate="dayMasterElement">日主五行</label>
                            <div class="element-dropdown relative">
                                <button id="partner-element-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                    <span id="partner-element-text" data-translate="wood">木</span>
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </button>
                                <div id="partner-element-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                    <button data-value="wood" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200" data-translate="wood">
                                        木
                                    </button>
                                    <button data-value="fire" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="fire">
                                        火
                                    </button>
                                    <button data-value="earth" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="earth">
                                        土
                                    </button>
                                    <button data-value="metal" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="metal">
                                        金
                                    </button>
                                    <button data-value="water" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200" data-translate="water">
                                        水
                                    </button>
                                </div>
                            </div>
                            <!-- 隐藏的input用于存储选中的值 -->
                            <input type="hidden" id="partner-element" value="wood">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button id="match-location-btn" class="btn-primary" data-translate="matchTest">匹配测试</button>
                    </div>
                </div>
                
                <!-- 情侣方位匹配结果 -->
                <div id="location-match-result" class="result-section hidden border-2 border-dashed rounded-xl p-6 bg-gradient-to-br from-white to-gray-50 shadow-lg">
                    <div id="match-loading" class="loading-container">
                        <div class="loading-spinner"></div>
                        <p class="loading-text" data-translate="calculatingMatch">正在计算匹配度...</p>
                    </div>
                    <div id="match-content" class="hidden animate-fadeIn">
                        <div id="match-score" class="mb-4"></div>
                        <div id="match-explanation" class="mb-4"></div>
                        <div class="info-box">
                            <h4 data-translate="warmTip">温馨提示</h4>
                            <p data-translate="matchTip">匹配测试仅供参考，真正的感情需要双方共同经营和珍惜。</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 感情年份预测模块 -->
            <div class="tab-content" id="timing">
                <div class="card">
                    
                    <div class="form-group">
                        <label class="form-label" data-translate="genderSelect">性别选择</label>
                        <div class="gender-selector">
                        <label class="gender-option">
                            <input type="radio" name="timing-gender" value="male" checked>
                            <div class="avatar-container">
                                <img src="male_avatar.png" alt="男性" loading="lazy">
                            </div>
                            <span data-translate="male">男</span>
                        </label>
                        <label class="gender-option">
                            <input type="radio" name="timing-gender" value="female">
                            <div class="avatar-container">
                                <img src="female_avatar.png" alt="女性" loading="lazy">
                            </div>
                            <span data-translate="female">女</span>
                        </label>
                    </div>
                    </div>
                
                    <h4 class="text-lg font-semibold mb-3" data-translate="baZiInfoTitle">八字信息输入</h4>
                    
                    <div class="grid grid-cols-4 gap-4 mb-3">
                        <div class="text-center">年柱</div>
                        <div class="text-center">月柱</div>
                        <div class="text-center">日柱</div>
                        <div class="text-center">时柱</div>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-4 mb-3">
                        <!-- 年干自定义下拉菜单 -->
                        <div class="element-dropdown relative">
                            <button id="year-stem-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                <span id="year-stem-text">甲</span>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div id="year-stem-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                <button data-value="jia" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200">甲</button>
                                <button data-value="yi" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">乙</button>
                                <button data-value="bing" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丙</button>
                                <button data-value="ding" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丁</button>
                                <button data-value="wu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">戊</button>
                                <button data-value="ji" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">己</button>
                                <button data-value="geng" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">庚</button>
                                <button data-value="xin" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">辛</button>
                                <button data-value="ren" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">壬</button>
                                <button data-value="gui" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">癸</button>
                            </div>
                            <input type="hidden" id="year-stem" value="jia">
                        </div>
                        
                        <!-- 月干自定义下拉菜单 -->
                        <div class="element-dropdown relative">
                            <button id="month-stem-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                <span id="month-stem-text">甲</span>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div id="month-stem-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                <button data-value="jia" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200">甲</button>
                                <button data-value="yi" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">乙</button>
                                <button data-value="bing" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丙</button>
                                <button data-value="ding" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丁</button>
                                <button data-value="wu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">戊</button>
                                <button data-value="ji" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">己</button>
                                <button data-value="geng" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">庚</button>
                                <button data-value="xin" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">辛</button>
                                <button data-value="ren" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">壬</button>
                                <button data-value="gui" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">癸</button>
                            </div>
                            <input type="hidden" id="month-stem" value="jia">
                        </div>
                        
                        <!-- 日干自定义下拉菜单 -->
                        <div class="element-dropdown relative">
                            <button id="day-stem-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                <span id="day-stem-text">甲</span>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div id="day-stem-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                <button data-value="jia" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200">甲</button>
                                <button data-value="yi" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">乙</button>
                                <button data-value="bing" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丙</button>
                                <button data-value="ding" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丁</button>
                                <button data-value="wu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">戊</button>
                                <button data-value="ji" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">己</button>
                                <button data-value="geng" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">庚</button>
                                <button data-value="xin" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">辛</button>
                                <button data-value="ren" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">壬</button>
                                <button data-value="gui" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">癸</button>
                            </div>
                            <input type="hidden" id="day-stem" value="jia">
                        </div>
                        
                        <!-- 时干自定义下拉菜单 -->
                        <div class="element-dropdown relative">
                            <button id="hour-stem-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                <span id="hour-stem-text">甲</span>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div id="hour-stem-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                <button data-value="jia" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200">甲</button>
                                <button data-value="yi" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">乙</button>
                                <button data-value="bing" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丙</button>
                                <button data-value="ding" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丁</button>
                                <button data-value="wu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">戊</button>
                                <button data-value="ji" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">己</button>
                                <button data-value="geng" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">庚</button>
                                <button data-value="xin" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">辛</button>
                                <button data-value="ren" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">壬</button>
                                <button data-value="gui" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">癸</button>
                            </div>
                            <input type="hidden" id="hour-stem" value="jia">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-4">
                        <!-- 年支自定义下拉菜单 -->
                        <div class="element-dropdown relative">
                            <button id="year-branch-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                <span id="year-branch-text">子</span>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div id="year-branch-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                <button data-value="zi" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200">子</button>
                                <button data-value="chou" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丑</button>
                                <button data-value="yin" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">寅</button>
                                <button data-value="mao" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">卯</button>
                                <button data-value="chen" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">辰</button>
                                <button data-value="si" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">巳</button>
                                <button data-value="wu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">午</button>
                                <button data-value="wei" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">未</button>
                                <button data-value="shen" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">申</button>
                                <button data-value="you" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">酉</button>
                                <button data-value="xu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">戌</button>
                                <button data-value="hai" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">亥</button>
                            </div>
                            <input type="hidden" id="year-branch" value="zi">
                        </div>
                        
                        <!-- 月支自定义下拉菜单 -->
                        <div class="element-dropdown relative">
                            <button id="month-branch-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                <span id="month-branch-text">子</span>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div id="month-branch-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                <button data-value="zi" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200">子</button>
                                <button data-value="chou" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丑</button>
                                <button data-value="yin" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">寅</button>
                                <button data-value="mao" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">卯</button>
                                <button data-value="chen" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">辰</button>
                                <button data-value="si" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">巳</button>
                                <button data-value="wu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">午</button>
                                <button data-value="wei" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">未</button>
                                <button data-value="shen" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">申</button>
                                <button data-value="you" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">酉</button>
                                <button data-value="xu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">戌</button>
                                <button data-value="hai" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">亥</button>
                            </div>
                            <input type="hidden" id="month-branch" value="zi">
                        </div>
                        
                        <!-- 日支自定义下拉菜单 -->
                        <div class="element-dropdown relative">
                            <button id="day-branch-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                <span id="day-branch-text">子</span>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div id="day-branch-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                <button data-value="zi" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200">子</button>
                                <button data-value="chou" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丑</button>
                                <button data-value="yin" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">寅</button>
                                <button data-value="mao" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">卯</button>
                                <button data-value="chen" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">辰</button>
                                <button data-value="si" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">巳</button>
                                <button data-value="wu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">午</button>
                                <button data-value="wei" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">未</button>
                                <button data-value="shen" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">申</button>
                                <button data-value="you" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">酉</button>
                                <button data-value="xu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">戌</button>
                                <button data-value="hai" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">亥</button>
                            </div>
                            <input type="hidden" id="day-branch" value="zi">
                        </div>
                        
                        <!-- 时支自定义下拉菜单 -->
                        <div class="element-dropdown relative">
                            <button id="hour-branch-btn" class="element-btn px-3 py-2 rounded-lg bg-white text-black font-medium hover:bg-gray-100 transition-all duration-300 flex items-center justify-between w-full border border-gray-200">
                                <span id="hour-branch-text">子</span>
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 transition-transform duration-300">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div id="hour-branch-menu" class="element-dropdown-menu absolute left-0 mt-1 w-full bg-white rounded-lg shadow-lg opacity-0 pointer-events-none transition-all duration-200 z-50 border border-e5e7eb">
                                <button data-value="zi" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 active transition-colors duration-200">子</button>
                                <button data-value="chou" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">丑</button>
                                <button data-value="yin" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">寅</button>
                                <button data-value="mao" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">卯</button>
                                <button data-value="chen" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">辰</button>
                                <button data-value="si" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">巳</button>
                                <button data-value="wu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">午</button>
                                <button data-value="wei" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">未</button>
                                <button data-value="shen" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">申</button>
                                <button data-value="you" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">酉</button>
                                <button data-value="xu" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">戌</button>
                                <button data-value="hai" class="element-option w-full text-left px-4 py-3 hover:bg-gray-100 transition-colors duration-200">亥</button>
                            </div>
                            <input type="hidden" id="hour-branch" value="zi">
                        </div>
                    </div>
                
                    <!-- 新增：八字查询结果显示区域 -->
                    <div id="ba-zi-info" class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <h4 class="text-lg font-semibold mb-2" data-translate="baZiInfoTitle">八字信息查询结果</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p><strong data-translate="gregorianBirthday">公历生日</strong><span id="gregorian-birthday">-</span></p>
                                <p><strong data-translate="lunarBirthday">阴历生日</strong><span id="lunar-birthday">-</span></p>
                            </div>
                            <div>
                                <p><strong data-translate="zodiac">生肖</strong><span id="zodiac">-</span></p>
                                <p><strong data-translate="age">岁数</strong><span id="age">-</span></p>
                            </div>
                        </div>
                    </div>
                
                    <div class="mt-4">
                        <button id="query-btn" class="btn-primary" data-translate="queryTiming">查询感情年份</button>
                        <button id="reset-btn" class="btn-secondary" style="display: none;" data-translate="reset">重置</button>
                    </div>
                </div>
                
                <div id="result-area" class="result-section hidden">
                    
                    <div id="loading" class="loading-container">
                        <div class="loading-spinner"></div>
                        <p class="loading-text" data-translate="calculatingTiming">正在分析您的命理信息，请稍候...</p>
                    </div>
                    
                    <div id="result-content" class="hidden">
                        <div id="result-timing" class="mb-4"></div>
                        <div class="info-box">
                            <h4 data-translate="detailedExplanation">详细解读</h4>
                            <div id="result-explanation"></div>
                        </div>
                    </div>
                </div>
        </main>
        
        <!-- 页脚移至页面底部 -->
    </div>
    
    <script>
        // 多语言翻译数据结构
        const translations = {
            'zh-CN': {
                // 页面标题和标签页
                'title': '命理感情查询工具',
                'tabPosition': '感情方位查询',
                'tabLocationMatch': '情侣方位匹配',
                'tabTiming': '感情年份预测',
                
                // 通用状态文本
                'loading': '正在加载...',
                'error': '发生错误，请稍后再试',
                'success': '操作成功',
                'noResult': '暂无结果',
                
                // 感情方位查询
                'genderSelect': '性别选择',
                'male': '男',
                'female': '女',
                'dayMasterElement': '日主五行',
                'wood': '木',
                'fire': '火',
                'earth': '土',
                'metal': '金',
                'water': '水',
                'queryPosition': '查询方位',
                'reset': '重置',
                'calculatingPosition': '正在计算您的感情方位...',
                'positionResultTitle': '您的感情方位',
                'warmTip': '温馨提示',
                'positionTip': '方位预测仅供参考，感情需要珍惜和经营。遇到合适的感情时，建议保持积极开放的心态。',
                'timingTip': '年份预测仅供参考，感情到来需要天时地利人和。保持良好心态，机遇总是垂青有准备的人。',
                
                // 方位翻译
                'east': '东方',
                'south': '南方',
                'west': '西方',
                'north': '北方',
                'local': '本地',
                
                // 感情方位解释模板
                'malePositionExplanation': '根据您的命理分析，您是{dayMasterElement}日主{gender}命。男命以克者为妻，{dayMasterElement}克{soulmateElement}，因此您的感情方位为<strong>{directions}</strong>方向。建议您在日常生活、工作或社交中，可以多关注来自这些方向的人或事物。',
                'femalePositionExplanation': '根据您的命理分析，您是{dayMasterElement}日主{gender}命。女命以被克者为夫，{soulmateElement}克{dayMasterElement}，因此您的感情方位为<strong>{directions}</strong>方向。在选择居住环境、工作地点或社交场合时，可以适当考虑这些方位。',
                
                // 情侣方位匹配
                'myGender': '我的性别',
                'partnerGender': '对方性别',
                'birthPlace': '出生地',
                'birthPlacePlaceholder': '请输入您的出生地（如：荆州）',
                'partnerBirthPlacePlaceholder': '请输入对方的出生地（如：菏泽）',
                'matchTest': '匹配测试',
                'calculatingMatch': '正在计算匹配度...',
                'matchTip': '匹配测试仅供参考，真正的感情需要双方共同经营和珍惜。',
                
                // 感情年份预测
                'dayMasterStem': '日主天干',
                'dayBranch': '日支 (夫妻宫)',
                'queryTiming': '查询感情年份',
                'calculatingTiming': '正在分析您的命理信息，请稍候...',
                'detailedExplanation': '详细解读',
                'baZiInfoTitle': '八字信息查询结果',
                'gregorianBirthday': '公历生日：',
                'lunarBirthday': '阴历生日：',
                'zodiac': '生肖：',
                'age': '岁数：',
                
                // 天干地支（这些通常不翻译，保持原样）
                'jia': '甲', 'yi': '乙', 'bing': '丙', 'ding': '丁', 'wu': '戊', 
                'ji': '己', 'geng': '庚', 'xin': '辛', 'ren': '壬', 'gui': '癸',
                'zi': '子', 'chou': '丑', 'yin': '寅', 'mao': '卯', 'chen': '辰', 
                'si': '巳', 'wu': '午', 'wei': '未', 'shen': '申', 'you': '酉', 
                'xu': '戌', 'hai': '亥',
                
                // 结果文本模板
                'positionTemplate': '您的感情方位主要在{direction}方。',
                'positionExplanationTemplate': '根据您的日主五行为{element}，您在地支{branch}方位的异性感情较为旺盛。在这个方位工作、学习或参加社交活动，遇到合适对象的概率会更高。',
                'matchScoreTemplate': '匹配度评分：<strong>{score}分</strong>',
                'matchExplanationTemplate': '{explanation}',
                'timingResultTemplate': '您在{years}年遇到感情的概率最高。',
                'timingExplanationTemplate': '{explanation}',
                // 感情年份预测额外需要的翻译
                'year': '年',
                'probability': '概率',
                'soulmateYear': '感情年份',
                'interpretationIntro': '根据您的命理分析，以下',
                'soulmateYears': '年为您的感情年份',
                'noSoulmateYears': '没有',
                'noSoulmateInterpretation': '没有',
                'interpretationSuggestion': '建议',
                'noSoulmateSuggestion': '保持开放心态，多参加社交活动，感情可能在不经意间出现。',
                'emotionAppear': '感情出现',
                // 页脚翻译
                'footerCopyright': '© 2024 命理感情查询工具',
                'footerDisclaimer': '本工具仅供参考，命运掌握在自己手中'
            },
            'en-US': {
                // 页面标题和标签页
                'title': 'Destiny Matchmaking Tool',
                'tabPosition': 'Destiny Direction',
                'tabLocationMatch': 'Couple Location Match',
                'tabTiming': 'Destiny Year Prediction',
                
                // 通用状态文本
                'loading': 'Loading...',
                'error': 'An error occurred, please try again later',
                'success': 'Operation successful',
                'noResult': 'No results found',
                
                // 感情方位查询
                'genderSelect': 'Gender',
                'male': 'Male',
                'female': 'Female',
                'dayMasterElement': 'Day Master Element',
                'wood': 'Wood',
                'fire': 'Fire',
                'earth': 'Earth',
                'metal': 'Metal',
                'water': 'Water',
                'queryPosition': 'Query Direction',
                'reset': 'Reset',
                'calculatingPosition': 'Calculating your destiny direction...',
                'positionResultTitle': 'Your Destiny Direction',
                'warmTip': 'Warm Reminder',
                'positionTip': 'Direction prediction is for reference only. Fate needs to be cherished and managed. When you encounter a suitable connection, it is recommended to maintain a positive and open attitude.',
                'timingTip': 'Year prediction is for reference only. The arrival of destiny requires favorable timing, geographical conditions, and human harmony. Maintain a positive mindset, as opportunities always favor those who are prepared.',
                
                // 方位翻译
                'east': 'East',
                'south': 'South',
                'west': 'West',
                'north': 'North',
                'local': 'Local',
                
                // 感情方位解释模板
                'malePositionExplanation': 'Based on your destiny analysis, you are a {dayMasterElement} Day Master {gender} destiny. For male destiny, the wife is the one being conquered. {dayMasterElement} conquers {soulmateElement}, so your emotional direction is <strong>{directions}</strong>. It is recommended that you pay more attention to people or things from these directions in your daily life, work, or social interactions.',
                'femalePositionExplanation': 'Based on your destiny analysis, you are a {dayMasterElement} Day Master {gender} destiny. For female destiny, the husband is the one who conquers. {soulmateElement} conquers {dayMasterElement}, so your emotional direction is <strong>{directions}</strong>. You can appropriately consider these directions when choosing a living environment, workplace, or social occasions.',
                
                // 情侣方位匹配
                'myGender': 'My Gender',
                'partnerGender': 'Partner\'s Gender',
                'birthPlace': 'Birth Place',
                'birthPlacePlaceholder': 'Please enter your birth place (e.g., Jingzhou)',
                'partnerBirthPlacePlaceholder': 'Please enter your partner\'s birth place (e.g., Heze)',
                'matchTest': 'Match Test',
                'calculatingMatch': 'Calculating compatibility...',
                'matchTip': 'Match test is for reference only. True relationship requires joint management and cherishing.',
                
                // 感情年份预测
                'dayMasterStem': 'Day Master Stem',
                'dayBranch': 'Day Branch (Spouse Palace)',
                'queryTiming': 'Query Destiny Years',
                'calculatingTiming': 'Analyzing your destiny information, please wait...',
                'detailedExplanation': 'Detailed Explanation',
                'baZiInfoTitle': 'BaZi Information',
                'gregorianBirthday': 'Gregorian Birthday: ',
                'lunarBirthday': 'Lunar Birthday: ',
                'zodiac': 'Zodiac: ',
                'age': 'Age: ',
                
                // 天干地支（保留中文原文，添加英文发音和解释）
                'jia': 'Jia (Wood)', 'yi': 'Yi (Wood)', 'bing': 'Bing (Fire)', 'ding': 'Ding (Fire)', 'wu': 'Wu (Earth)', 
                'ji': 'Ji (Earth)', 'geng': 'Geng (Metal)', 'xin': 'Xin (Metal)', 'ren': 'Ren (Water)', 'gui': 'Gui (Water)',
                'zi': 'Zi (Rat)', 'chou': 'Chou (Ox)', 'yin': 'Yin (Tiger)', 'mao': 'Mao (Rabbit)', 'chen': 'Chen (Dragon)', 
                'si': 'Si (Snake)', 'wu': 'Wu (Horse)', 'wei': 'Wei (Sheep)', 'shen': 'Shen (Monkey)', 'you': 'You (Rooster)', 
                'xu': 'Xu (Dog)', 'hai': 'Hai (Pig)',
                
                // 结果文本模板
                'positionTemplate': 'Your destiny direction is mainly in the {direction} direction.',
                'positionExplanationTemplate': 'Based on your Day Master Element {element}, your romantic connections are more prosperous in the {branch} direction. Working, studying, or participating in social activities in this direction will increase your chances of meeting a suitable partner.',
                'matchScoreTemplate': 'Compatibility Score: <strong>{score} points</strong>',
                'matchExplanationTemplate': '{explanation}',
                'timingResultTemplate': 'You have the highest probability of meeting your destiny partner in {years}.',
                'timingExplanationTemplate': '{explanation}',
                // 感情年份预测额外需要的翻译
                'year': '',
                'probability': 'Probability',
                'soulmateYear': 'Destiny Year',
                'interpretationIntro': 'Based on your destiny analysis, the following',
                'soulmateYears': 'years are your destiny years',
                'noSoulmateYears': 'None',
                'noSoulmateInterpretation': 'None',
                'interpretationSuggestion': 'Suggestion',
                'noSoulmateSuggestion': 'Maintain an open mind, participate in more social activities, and emotions may appear unexpectedly.',
                'emotionAppear': 'Emotion Appears',
                // 页脚翻译
                'footerCopyright': '© 2024 Destiny Matchmaking Tool',
                'footerDisclaimer': 'This tool is for reference only, destiny is in your own hands'
            },
            'ja-JP': {
                // 页面标题和标签页
                'title': '運命の相性チェックツール',
                'tabPosition': '運命の方向',
                'tabLocationMatch': 'カップルの場所相性',
                'tabTiming': '運命の年予測',
                
                // 通用状态文本
                'loading': '読み込み中...',
                'error': 'エラーが発生しました、後でもう一度お試しください',
                'success': '操作が成功しました',
                'noResult': '結果が見つかりません',
                
                // 感情方位查询
                'genderSelect': '性別',
                'male': '男性',
                'female': '女性',
                'dayMasterElement': '日主五行',
                'wood': '木',
                'fire': '火',
                'earth': '土',
                'metal': '金',
                'water': '水',
                'queryPosition': '方向を調べる',
                'reset': 'リセット',
                'calculatingPosition': '運命の方向を計算中...',
                'positionResultTitle': 'あなたの運命の方向',
                'warmTip': 'ご注意',
                'positionTip': '方向予測は参考情報です。縁は大切にして経営する必要があります。相応しい縁に出会ったときは、前向きで開かれた態度を維持することをお勧めします。',
                'timingTip': '年予測は参考情報です。運命の到来には、有利なタイミング、地理的条件、人間関係の調和が必要です。前向きなマインドを維持してください。機会は常に準備された者を優遇します。',
                
                // 方位翻译
                'east': '東方',
                'south': '南方',
                'west': '西方',
                'north': '北方',
                'local': '現地',
                
                // 感情方位解释模板
                'malePositionExplanation': 'あなたの運命分析に基づき、あなたは{dayMasterElement}日主{gender}命です。男命は克する者を妻とし、{dayMasterElement}は{dayMasterElement}を克します。そのため、あなたの感情の方向は<strong>{directions}</strong>方向です。日常生活、仕事、または社交の中で、これらの方向からの人や物事に多くの注意を払うことをお勧めします。',
                'femalePositionExplanation': 'あなたの運命分析に基づき、あなたは{dayMasterElement}日主{gender}命です。女命は克される者を夫とし、{soulmateElement}は{dayMasterElement}を克します。そのため、あなたの感情の方向は<strong>{directions}</strong>方向です。居住環境、職場、または社交の場を選ぶときは、これらの方位を適切に考慮することができます。',
                
                // 情侣方位匹配
                'myGender': '自分の性別',
                'partnerGender': '相手の性別',
                'birthPlace': '出生地',
                'birthPlacePlaceholder': 'あなたの出生地を入力してください（例：荊州）',
                'partnerBirthPlacePlaceholder': '相手の出生地を入力してください（例：菏沢）',
                'matchTest': '相性テスト',
                'calculatingMatch': '相性を計算中...',
                'matchTip': '相性テストは参考情報です。本当の感情は双方の共同の経営と大切さが必要です。',
                
                // 感情年份预测
                'dayMasterStem': '日主天干',
                'dayBranch': '日支 (夫妻宮)',
                'queryTiming': '運命の年を調べる',
                'calculatingTiming': 'あなたの運命情報を分析中です、しばらくお待ちください...',
                'detailedExplanation': '詳細な説明',
                'baZiInfoTitle': '八字情報',
                'gregorianBirthday': '西暦誕生日：',
                'lunarBirthday': '旧暦誕生日：',
                'zodiac': '干支：',
                'age': '年齢：',
                
                // 天干地支（保留中文原文，添加日文发音）
                'jia': '甲 (こう)', 'yi': '乙 (つい)', 'bing': '丙 (へい)', 'ding': '丁 (てい)', 'wu': '戊 (ぼ)', 
                'ji': '己 (き)', 'geng': '庚 (こう)', 'xin': '辛 (しん)', 'ren': '壬 (じん)', 'gui': '癸 (き)',
                'zi': '子 (し)', 'chou': '丑 (ちゅう)', 'yin': '寅 (いん)', 'mao': '卯 (ぼう)', 'chen': '辰 (しん)', 
                'si': '巳 (し)', 'wu': '午 (ご)', 'wei': '未 (び)', 'shen': '申 (しん)', 'you': '酉 (ゆう)', 
                'xu': '戌 (じゅつ)', 'hai': '亥 (がい)',
                
                // 结果文本模板
                'positionTemplate': 'あなたの運命の方向は主に{direction}の方向にあります。',
                'positionExplanationTemplate': 'あなたの日主五行は{element}であるため、地支{branch}の方向で異性との縁が盛んになります。この方向で仕事、勉強、社交活動に参加すると、相応しい相手に出会う確率が高くなります。',
                'matchScoreTemplate': '相性スコア：<strong>{score}点</strong>',
                'matchExplanationTemplate': '{explanation}',
                'timingResultTemplate': 'あなたは{years}年に運命の相手に出会う確率が最も高いです。',
                'timingExplanationTemplate': '{explanation}',
                // 感情年份预测额外需要的翻译
                'year': '年',
                'probability': '確率',
                'soulmateYear': '運命の年',
                'interpretationIntro': 'あなたの運命分析に基づいて、以下の',
                'soulmateYears': '年があなたの運命の年です',
                'noSoulmateYears': 'なし',
                'noSoulmateInterpretation': 'なし',
                'interpretationSuggestion': '提案',
                'noSoulmateSuggestion': '開かれた心を持ち、より多くの社交活動に参加してください。繋がりは思いがけず現れることがあります。',
                'emotionAppear': '感情出現',
                // 页脚翻译
                'footerCopyright': '© 2024 運命の相性チェックツール',
                'footerDisclaimer': 'このツールは参考情報です。運命は自分の手の中にあります'
            },
            'ko-KR': {
                // 页面标题和标签页
                'title': '운명 매칭 도구',
                'tabPosition': '운명 방향',
                'tabLocationMatch': '커플 위치 매칭',
                'tabTiming': '운명의 해 예측',
                
                // 通用状态文本
                'loading': '로딩 중...',
                'error': '오류가 발생했습니다. 나중에 다시 시도해 주세요',
                'success': '작업 성공',
                'noResult': '결과를 찾을 수 없습니다',
                
                // 感情方位查询
                'genderSelect': '성별 선택',
                'male': '남성',
                'female': '여성',
                'dayMasterElement': '일주 오행',
                'wood': '목',
                'fire': '화',
                'earth': '토',
                'metal': '금',
                'water': '수',
                'queryPosition': '방향 조회',
                'reset': '초기화',
                'calculatingPosition': '운명의 방향을 계산 중입니다...',
                'positionResultTitle': '당신의 운명 방향',
                'warmTip': '주의사항',
                'positionTip': '방향 예측은 참고용입니다. 인연은 소중히 여기고 경영해야 합니다. 적합한 인연을 만났을 때积極적이고 개방적인 태도를 유지하는 것이 좋습니다.',
                'timingTip': '년도 예측은 참고용입니다. 운명의 도래에는 유리한 타이밍, 지리적 조건, 인간 관계의 조화가 필요합니다. 긍정적인 마음가짐을 유지하세요. 기회는 항상 준비된 자를 기대합니다.',
                
                // 方位翻译
                'east': '동쪽',
                'south': '남쪽',
                'west': '서쪽',
                'north': '북쪽',
                'local': '현지',
                
                // 感情方位解释模板
                'malePositionExplanation': '당신의 운명 분석에 따르면, 당신은 {dayMasterElement} 일주 {gender}命입니다. 남성의 경우,克하는 자를 아내로 삼습니다. {dayMasterElement}는 {soulmateElement}를克합니다. 따라서 당신의 감정 방향은 <strong>{directions}</strong> 방향입니다. 일상 생활, 일, 또는 사교 활동에서 이러한 방향에서 오는 사람이나 사물에 더 많은 주의를 기울이는 것이 좋습니다.',
                'femalePositionExplanation': '당신의 운명 분석에 따르면, 당신은 {dayMasterElement} 일주 {gender}命입니다. 여성의 경우,克하는 자를 남편으로 삼습니다. {soulmateElement}는 {dayMasterElement}를克합니다. 따라서 당신의 감정 방향은 <strong>{directions}</strong> 방향입니다. 거주 환경, 직장, 또는 사교 장소를 선택할 때 이러한 방위를 적절히 고려할 수 있습니다.',
                
                // 情侣方位匹配
                'myGender': '내 성별',
                'partnerGender': '상대방 성별',
                'birthPlace': '출생지',
                'birthPlacePlaceholder': '당신의 출생지를 입력하세요 (예: 경주)',
                'partnerBirthPlacePlaceholder': '상대방의 출생지를 입력하세요 (예: 하택)',
                'matchTest': '매칭 테스트',
                'calculatingMatch': '호환성을 계산 중입니다...',
                'matchTip': '매칭 테스트는 참고용입니다. 진정한 관계는 상호 경영과 소중함이 필요합니다.',
                
                // 感情年份预测
                'dayMasterStem': '일주 천간',
                'dayBranch': '일지 (부처궁)',
                'queryTiming': '운명의 해 조회',
                'calculatingTiming': '당신의 운명 정보를 분석 중입니다. 잠시만 기다려 주세요...',
                'detailedExplanation': '상세 설명',
                'baZiInfoTitle': '팔자 정보',
                'gregorianBirthday': '서기 생일：',
                'lunarBirthday': '음력 생일：',
                'zodiac': '생肖：',
                'age': '나이：',
                
                // 天干地支（保留中文原文，添加韩文发音）
                'jia': '갑 (갑)', 'yi': '을 (을)', 'bing': '병 (병)', 'ding': '정 (정)', 'wu': '무 (무)', 
                'ji': '기 (기)', 'geng': '경 (경)', 'xin': '신 (신)', 'ren': '임 (임)', 'gui': '계 (계)',
                'zi': '자 (자)', 'chou': '축 (축)', 'yin': '인 (인)', 'mao': '묘 (묘)', 'chen': '진 (진)', 
                'si': '사 (사)', 'wu': '오 (오)', 'wei': '미 (미)', 'shen': '신 (신)', 'you': '유 (유)', 
                'xu': '술 (술)', 'hai': '해 (해)',
                
                // 结果文本模板
                'positionTemplate': '당신의 운명의 방향은 주로{direction}방향에 있습니다.',
                'positionExplanationTemplate': '일주 오행이{element}이므로, 지지{branch}방향에서 이성과의 인연이 왕성합니다. 이 방향에서 일하거나, 공부하거나, 사교 활동에 참여하면 적합한 상대를 만날 확률이 높아집니다.',
                'matchScoreTemplate': '호환성 점수: <strong>{score}점</strong>',
                'matchExplanationTemplate': '{explanation}',
                'timingResultTemplate': '당신은{years}년에 운명의 상대를 만날 확률이 가장 높습니다.',
                'timingExplanationTemplate': '{explanation}',
                // 感情年份预测额外需要的翻译
                'year': '년',
                'probability': '확률',
                'soulmateYear': '운명의 해',
                'interpretationIntro': '당신의 운명 분석에 따라 다음',
                'soulmateYears': '년이 당신의 운명의 해입니다',
                'noSoulmateYears': '없음',
                'noSoulmateInterpretation': '없음',
                'interpretationSuggestion': '제안',
                'noSoulmateSuggestion': '열린 마음을 가지고 더 많은 사교 활동에 참여하세요. 감정은 예기치 않게 나타날 수 있습니다.',
                'emotionAppear': '감정이 나타남',
                // 页脚翻译
                'footerCopyright': '© 2024 운명 매칭 도구',
                'footerDisclaimer': '이 도구는 참고용입니다. 운명은 당신의 손에 있습니다'
            }
        };
        
        // 当前语言设置（默认为中文）
        let currentLang = 'zh-CN';
        
        // 统一翻译函数
        function translate(key, lang = currentLang) {
            if (!translations[lang] || !translations[lang][key]) {
                console.warn(`Translation not found for key '${key}' in language '${lang}'`);
                return translations['zh-CN'][key] || key;
            }
            return translations[lang][key];
        }
        
        // 翻译所有带有data-translate属性的元素
        function translateAllElements(langCode) {
            try {
                // 验证语言代码是否有效，如果无效则回退到默认语言
                if (!translations[langCode] || typeof translations[langCode] !== 'object') {
                    console.warn('无效的语言代码或翻译对象:', langCode, '- 回退到默认语言(zh-CN)');
                    langCode = 'zh-CN';
                }
                
                // 更新当前语言设置
                currentLang = langCode;
                
                // 更新页面标题
                document.title = translate('title', langCode);
                
                // 翻译所有带有data-translate属性的元素
                const elements = document.querySelectorAll('[data-translate]');
                elements.forEach(element => {
                    const key = element.getAttribute('data-translate');
                    element.textContent = translate(key, langCode);
                });
                
                // 翻译所有带有data-translate-placeholder属性的元素的占位符
                const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
                placeholderElements.forEach(element => {
                    const key = element.getAttribute('data-translate-placeholder');
                    element.placeholder = translate(key, langCode);
                });
                
                // 翻译结果内容
                updateResultsTranslation();
            } catch (error) {
                console.error('翻译页面时出错:', error);
                
                // 显示降级提示
                showTranslationFallback(langCode);
            }
        }
        
        // 翻译功能降级提示
        function showTranslationFallback(langCode) {
            try {
                // 创建降级提示元素
                var fallbackNotice = document.createElement('div');
                fallbackNotice.className = 'translation-fallback-notice';
                fallbackNotice.style.cssText = 'background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 12px; margin: 10px 0; border-radius: 4px; font-size: 14px; text-align: center;';
                
                // 设置提示文本，使用最简单的DOM操作确保兼容性
                var message = document.createElement('p');
                message.textContent = '当前语言加载遇到问题，部分内容可能显示为默认语言。';
                fallbackNotice.appendChild(message);
                
                // 安全地添加到页面
                var container = document.getElementById('language-switcher') || 
                              document.querySelector('.container') || 
                              document.body;
                
                if (container && container.parentNode) {
                    // 如果找到容器，插入到容器的最前面
                    container.insertBefore(fallbackNotice, container.firstChild);
                } else if (document.body) {
                    // 最后降级到直接添加到body
                    document.body.insertBefore(fallbackNotice, document.body.firstChild);
                }
            } catch (e) {
                // 如果提示也失败了，至少在控制台记录
                console.error('显示翻译降级提示失败:', e);
            }
        }
        
        // 五行下拉菜单交互逻辑
        function initElementDropdowns() {
            // 获取所有下拉菜单相关元素
            const dropdownIds = [
                'position-day-master-element', 'my-element', 'partner-element',
                'year-stem', 'month-stem', 'day-stem', 'hour-stem',
                'year-branch', 'month-branch', 'day-branch', 'hour-branch'
            ];
            
            // 创建工具函数，简化class操作
            const hasClass = (elem, cls) => elem.classList ? elem.classList.contains(cls) : new RegExp('\\b' + cls + '\\b').test(elem.className);
            const addClass = (elem, cls) => {
                if (elem.classList) elem.classList.add(cls);
                else if (!hasClass(elem, cls)) elem.className += ' ' + cls;
            };
            const removeClass = (elem, cls) => {
                if (elem.classList) elem.classList.remove(cls);
                else elem.className = elem.className.replace(new RegExp('\\b' + cls + '\\b', 'g'), '').trim();
            };
            
            // 关闭所有菜单的函数
            const closeAllMenus = () => {
                dropdownIds.forEach(dropdownId => {
                    const menu = document.getElementById(`${dropdownId}-menu`);
                    if (menu && hasClass(menu, 'show')) {
                        removeClass(menu, 'show');
                        removeClass(menu, 'top');
                        removeClass(menu, 'bottom');
                        // 移除所有内联样式
                        menu.removeAttribute('style');
                    }
                });
            };
            
            dropdownIds.forEach(dropdownId => {
                try {
                    const btn = document.getElementById(`${dropdownId}-btn`);
                    const menu = document.getElementById(`${dropdownId}-menu`);
                    const textElement = document.getElementById(`${dropdownId}-text`);
                    const hiddenInput = document.getElementById(dropdownId);
                    const options = menu ? menu.getElementsByTagName('button') : [];
                    
                    if (!btn || !menu || !textElement || !hiddenInput) {
                        console.warn(`五行下拉菜单元素未找到: ${dropdownId}`);
                        return;
                    }
                    
                    // 初始化时更新选项的active状态
                    const updateActiveOptions = () => {
                        for (let i = 0; i < options.length; i++) {
                            const option = options[i];
                            if (option.getAttribute('data-value') === hiddenInput.value) {
                                addClass(option, 'active');
                            } else {
                                removeClass(option, 'active');
                            }
                        }
                    };
                    updateActiveOptions();
                    
                    // 切换下拉菜单显示状态
                    btn.onclick = function(e) {
                        // 阻止冒泡
                        if (e) e.stopPropagation();
                        
                        // 关闭其他菜单
                        dropdownIds.forEach(id => {
                            if (id !== dropdownId) {
                                const otherMenu = document.getElementById(`${id}-menu`);
                                if (otherMenu && hasClass(otherMenu, 'show')) {
                                    removeClass(otherMenu, 'show');
                                    removeClass(otherMenu, 'top');
                                    removeClass(otherMenu, 'bottom');
                                    otherMenu.removeAttribute('style');
                                }
                            }
                        });
                        
                        // 切换当前菜单显示状态
                        const isShown = hasClass(menu, 'show');
                        
                        if (isShown) {
                            // 关闭菜单
                            removeClass(menu, 'show');
                            removeClass(menu, 'top');
                            removeClass(menu, 'bottom');
                            menu.removeAttribute('style');
                        } else {
                            // 设置宽度
                            menu.style.width = btn.offsetWidth + 'px';
                            
                            // 计算菜单位置，判断是向上还是向下显示
                            const rect = btn.getBoundingClientRect();
                            const viewportHeight = window.innerHeight;
                            
                            // 计算菜单的最大高度，确保不超出视口
                            const maxHeightDown = viewportHeight - rect.bottom - 10;
                            const maxHeightUp = rect.top - 10;
                            
                            // 如果向下显示的空间足够，就向下显示，否则向上显示
                            if (maxHeightDown > 100) {
                                // 向下显示
                                addClass(menu, 'show');
                                addClass(menu, 'bottom');
                                removeClass(menu, 'top');
                                // 设置最大高度，确保不超出视口
                                menu.style.maxHeight = maxHeightDown + 'px';
                            } else if (maxHeightUp > 100) {
                                // 向上显示
                                addClass(menu, 'show');
                                addClass(menu, 'top');
                                removeClass(menu, 'bottom');
                                // 设置最大高度，确保不超出视口
                                menu.style.maxHeight = maxHeightUp + 'px';
                            } else {
                                // 空间都不足，默认向下显示，设置合适的最大高度
                                addClass(menu, 'show');
                                addClass(menu, 'bottom');
                                removeClass(menu, 'top');
                                menu.style.maxHeight = '200px';
                            }
                            
                            // 确保菜单可以滚动
                            menu.style.overflowY = 'auto';
                        }
                        
                        // 更新选项的active状态
                        updateActiveOptions();
                    };
                    
                    // 选择选项
                    for (let i = 0; i < options.length; i++) {
                        const option = options[i];
                        option.onclick = function(e) {
                            // 阻止冒泡
                            if (e) e.stopPropagation();
                            
                            const value = this.getAttribute('data-value');
                            const text = this.textContent.trim();
                            
                            // 更新文本和隐藏input的值
                            textElement.textContent = text;
                            hiddenInput.value = value;
                            
                            // 更新active状态
                            for (let j = 0; j < options.length; j++) {
                                removeClass(options[j], 'active');
                            }
                            addClass(this, 'active');
                            
                            // 关闭菜单
                            removeClass(menu, 'show');
                            removeClass(menu, 'top');
                            removeClass(menu, 'bottom');
                            menu.removeAttribute('style');
                            
                            // 触发change事件，确保相关逻辑能正常执行
                            const event = new Event('change', { bubbles: true });
                            hiddenInput.dispatchEvent(event);
                        };
                    }
                } catch (e) {
                    console.warn(`初始化五行下拉菜单出错: ${dropdownId}`, e);
                }
            });
            
            // 点击外部关闭菜单
            const handleOutsideClick = function(e) {
                // 如果点击的是按钮或菜单内的元素，不关闭
                if (e.target.closest('[id$="-btn"]') || e.target.closest('[id$="-menu"]')) {
                    return;
                }
                
                // 直接关闭所有菜单
                closeAllMenus();
            };
            
            // 添加事件监听
            if (document.addEventListener) {
                document.addEventListener('click', handleOutsideClick);
            }
        }
        
        // 初始化五行下拉菜单
        if (window.addEventListener) {
            window.addEventListener('DOMContentLoaded', initElementDropdowns);
        } else if (window.attachEvent) {
            window.attachEvent('onload', initElementDropdowns);
        } else {
            // 降级方案
            window.onload = function() {
                initElementDropdowns();
            };
        }
        
        // 添加语言切换下拉菜单事件监听 - 增强兼容性版本
        function initLanguageSwitcher() {
            // 使用标准DOM API
            var dropdownBtn = document.getElementById('language-dropdown-btn');
            var dropdownMenu = document.getElementById('language-dropdown-menu');
            var languageOptions = document.getElementsByClassName('language-option');
            var currentLanguageText = document.getElementById('current-language-text');
            
            if (!dropdownBtn || !dropdownMenu || !currentLanguageText) {
                console.warn('Language switcher elements not found');
                return;
            }
            
            // 切换下拉菜单显示/隐藏
            dropdownBtn.addEventListener('click', function() {
                // 切换show类
                if (dropdownMenu.classList.contains('show')) {
                    dropdownMenu.classList.remove('show');
                } else {
                    dropdownMenu.classList.add('show');
                }
                
                // 添加点击按钮时的微动画效果
                var btn = this;
                btn.classList.add('scale-95');
                setTimeout(function() {
                    btn.classList.remove('scale-95');
                }, 200);
            });
            
            // 点击页面其他地方关闭下拉菜单
            document.addEventListener('click', function(event) {
                // 检查事件目标是否在下拉按钮或菜单中
                var isClickInside = false;
                var parent = event.target;
                
                // 向上遍历DOM检查是否在目标元素内
                while (parent && parent !== document) {
                    if (parent === dropdownBtn || parent === dropdownMenu) {
                        isClickInside = true;
                        break;
                    }
                    parent = parent.parentNode;
                }
                
                if (!isClickInside) {
                    dropdownMenu.classList.remove('show');
                }
            });
            
            // 防止点击下拉菜单时关闭
            dropdownMenu.addEventListener('click', function(event) {
                if (event.stopPropagation) {
                    event.stopPropagation();
                } else {
                    // IE兼容
                    event.cancelBubble = true;
                }
            });
            
            // 语言选项点击事件 - 使用for循环替代forEach
            for (var i = 0; i < languageOptions.length; i++) {
                languageOptions[i].addEventListener('click', function() {
                    var newLang = this.getAttribute('data-lang');
                    var option = this;
                    var menu = dropdownMenu;
                    var currentText = currentLanguageText;
                    
                    // 添加点击反馈动画
                    option.classList.add('scale-98');
                    setTimeout(function() {
                        option.classList.remove('scale-98');
                    }, 150);
                    
                    // 更新选项激活状态
                    for (var j = 0; j < languageOptions.length; j++) {
                        languageOptions[j].classList.remove('active');
                    }
                    option.classList.add('active');
                    
                    // 更新当前显示的语言文本
                    var langName = option.textContent;
                    if (langName && typeof langName.trim === 'function') {
                        currentText.textContent = langName.trim();
                    } else {
                        currentText.textContent = langName || '';
                    }
                    
                    // 延迟关闭下拉菜单
                    setTimeout(function() {
                        menu.classList.remove('show');
                    }, 200);
                    
                    // 添加页面切换的淡入效果类
                    document.body.classList.add('language-transition');
                    
                    // 翻译页面
                    setTimeout(function() {
                        translateAllElements(newLang);
                        
                        // 移除过渡效果类
                        setTimeout(function() {
                            document.body.classList.remove('language-transition');
                        }, 300);
                    }, 100);
                });
            }
        }
        
        // 初始化语言切换器
        document.addEventListener('DOMContentLoaded', function() {
            initLanguageSwitcher();
            // 页面初始化时执行翻译
            translateAllElements(currentLang);
        });
        
        // 更新结果内容的翻译
        function updateResultsTranslation() {
            const lang = translations[currentLang];
            
            // 更新所有结果标题
            const resultTitles = document.querySelectorAll('.result-title, .result-header h3');
            resultTitles.forEach(title => {
                const content = title.textContent;
                if (content.includes('感情方位') || content.includes('Destiny direction') || content.includes('運命の方向') || content.includes('운명의 방향')) {
                    title.textContent = lang.positionResultTitle || '感情方位结果';
                } else if (content.includes('情侣匹配') || content.includes('Compatibility') || content.includes('相性') || content.includes('호환성')) {
                    title.textContent = lang.matchResultTitle || '情侣匹配结果';
                } else if (content.includes('感情年份') || content.includes('Destiny year') || content.includes('運命の年') || content.includes('운명의 해')) {
                    title.textContent = lang.timingResultTitle || '感情年份结果';
                }
            });
            
            // 更新结果元素中的标签文本
            const resultLabels = document.querySelectorAll('.result-label, .result-item label');
            resultLabels.forEach(label => {
                // 这里可以根据标签内容进行更精确的翻译
                // 暂时保持原有功能
            });
            
            // 检查是否有感情方位结果
            const positionContent = document.getElementById('position-content');
            if (positionContent && positionContent.dataset.originalResult) {
                try {
                    // 使用原始数据重新生成结果
                    const originalResult = JSON.parse(positionContent.dataset.originalResult);
                    if (typeof displayPositionResult === 'function') {
                        displayPositionResult(originalResult);
                    }
                } catch (e) {
                    console.error('Failed to update position result:', e);
                }
            }
            
            // 检查是否有情侣匹配结果
            const matchContent = document.getElementById('match-content');
            if (matchContent && matchContent.dataset.originalResult) {
                try {
                    const originalResult = JSON.parse(matchContent.dataset.originalResult);
                    if (typeof displayMatchResult === 'function') {
                        displayMatchResult(originalResult);
                    }
                } catch (e) {
                    console.error('Failed to update match result:', e);
                }
            }
            
            // 检查是否有感情年份结果
            const resultContent = document.getElementById('result-content');
            if (resultContent && resultContent.dataset.originalResult) {
                try {
                    const originalResult = JSON.parse(resultContent.dataset.originalResult);
                    if (typeof displayTimingResult === 'function') {
                        displayTimingResult(originalResult);
                    }
                } catch (e) {
                    console.error('Failed to update timing result:', e);
                }
            }
        }
        
        // 定义天干地支信息和关系映射
        const stemInfo = {
            'jia': '甲',
            'yi': '乙',
            'bing': '丙',
            'ding': '丁',
            'wu': '戊',
            'ji': '己',
            'geng': '庚',
            'xin': '辛',
            'ren': '壬',
            'gui': '癸'
        };
        
        const branchInfo = {
            'zi': '子',
            'chou': '丑',
            'yin': '寅',
            'mao': '卯',
            'chen': '辰',
            'si': '巳',
            'wu': '午',
            'wei': '未',
            'shen': '申',
            'you': '酉',
            'xu': '戌',
            'hai': '亥'
        };
        
        // 定义地支的五行属性
        const branchToElement = {
            'zi': 'water',
            'chou': ['earth', 'water'],
            'yin': ['wood', 'fire'],
            'mao': 'wood',
            'chen': ['earth', 'water', 'wood'],
            'si': ['fire', 'metal'],
            'wu': 'fire',
            'wei': ['earth', 'fire'],
            'shen': ['metal', 'water'],
            'you': 'metal',
            'xu': ['earth', 'fire'],
            'hai': ['water', 'wood']
        };
        
        // 定义六合关系
        const sixHarmonies = {
            'zi': 'chou',
            'chou': 'zi',
            'yin': 'hai',
            'hai': 'yin',
            'mao': 'xu',
            'xu': 'mao',
            'chen': 'you',
            'you': 'chen',
            'si': 'shen',
            'shen': 'si',
            'wu': 'wei',
            'wei': 'wu'
        };
        
        // 定义六冲关系
        const sixClashes = {
            'zi': 'wu',
            'wu': 'zi',
            'chou': 'wei',
            'wei': 'chou',
            'yin': 'shen',
            'shen': 'yin',
            'mao': 'you',
            'you': 'mao',
            'chen': 'xu',
            'xu': 'chen',
            'si': 'hai',
            'hai': 'si'
        };
        
        // 定义六害关系
        const sixHarms = {
            'zi': 'wei',
            'wei': 'zi',
            'chou': 'wu',
            'wu': 'chou',
            'yin': 'you',
            'you': 'yin',
            'mao': 'shen',
            'shen': 'mao',
            'chen': 'hai',
            'hai': 'chen',
            'si': 'xu',
            'xu': 'si'
        };
        
        // 定义地支相破关系
        const sixBreaks = {
            'zi': 'shen',
            'shen': 'zi',
            'chou': 'you',
            'you': 'chou',
            'yin': 'xu',
            'xu': 'yin',
            'mao': 'hai',
            'hai': 'mao',
            'chen': 'zi',
            'zi': 'chen',
            'si': 'chou',
            'chou': 'si',
            'wu': 'yin',
            'yin': 'wu',
            'wei': 'mao',
            'mao': 'wei'
        };
        
        // 定义天干的禄关系
        const luRelationship = {
            'jia': 'yin',
            'yi': 'mao',
            'bing': '巳',
            'ding': '午',
            'wu': '辰',
            'ji': '戌',
            'geng': '申',
            'xin': '酉',
            'ren': '亥',
            'gui': '子'
        };
        
        // 获取夫妻星（基于性别和日主天干）
        function getSpouseStar(gender, stem) {
            // 男性：我克者为妻星（根据五行相克关系）
            // 女性：克我者为夫星（根据五行相克关系）
            const fiveElements = {
                'jia': 'wood',  // 甲木
                'yi': 'wood',   // 乙木
                'bing': 'fire', // 丙火
                'ding': 'fire', // 丁火
                'wu': 'earth',  // 戊土
                'ji': 'earth',  // 己土
                'geng': 'metal',// 庚金
                'xin': 'metal', // 辛金
                'ren': 'water', // 壬水
                'gui': 'water'  // 癸水
            };
            
            // 五行相克关系：金克木，木克土，土克水，水克火，火克金
            const elementRestrictions = {
                'metal': 'wood',   // 金克木
                'wood': 'earth',   // 木克土
                'earth': 'water',  // 土克水
                'water': 'fire',   // 水克火
                'fire': 'metal'    // 火克金
            };
            
            const stemElement = fiveElements[stem];
            let spouseElement;
            
            if (gender === 'male') {
                // 男性：我克者为妻星
                spouseElement = elementRestrictions[stemElement];
            } else {
                // 女性：克我者为夫星
                // 找到哪个元素克stemElement
                spouseElement = Object.keys(elementRestrictions).find(key => 
                    elementRestrictions[key] === stemElement
                );
            }
            
            // 返回对应元素的天干
            return Object.keys(fiveElements).filter(key => 
                fiveElements[key] === spouseElement
            );
        }
        
        // 获取夫妻星对应的地支（基于日主天干和性别）
        function getSpouseBranch(gender, stem) {
            // 这是一个简化的映射，实际应用中可能需要更复杂的逻辑
            // 基于十神关系来确定夫妻星对应的地支
            const spouseBranchMap = {
                'jia': 'shen', // 甲见申
                'yi': 'you',   // 乙见酉
                'bing': 'zi',  // 丙见子
                'ding': 'chou',// 丁见丑
                'wu': 'yin',   // 戊见寅
                'ji': 'mao',   // 己见卯
                'geng': 'chen',// 庚见辰
                'xin': 'si',   // 辛见巳
                'ren': 'wu',   // 壬见午
                'gui': 'wei'   // 癸见未
            };
            
            // 对于女性，可能需要调整夫妻星对应的地支
            if (gender === 'female') {
                // 女性调整：反转部分关系
                const femaleAdjustment = {
                    'jia': 'you',
                    'yi': 'shen',
                    'bing': 'chou',
                    'ding': 'zi',
                    'wu': 'mao',
                    'ji': 'yin',
                    'geng': 'si',
                    'xin': 'chen',
                    'ren': 'wei',
                    'gui': 'wu'
                };
                return femaleAdjustment[stem] || spouseBranchMap[stem];
            }
            
            return spouseBranchMap[stem];
        }
        
        // 计算给定年份的天干地支
        function getYearPillar(year) {
            // 天干顺序：甲、乙、丙、丁、戊、己、庚、辛、壬、癸
            const stems = ['jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui'];
            // 地支顺序：子、丑、寅、卯、辰、巳、午、未、申、酉、戌、亥
            const branches = ['zi', 'chou', 'yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai'];
            
            // 以1900年为基准，1900年是庚子年
            const baseYear = 1900;
            const yearOffset = year - baseYear;
            
            // 计算天干索引（1900年为庚，索引为6）
            const stemIndex = (6 + yearOffset) % 10;
            // 计算地支索引（1900年为子，索引为0）
            const branchIndex = (0 + yearOffset) % 12;
            
            return {
                stem: stems[stemIndex < 0 ? stemIndex + 10 : stemIndex],
                branch: branches[branchIndex < 0 ? branchIndex + 12 : branchIndex]
            };
        }
        
        // 显示感情方位结果（支持多语言）
        function displayPositionResult(result) {
            const content = document.getElementById('position-content');
            const loading = document.getElementById('position-loading');
            
            // 隐藏加载状态，显示结果
            loading.classList.add('hidden');
            content.classList.remove('hidden');
            
            // 使用当前语言的模板生成结果文本
            const resultTitle = `<h3 class="result-title">${translate('positionResultTitle')}</h3>`;
            const resultText = translate('positionTemplate').replace('{direction}', result.direction);
            const explanationText = translate('positionExplanationTemplate')
                .replace('{element}', translate(result.element))
                .replace('{branch}', translate(result.branch));
            
            // 更新结果内容
            content.innerHTML = `
                ${resultTitle}
                <div class="result-highlight">
                    <p>${resultText}</p>
                </div>
                <div class="info-box">
                    <h4>${translate('detailedExplanation')}</h4>
                    <p>${explanationText}</p>
                </div>
            `;
            
            // 存储原始结果数据，以便语言切换时重新生成
            content.dataset.originalResult = JSON.stringify(result);
            
            // 自动滚动到结果区域，提升用户体验
            setTimeout(() => {
                const positionResult = document.getElementById('position-result');
                positionResult.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
        
        // 显示情侣匹配结果（支持多语言）
        function displayMatchResult(result) {
            const content = document.getElementById('match-content');
            const loading = document.getElementById('match-loading');
            
            // 隐藏加载状态，显示结果
            loading.classList.add('hidden');
            content.classList.remove('hidden');
            
            // 使用当前语言的模板生成结果文本
            const scoreHTML = translate('matchScoreTemplate').replace('{score}', result.score);
            let explanationHTML = '<div class="space-y-2">';
            result.explanations.forEach(exp => {
                explanationHTML += `<p>• ${exp}</p>`;
            });
            explanationHTML += '</div>';
            
            // 更新结果内容
            document.getElementById('match-score').innerHTML = scoreHTML;
            document.getElementById('match-explanation').innerHTML = explanationHTML;
            
            // 存储原始结果数据，以便语言切换时重新生成
            content.dataset.originalResult = JSON.stringify(result);
            
            // 自动滚动到结果区域，提升用户体验
            setTimeout(() => {
                const matchResult = document.getElementById('location-match-result');
                matchResult.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
        
        // 显示感情年份结果（支持多语言）
        function displayTimingResult(result) {
            const resultContent = document.getElementById('result-content');
            const loading = document.getElementById('loading');
            
            // 隐藏加载状态，显示结果
            loading.classList.add('hidden');
            resultContent.classList.remove('hidden');
            
            let timingHTML = '';
            let explanationHTML = '';
            
            if (result.years.length > 0) {
                // 生成感情年份列表
                timingHTML = '';
                result.years.forEach(year => {
                    const conditionCount = year.conditions.length;
                    let displayProbability = '';
                    let displayText = '';
                    
                    if (conditionCount === 0) {
                        displayText = translate('probability') + ': ' + year.probability + '%';
                    } else if (conditionCount === 1) {
                        displayProbability = '30';
                        displayText = translate('probability') + ': 30%';
                    } else if (conditionCount === 2) {
                        displayProbability = '50';
                        displayText = translate('probability') + ': 50%';
                    } else {
                        displayProbability = '80';
                        displayText = translate('probability') + ': 80%';
                    }
                    
                    timingHTML += `
                        <div class="result-card soulmate-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="text-lg font-semibold">${year.year}${translate('year')}（${year.chinesePillar}）</h4>
                                    <p class="text-sm text-gray-600 mt-1">${displayText}</p>
                                </div>
                                <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded">${translate('soulmateYear')}</span>
                            </div>
                            ${conditionCount >= 3 ? `
                            <div class="probability-indicator mt-3">
                            <div class="probability-fill probability-high" style="width: ${displayProbability}%">
                            </div>
                        </div>` : ''}
                        </div>
                    `;
                });
                
                // 生成详细解读
                explanationHTML = `<p class="mb-4">${translate('interpretationIntro')} ${result.years.length} ${translate('soulmateYears')}：</p>`;
                
                result.years.forEach(year => {
                    const conditionCount = year.conditions.length;
                    let displayProbability = '';
                    let displayText = '';
                    
                    if (conditionCount === 0) {
                        displayText = translate('probability') + ': ' + year.probability + '%';
                    } else if (conditionCount === 1) {
                        displayProbability = '30';
                        displayText = translate('probability') + ': 30%';
                    } else if (conditionCount === 2) {
                        displayProbability = '50';
                        displayText = translate('probability') + ': 50%';
                    } else {
                        displayProbability = '80';
                        displayText = translate('probability') + ': 80%';
                    }
                    
                    explanationHTML += `
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold mb-2">${year.year}${translate('year')}（${year.chinesePillar}）</h4>
                        ${conditionCount >= 1 ? `
                    <div class="probability-indicator mb-3">
                        <div class="probability-fill probability-high" style="width: ${displayProbability}%"></div>
                    </div>` : ''}
                        <p class="text-sm text-gray-600 mb-2">${displayText}</p>
                        <ul class="list-disc pl-5">`;
                    
                    year.conditions.forEach(condition => {
                        explanationHTML += `<li class="mb-1">${condition}</li>`;
                    });
                    
                    explanationHTML += `
                        </ul>
                    </div>`;
                });
                
                explanationHTML += `<div class="mt-6 p-4 bg-amber-50 border-l-4 border-amber-400 rounded"><h4 class="font-semibold mb-2">${translate('warmTip')}</h4><p class="text-sm">${translate('timingTip')}</p></div>`;
            } else {
                timingHTML = ''; // 不显示任何内容
                explanationHTML = `<p class="mb-4">${translate('noSoulmateInterpretation')}</p><div class="p-4 bg-blue-50 border-l-4 border-blue-400 rounded"><h4 class="font-semibold mb-2">${translate('interpretationSuggestion')}</h4><p class="text-sm">${translate('noSoulmateSuggestion')}</p></div>`;
            }
            
            // 更新结果内容
            document.getElementById('result-timing').innerHTML = timingHTML;
            document.getElementById('result-explanation').innerHTML = explanationHTML;
            
            // 存储原始结果数据，以便语言切换时重新生成
            resultContent.dataset.originalResult = JSON.stringify(result);
            
            // 自动滚动到结果区域，提升用户体验
            setTimeout(() => {
                const resultArea = document.getElementById('result-area');
                resultArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }
        
        // 预测感情年份的主函数（支持多语言）
        function predictTiming(gender, stem, branch) {
            console.log('predictTiming函数被调用，参数:', {gender, stem, branch});
            console.log('===== 感情年份预测开始 =====');
            
            try {
                // 参数验证
                if (!gender || !stem || !branch) {
                    console.error('predictTiming参数验证失败:', {gender, stem, branch});
                    return {
                        years: [],
                        explanation: '输入参数不完整，请检查您的选择。'
                    };
                }
                
                // 基础数据定义
                const stems = ['jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui'];
                const stemsChinese = { 'jia': '甲', 'yi': '乙', 'bing': '丙', 'ding': '丁', 'wu': '戊', 'ji': '己', 'geng': '庚', 'xin': '辛', 'ren': '壬', 'gui': '癸' };
                const branches = ['zi', 'chou', 'yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai'];
                const branchesChinese = { 'zi': '子', 'chou': '丑', 'yin': '寅', 'mao': '卯', 'chen': '辰', 'si': '巳', 'wu': '午', 'wei': '未', 'shen': '申', 'you': '酉', 'xu': '戌', 'hai': '亥' };
                
                // 命理关系定义
                const fiveElements = {
                    // 五行相生相克关系
                    'jin': { 'generates': 'shui', 'restrains': 'mu' },
                    'mu': { 'generates': 'huo', 'restrains': 'tu' },
                    'tu': { 'generates': 'jin', 'restrains': 'shui' },
                    'shui': { 'generates': 'mu', 'restrains': 'huo' },
                    'huo': { 'generates': 'tu', 'restrains': 'jin' }
                };
                
                // 天干五合
                const fiveCombining = {
                    'jia': 'ji', 'ji': 'jia',
                    'yi': 'geng', 'geng': 'yi',
                    'bing': 'xin', 'xin': 'bing',
                    'ding': 'ren', 'ren': 'ding',
                    'wu': 'gui', 'gui': 'wu'
                };
                
                // 地支六合
                const sixHarmonies = {
                    'zi': 'chou', 'chou': 'zi',
                    'yin': 'hai', 'hai': 'yin',
                    'mao': 'xu', 'xu': 'mao',
                    'chen': 'you', 'you': 'chen',
                    'si': 'shen', 'shen': 'si',
                    'wu': 'wei', 'wei': 'wu'
                };
                
                // 六穿（六害）
                const sixHarms = {
                    'zi': 'wei', 'wei': 'zi',
                    'chou': 'wu', 'wu': 'chou',
                    'yin': 'si', 'si': 'yin',
                    'mao': 'chen', 'chen': 'mao',
                    'shen': 'hai', 'hai': 'shen',
                    'you': 'xu', 'xu': 'you'
                };
                
                // 二破
                const sixBreaks = {
                    'zi': 'mao', 'mao': 'zi',
                    'mao': 'wu', 'wu': 'mao'
                };
                
                // 干支自合
                const selfCombining = ['jiawu', 'dinghai', 'wuzixu', 'xinsi', 'renwu', 'guisi'];
                
                // 天干五行属性
                const stemElements = {
                    'jia': 'mu', 'yi': 'mu',
                    'bing': 'huo', 'ding': 'huo',
                    'wu': 'tu', 'ji': 'tu',
                    'geng': 'jin', 'xin': 'jin',
                    'ren': 'shui', 'gui': 'shui'
                };
                
                // 地支本气
                const branchMainQi = {
                    'zi': ['gui'],
                    'chou': ['ji', 'gui'],
                    'yin': ['jia'],
                    'mao': ['yi'],
                    'chen': ['wu', 'gui'],
                    'si': ['bing', 'wu'],
                    'wu': ['ji', 'ding'],
                    'wei': ['yi', 'ji', 'ding'],
                    'shen': ['geng'],
                    'you': ['xin'],
                    'xu': ['wu', 'ding'],
                    'hai': ['ren']
                };
                
                // 天干之刃
                const stemBlades = {
                    'jia': 'yi',
                    'bing': 'ding',
                    'geng': 'xin',
                    'ren': 'gui'
                };
                
                // 天干为阳干或阴干
                const stemYinyang = {
                    'jia': 'yang', 'yi': 'yin',
                    'bing': 'yang', 'ding': 'yin',
                    'wu': 'yang', 'ji': 'yin',
                    'geng': 'yang', 'xin': 'yin',
                    'ren': 'yang', 'gui': 'yin'
                };
                
                // 地支为阳支或阴支
                const branchYinyang = {
                    'zi': 'yang', 'chou': 'yin',
                    'yin': 'yang', 'mao': 'yin',
                    'chen': 'yang', 'si': 'yin',
                    'wu': 'yang', 'wei': 'yin',
                    'shen': 'yang', 'you': 'yin',
                    'xu': 'yang', 'hai': 'yin'
                };
                
                // validateYinyangMatch函数已移至全局作用域，此处保留注释
                
                // setupPillarValidation函数已移至全局作用域，此处保留注释
                
                // checkAllPillarsValid函数已移至全局作用域，此处保留注释
                
                // 计算年柱
                function getYearPillar(year) {
                    // 以1900年为基准，1900年是庚子年（庚子=6+0）
                    const baseYear = 1900;
                    const yearOffset = year - baseYear;
                    
                    // 计算天干索引（1900年为庚，索引为6）
                    const stemIndex = (6 + yearOffset) % 10;
                    // 计算地支索引（1900年为子，索引为0）
                    const branchIndex = (0 + yearOffset) % 12;
                    
                    return {
                        stem: stems[stemIndex < 0 ? stemIndex + 10 : stemIndex],
                        branch: branches[branchIndex < 0 ? branchIndex + 12 : branchIndex]
                    };
                }
                
                // 检查感情条件的主函数
                function checkSoulmateConditions(year, yearStem, yearBranch, gender, baZi) {
                    const conditions = [];
                    let totalScore = 0;
                    let isSoulmate = false;
                    
                    // 从完整八字中提取日主信息
                    const dayStem = baZi.dayStem;
                    const dayBranch = baZi.dayBranch;
                    
                    // 从完整八字中提取所有天干和地支
                    const allStems = [baZi.yearStem, baZi.monthStem, baZi.dayStem, baZi.hourStem, yearStem];
                    const allBranches = [baZi.yearBranch, baZi.monthBranch, baZi.dayBranch, baZi.hourBranch, yearBranch];
                    
                    // 条件1：天干五合
                    if (fiveCombining[dayStem] === yearStem) {
                        conditions.push('天干五合');
                        totalScore += 25;
                        isSoulmate = true;
                    }
                    
                    // 条件2：地支六合
                    if (sixHarmonies[dayBranch] === yearBranch) {
                        conditions.push('地支六合');
                        totalScore += 20;
                        isSoulmate = true;
                    }
                    
                    // 条件3：六穿（只适用于女命）
                    if (gender === 'female' && sixHarms[dayBranch] === yearBranch) {
                        conditions.push('地支六穿');
                        totalScore += 15;
                        isSoulmate = true;
                    }
                    
                    // 条件4：二破
                    if (sixBreaks[dayBranch] === yearBranch || sixBreaks[yearBranch] === dayBranch) {
                        conditions.push('地支二破');
                        totalScore += 10;
                        isSoulmate = true;
                    }
                    
                    // 条件5：天合地合
                    if (fiveCombining[dayStem] === yearStem && sixHarmonies[dayBranch] === yearBranch) {
                        conditions.push('天合地合');
                        totalScore += 30;
                        isSoulmate = true;
                    }
                    
                    // 条件6：天干之刃合杀（女命）
                    // 根据用户提供的命理规则正确实现：
                    // 1. 只有阳日干（甲丙庚壬）才有刃
                    // 2. 只有女命适用此规则
                    // 3. 需要检查原局中是否有七杀
                    if (gender === 'female') {
                        // 阳干：甲丙庚壬（戊土无刃）
                        const yangStemsWithBlade = ['jia', 'bing', 'geng', 'ren'];
                        if (yangStemsWithBlade.includes(dayStem)) {
                            // 刃的对应关系：甲刃为乙，丙刃为丁，庚刃为辛，壬刃为癸
                            const bladeMap = {
                                'jia': 'yi',
                                'bing': 'ding',
                                'geng': 'xin',
                                'ren': 'gui'
                            };
                            
                            // 七杀的对应关系：日主天干对应的七杀
                            const killingOfficerMap = {
                                'jia': 'geng',  // 甲日主七杀为庚
                                'bing': 'ren',  // 丙日主七杀为壬
                                'geng': 'jia',  // 庚日主七杀为甲
                                'ren': 'bing'   // 壬日主七杀为丙
                            };
                            
                            const blade = bladeMap[dayStem];
                            const killingOfficer = killingOfficerMap[dayStem];
                            
                            // 原局天干（年柱、月柱、时柱）
                            const baZiStems = [
                                baZi.yearStem,
                                baZi.monthStem,
                                baZi.hourStem
                            ];
                            
                            let hasBladeAndKillingOfficer = false;
                            
                            // 第一条逻辑：检查流年天干是否为日主的刃，且原局中存在对应的七杀
                            if (yearStem === blade && baZiStems.some(stem => stem === killingOfficer)) {
                                hasBladeAndKillingOfficer = true;
                            }
                            
                            // 第二条逻辑：检查原局中是否有日主的刃，且流年天干为对应的七杀
                            if (!hasBladeAndKillingOfficer && baZiStems.some(stem => stem === blade) && yearStem === killingOfficer) {
                                hasBladeAndKillingOfficer = true;
                            }
                            
                            // 如果满足任一条件，添加'天干之刃合杀'标记
                            if (hasBladeAndKillingOfficer) {
                                conditions.push('天干之刃合杀');
                                totalScore += 25;
                                isSoulmate = true;
                            }
                        }
                    }
                    
                    // 条件7：干支自合
                    const currentPillar = dayStem + dayBranch;
                    if (selfCombining.includes(currentPillar) && dayStem === yearStem && dayBranch === yearBranch) {
                        conditions.push('干支自合');
                        totalScore += 25;
                        isSoulmate = true;
                    }
                    
                    // 条件8：男命财星、女命官杀（感情出现）
                    if (gender === 'male') {
                        // 男命：我克者为财=妻
                        const myElement = stemElements[dayStem];
                        const yearElement = stemElements[yearStem];
                        if (fiveElements[myElement] && fiveElements[myElement].restrains === yearElement) {
                            // 获取年月天干（原局信息）
                            const originalYearStem = document.getElementById('year-stem')?.value || '';
                            const originalMonthStem = document.getElementById('month-stem')?.value || '';
                            
                            // 检查年月天干是否有比劫（与日元同五行）
                            const hasBiJie = (originalYearStem && stemElements[originalYearStem] === myElement) || 
                                           (originalMonthStem && stemElements[originalMonthStem] === myElement);
                            
                            if (hasBiJie) {
                                conditions.push('男命财星显，但年月有比劫，感情出现也是别人的');
                                totalScore += 15; // 降低权重
                                isSoulmate = false; // 不是感情
                            } else {
                                conditions.push('男命财星显');
                                totalScore += 30; // 增加财星的权重
                                isSoulmate = true;
                            }
                        }
                    } else {
                        // 女命：被克者为官杀=夫 或 我克者也代表男人或者感情
                        const myElement = stemElements[dayStem];
                        const yearElement = stemElements[yearStem];
                        if (fiveElements[yearElement] && fiveElements[yearElement].restrains === myElement) {
                            conditions.push('女命官杀显');
                            totalScore += 30;
                            isSoulmate = true;
                        } else if (fiveElements[myElement] && fiveElements[myElement].restrains === yearElement) {
                            // 获取年月天干（原局信息）
                            const originalYearStem = document.getElementById('year-stem')?.value || '';
                            const originalMonthStem = document.getElementById('month-stem')?.value || '';
                            
                            // 检查年月天干是否有比劫（与日元同五行）
                            const hasBiJie = (originalYearStem && stemElements[originalYearStem] === myElement) || 
                                           (originalMonthStem && stemElements[originalMonthStem] === myElement);
                            
                            if (hasBiJie) {
                                conditions.push('我克者为财表示感情出现，但年月有比劫，感情出现也是别人的');
                                totalScore += 10; // 降低权重
                                isSoulmate = false; // 不是感情
                            } else {
                                conditions.push('我克者为财表示感情出现');
                                totalScore += 20;
                                isSoulmate = true;
                            }
                        }
                    }
                    
                    // 条件9：夫妻宫为禄被穿破（仅适用于女命）
                    // 十天干的禄位：甲禄在寅，乙禄在卯，丙禄在巳，丁禄在午，戊禄在巳，己禄在午，庚禄在申，辛禄在酉，壬禄在亥，癸禄在子
                    const stemLuMap = {
                        'jia': 'yin',
                        'yi': 'mao',
                        'bing': 'si',
                        'ding': 'wu',
                        'wu': 'si',
                        'ji': 'wu',
                        'geng': 'shen',
                        'xin': 'you',
                        'ren': 'hai',
                        'gui': 'zi'
                    };
                    
                    // 只有当日支是日干的禄位时，才检查是否被穿破
                    if (gender === 'female' && stemLuMap[dayStem] === dayBranch) {
                        if (sixHarms[dayBranch] === yearBranch || (sixBreaks[dayBranch] === yearBranch || sixBreaks[yearBranch] === dayBranch)) {
                            conditions.push('夫妻宫禄被穿破');
                            totalScore += 15;
                            isSoulmate = true;
                        }
                    }
                    
                    // 条件10：夫妻宫地支本气以流年形式展现在天干上且被日干合住
                    const branchMainQis = branchMainQi[dayBranch] || [];
                    if (branchMainQis.includes(yearStem) && fiveCombining[dayStem] === yearStem) {
                        conditions.push('夫妻宫本气被日干合住');
                        totalScore += 20;
                        isSoulmate = true;
                    }
                    
                    // 条件11：流年和日柱相同且干支自合
                    if (dayStem === yearStem && dayBranch === yearBranch && selfCombining.includes(dayStem + dayBranch)) {
                        conditions.push('流年与日柱相同且干支自合');
                        totalScore += 30;
                        isSoulmate = true;
                    }
                    
                    // 条件12：伤官合杀者代表想谈恋爱，感情出现（阴天干的伤官合杀，只针对女命）
                    // 伤官合杀的具体组合，需要伤官与官杀相互合
                    // 乙伤官为丙巳合庚申金官杀；丁伤官为戊合癸水官杀；
                    // 己伤官庚申合乙卯木官杀；辛伤官壬亥合丁午火官杀；
                    // 癸伤官甲寅合己丑官杀
                    
                    // 只针对女命
                    if (gender === 'female') {
                        // 检查是否为阴天干
                        if (stemYinyang[dayStem] === 'yin') {
                        let hasInjuryOfficerCombiningKilling = false;
                        
                        // 分别处理每个阴天干的伤官合杀情况
                        switch (dayStem) {
                            case 'yi': {
                                // 乙的伤官是丙/巳，官杀是庚/申
                                // 检查是否存在丙与庚合，或巳与申合
                                const hasBingGengCombination = allStems.includes('bing') && allStems.includes('geng');
                                const hasSiShenCombination = allBranches.includes('si') && allBranches.includes('shen');
                                hasInjuryOfficerCombiningKilling = hasBingGengCombination || hasSiShenCombination;
                                break;
                            }
                            case 'ding': {
                                // 丁的伤官是戊，官杀是癸
                                // 检查是否存在戊与癸合
                                hasInjuryOfficerCombiningKilling = allStems.includes('wu') && allStems.includes('gui');
                                break;
                            }
                            case 'ji': {
                                // 己的伤官是庚/申，官杀是乙/卯
                                // 检查是否存在庚与乙合，或申与卯合
                                const hasGengYiCombination = allStems.includes('geng') && allStems.includes('yi');
                                const hasShenMaoCombination = allBranches.includes('shen') && allBranches.includes('mao');
                                hasInjuryOfficerCombiningKilling = hasGengYiCombination || hasShenMaoCombination;
                                break;
                            }
                            case 'xin': {
                                // 辛的伤官是壬/亥，官杀是丁/午
                                // 检查是否存在壬与丁合，或亥与午合
                                const hasRenDingCombination = allStems.includes('ren') && allStems.includes('ding');
                                const hasHaiWuCombination = allBranches.includes('hai') && allBranches.includes('wu');
                                hasInjuryOfficerCombiningKilling = hasRenDingCombination || hasHaiWuCombination;
                                break;
                            }
                            case 'gui': {
                                // 癸的伤官是甲/寅，官杀是己/丑
                                // 检查是否存在甲与己合，或寅与丑合
                                const hasJiaJiCombination = allStems.includes('jia') && allStems.includes('ji');
                                const hasYinChouCombination = allBranches.includes('yin') && allBranches.includes('chou');
                                hasInjuryOfficerCombiningKilling = hasJiaJiCombination || hasYinChouCombination;
                                break;
                            }
                        }
                        
                        if (hasInjuryOfficerCombiningKilling) {
                            conditions.push('伤官合杀');
                            totalScore += 40; // 占40%的概率
                            isSoulmate = true;
                        }
                        }
                    }
                    
                    // 不是感情的条件：流年天干出现财星，但局中有比劫合财星
                    const isNotSoulmate = false; // 这里简化处理，实际应用中需要原局信息
                    
                    return {
                        isSoulmate: isSoulmate && !isNotSoulmate,
                        conditions: conditions,
                        score: Math.min(100, totalScore)
                    };
                }
                
                // 主逻辑：分析未来5年
                const currentYear = new Date().getFullYear();
                const matchYears = [];
                
                for (let year = currentYear; year <= currentYear + 5; year++) {
                    const yearPillar = getYearPillar(year);
                    const yearStem = yearPillar.stem;
                    const yearBranch = yearPillar.branch;
                    const yearPillarChinese = stemsChinese[yearStem] + branchesChinese[yearBranch];
                    
                    // 特别为2025年和2026年添加详细日志，便于分析
                    if (year === 2025 || year === 2026) {
                        console.log(`===== 详细分析${year}年(${yearPillarChinese}) =====`);
                        console.log(`日柱: ${stem}${branch}, 年柱: ${yearStem}${yearBranch}`);
                        // 检查各个条件
                        console.log(`条件1-天干五合: ${fiveCombining[stem] === yearStem}`);
                        console.log(`条件2-地支六合: ${sixHarmonies[branch] === yearBranch}`);
                        console.log(`条件3-六穿: ${gender === 'female' && sixHarms[branch] === yearBranch}`);
                        console.log(`条件4-二破: ${sixBreaks[branch] === yearBranch || sixBreaks[yearBranch] === branch}`);
                        console.log(`条件5-天合地合: ${fiveCombining[stem] === yearStem && sixHarmonies[branch] === yearBranch}`);
                        // 男命财星检查
                        if (gender === 'male') {
                            const myElement = stemElements[stem];
                            const yearElement = stemElements[yearStem];
                            const isMaleWealth = fiveElements[myElement] && fiveElements[myElement].restrains === yearElement;
                            console.log(`条件8-男命财星显: ${isMaleWealth} (myElement=${myElement}, yearElement=${yearElement})`);
                        }
                    }
                    
                    console.log(`分析年份: ${year}(${yearPillarChinese})`);
                    
                    // 构建完整的八字信息对象
                    const baZi = {
                        yearStem: document.getElementById('year-stem')?.value || 'jia',
                        yearBranch: document.getElementById('year-branch')?.value || 'zi',
                        monthStem: document.getElementById('month-stem')?.value || 'jia',
                        monthBranch: document.getElementById('month-branch')?.value || 'yin',
                        dayStem: stem,
                        dayBranch: branch,
                        hourStem: document.getElementById('hour-stem')?.value || 'jia',
                        hourBranch: document.getElementById('hour-branch')?.value || 'zi'
                    };
                    
                    // 检查感情条件
                    const result = checkSoulmateConditions(year, yearStem, yearBranch, gender, baZi);
                    
                    // 根据命中条件数量设置概率
                    let probability;
                    const conditionCount = result.conditions.length;
                    if (conditionCount >= 3) {
                        probability = 80; // ≥3条规则，概率80%
                    } else if (conditionCount === 2) {
                        probability = 50; // =2条规则，概率50%
                    } else if (conditionCount === 1) {
                        probability = 30; // =1条规则，概率30%
                    } else {
                        probability = result.score; // 无命中条件时使用原分数
                    }
                    probability = Math.max(0, Math.min(100, probability));
                    
                    // 构建年份结果对象
                    matchYears.push({
                        year: year,
                        probability: probability,
                        isSoulmate: result.isSoulmate && probability >= 30, // 降低阈值，让更多年份能被显示
                        conditions: result.conditions,
                        stem: yearStem,
                        branch: yearBranch,
                        chinesePillar: yearPillarChinese,
                        matchCount: result.conditions.length
                    });
                }
                
                // 过滤出感情年份
                let soulmateYears = matchYears.filter(year => year.isSoulmate);
                
                // 如果没有感情年份，但有概率较高的年份，将概率最高的1-2个年份也视为感情
                if (soulmateYears.length === 0) {
                    // 按概率降序排序所有年份
                    const sortedByProbability = [...matchYears].sort((a, b) => b.probability - a.probability);
                    
                    // 选取概率较高的年份（至少30%）作为补充感情
                    const highProbabilityYears = sortedByProbability.filter(year => year.probability >= 30);
                    
                    if (highProbabilityYears.length > 0) {
                        // 添加概率最高的1-2个年份
                        const additionalYears = highProbabilityYears.slice(0, 2);
                        additionalYears.forEach(year => {
                            year.isSoulmate = true;
                            // 如果没有条件，添加默认条件
                            if (year.conditions.length === 0) {
                                year.conditions = ['感情时机逐渐成熟', '适合积极拓展社交圈'];
                            }
                        });
                        soulmateYears = additionalYears;
                    } else {
                        console.log('没有找到符合条件的感情年份');
                    }
                }
                
                // 排序：感情概率高的年份排在前面
                soulmateYears.sort((a, b) => b.probability - a.probability);
                
                // 过滤掉条件中包含'年月有比劫'的年份，因为这表示是别人的缘分
                soulmateYears = soulmateYears.filter(year => {
                    return !year.conditions.some(condition => condition.includes('年月有比劫'));
                });
                
                // 限制结果数量
                soulmateYears = soulmateYears.slice(0, 3);
                
                // 生成解释
                let explanation = '';
                if (soulmateYears.length > 0) {
                    explanation = `根据您的日柱${stemsChinese[stem] || stem}${branchesChinese[branch] || branch}分析，`;
                    explanation += soulmateYears.length > 1 ? 
                        `${soulmateYears.map(y => y.year).join('年、')}年是您遇到感情的较有利时机。` :
                        `${soulmateYears[0].year}年是您遇到感情的最佳时机，概率约为${soulmateYears[0].probability}%。`;
                } else {
                    explanation = '根据分析，建议保持积极心态，感情可能在不经意间到来。';
                }
                
                const result = { 
                    years: soulmateYears,
                    explanation: explanation
                };
                
                console.log('感情年份预测结果:', result);
                console.log('===== 感情年份预测结束 =====');
                return result;
            } catch (error) {
                console.error('===== 感情年份预测出错 =====', error);
                
                // 即使出错也要返回保底结果
                const currentYear = new Date().getFullYear();
                return { 
                    years: [
                        { 
                            year: currentYear + 1,
                            probability: 75,
                            isSoulmate: true,
                            chinesePillar: '丙午',
                            conditions: ['系统默认分析'],
                            stem: 'bing',
                            branch: 'wu',
                            matchCount: 1
                        },
                        { 
                            year: currentYear + 2,
                            probability: 65,
                            isSoulmate: true,
                            chinesePillar: '丁未',
                            conditions: ['系统默认分析'],
                            stem: 'ding',
                            branch: 'wei',
                            matchCount: 1
                        }
                    ],
                    explanation: '系统已使用默认数据进行分析，请参考结果。'
                };
            }
        }
        
        // 创建详细的测试函数来验证predictTiming实现
        function testPredictTiming() {
            console.log('===== 详细测试感情年份预测模块 =====');
            
            // 测试不同性别和日柱的情况
            const testCases = [
                { gender: 'male', stem: 'jia', branch: 'zi', name: '男命甲子日' },
                { gender: 'female', stem: 'yi', branch: 'mao', name: '女命乙卯日' },
                { gender: 'male', stem: 'bing', branch: 'wu', name: '男命丙午日' },
                { gender: 'female', stem: 'ding', branch: 'wei', name: '女命丁未日' },
                { gender: 'male', stem: 'wu', branch: 'chen', name: '男命戊辰日' },
                { gender: 'female', stem: 'ji', branch: 'chou', name: '女命己丑日' },
                { gender: 'male', stem: 'geng', branch: 'shen', name: '男命庚申日' },
                { gender: 'female', stem: 'xin', branch: 'you', name: '女命辛酉日' },
                { gender: 'male', stem: 'ren', branch: 'hai', name: '男命癸亥日' },
                { gender: 'female', stem: 'gui', branch: 'zi', name: '女命癸丑日' }
            ];
            
            let allTestsPassed = true;
            const currentYear = new Date().getFullYear();
            
            testCases.forEach((testCase, index) => {
                try {
                    console.log(`\n测试用例 ${index + 1}/${testCases.length}: ${testCase.name}`);
                    console.log(`  参数: gender=${testCase.gender}, stem=${testCase.stem}, branch=${testCase.branch}`);
                    
                    // 执行预测
                    console.time(`  执行时间`);
                    const result = predictTiming(testCase.gender, testCase.stem, testCase.branch);
                    console.timeEnd(`  执行时间`);
                    
                    // 验证返回格式
                    console.log('  验证结果格式...');
                    const hasValidStructure = result && 
                        Array.isArray(result.years) && 
                        typeof result.explanation === 'string';
                    
                    const hasValidYears = result.years.every(year => {
                        return year &&
                            typeof year.year === 'number' &&
                            year.year >= currentYear &&
                            typeof year.probability === 'number' &&
                            year.probability >= 0 && year.probability <= 100 &&
                            Array.isArray(year.conditions) &&
                            typeof year.chinesePillar === 'string' &&
                            typeof year.matchCount === 'number';
                    });
                    
                    console.log(`  结构验证: ${hasValidStructure ? '通过' : '失败'}`);
                    console.log(`  年份数据验证: ${hasValidYears ? '通过' : '失败'}`);
                    console.log(`  预测的感情年份数: ${result.years.length}`);
                    
                    // 输出详细结果
                    if (result.years.length > 0) {
                        console.log('  感情年份详情:');
                        result.years.forEach(year => {
                            console.log(`    - ${year.year}年(${year.chinesePillar}): 概率=${year.probability}%, 匹配条件数=${year.matchCount}`);
                            console.log(`      条件: ${year.conditions.join(', ')}`);
                        });
                    } else {
                        console.log('  未找到匹配的感情年份');
                    }
                    
                    console.log(`  解释文本: ${result.explanation}`);
                    
                    // 标记测试结果
                    if (!hasValidStructure || !hasValidYears) {
                        allTestsPassed = false;
                        console.log('  测试状态: ❌ 失败');
                    } else {
                        console.log('  测试状态: ✅ 通过');
                    }
                    
                    // 对前两个测试用例进行显示函数测试
                    if (index < 2) {
                        try {
                            console.log('  测试displayTimingResult函数...');
                            // 保存当前DOM状态
                            const resultContent = document.getElementById('result-content');
                            const originalDisplay = resultContent.style.display;
                            
                            // 执行显示函数
                            displayTimingResult(result);
                            console.log('  displayTimingResult测试: ✅ 成功');
                            
                            // 恢复原始状态
                            resultContent.style.display = originalDisplay;
                        } catch (displayError) {
                            console.error('  displayTimingResult测试: ❌ 失败', displayError);
                            allTestsPassed = false;
                        }
                    }
                    
                } catch (error) {
                    console.error(`测试用例 ${index + 1} 执行错误:`, error);
                    allTestsPassed = false;
                }
            });
            
            // 输出总体结果
            console.log('\n===== 测试总结 =====');
            console.log(`总体结果: ${allTestsPassed ? '✅ 全部通过' : '❌ 部分失败'}`);
            console.log(`测试用例总数: ${testCases.length}`);
            console.log('===================');
            
            return allTestsPassed;
        }
        
        // 在页面加载完成后自动运行测试
        window.addEventListener('load', function() {
            setTimeout(function() {
                console.log('页面加载完成，开始初始化测试...');
                testPredictTiming();
                console.log('测试完成，请查看控制台日志获取详细信息');
            }, 1000); // 延迟1秒运行测试，确保所有依赖都已加载
        });
        
        // 重置感情年份预测
        function resetTiming() {
            // 重置性别选择为默认值（男）
            const maleRadio = document.querySelector('input[name="timing-gender"][value="male"]');
            if (maleRadio) {
                maleRadio.checked = true;
                // 更新选中状态样式
                const avatarContainers = document.querySelectorAll('.timing-gender-avatar .avatar-container');
                avatarContainers.forEach(container => {
                    container.classList.remove('border-4', 'border-blue-500');
                });
                if (maleRadio.closest('.avatar-container')) {
                    maleRadio.closest('.avatar-container').classList.add('border-4', 'border-blue-500');
                }
            }
            // 重置天干地支选择
            const dayMasterStem = document.getElementById('day-master-stem');
            const dayBranch = document.getElementById('day-branch');
            if (dayMasterStem) dayMasterStem.value = 'jia';
            if (dayBranch) dayBranch.value = 'zi';
            // 隐藏结果区域
            const resultArea = document.getElementById('result-area');
            if (resultArea) resultArea.classList.add('hidden');
        }
        
        // 定义常量和映射关系
        const DIRECTION_MAP = {
            zi: '北方',
            chou: '东北方',
            yin: '东北方',
            mao: '东方',
            chen: '东南方',
            si: '东南方',
            wu: '南方',
            wei: '西南方',
            shen: '西南方',
            you: '西方',
            xu: '西北方',
            hai: '西北方'
        };
        
        const ELEMENT_BRANCHES = {
            wood: ['yin', 'mao', 'chen'],
            fire: ['si', 'wu', 'wei'],
            earth: ['chen', 'wei', 'xu', 'chou'],
            metal: ['shen', 'you', 'xu'],
            water: ['hai', 'zi', 'chou']
        };
        
        // 感情方位计算函数（简化版，直接使用五行）
        function calculatePosition(gender, dayMasterElement) {
            // 定义五行相克关系（金克木，木克土，土克水，水克火，火克金）
            const conqueringRelations = {
                metal: 'wood',
                wood: 'earth',
                earth: 'water',
                water: 'fire',
                fire: 'metal'
            };
            
            // 定义五行对应的方位键，考虑火土同宫
            const elementDirectionMap = {
                wood: ['east'],
                fire: ['south', 'local'],
                earth: ['south', 'local'],
                metal: ['west'],
                water: ['north']
            };
            
            // 根据性别和日主五行确定感情五行
            let soulmateElement;
            if (gender === 'male') {
                // 男命克者为妻
                soulmateElement = conqueringRelations[dayMasterElement];
            } else {
                // 女命被克者为夫（需要找到克自己的五行）
                for (const [element, conquered] of Object.entries(conqueringRelations)) {
                    if (conquered === dayMasterElement) {
                        soulmateElement = element;
                        break;
                    }
                }
            }
            
            // 获取感情对应的方位，并翻译成当前语言
            const directionKeys = elementDirectionMap[soulmateElement] || ['未知'];
            const directions = directionKeys.map(dirKey => translate(dirKey));
            
            // 生成解释
            const genderText = gender === 'male' ? translate('male') : translate('female');
            
            // 五行名称映射
            const elementNames = {
                wood: translate('wood'),
                fire: translate('fire'),
                earth: translate('earth'),
                metal: translate('metal'),
                water: translate('water')
            };
            
            const dayMasterElementName = elementNames[dayMasterElement] || dayMasterElement;
            const soulmateElementName = elementNames[soulmateElement] || soulmateElement;
            
            // 使用翻译模板生成解释文本
            let explanationTemplate;
            if (gender === 'male') {
                explanationTemplate = translate('malePositionExplanation');
            } else {
                explanationTemplate = translate('femalePositionExplanation');
            }
            
            // 替换模板中的变量
            let explanation = explanationTemplate
                .replace('{dayMasterElement}', dayMasterElementName)
                .replace('{gender}', genderText)
                .replace('{soulmateElement}', soulmateElementName)
                .replace('{directions}', directions.join('、'));
            
            return { direction: directions.join('、'), explanation };
        }
        
        // 获取地支的五行属性
        function getBranchElement(branch) {
            for (const [element, branches] of Object.entries(ELEMENT_BRANCHES)) {
                if (branches.includes(branch)) {
                    const elementMap = {
                        wood: '木',
                        fire: '火',
                        earth: '土',
                        metal: '金',
                        water: '水'
                    };
                    return elementMap[element];
                }
            }
            return '未知';
        }
        
        // 五行相克关系映射
        const controllingCycles = {
            wood: 'earth',
            fire: 'metal',
            earth: 'water',
            metal: 'wood',
            water: 'fire'
        };
        
        // 五行名称映射
        const elementNames = {
            wood: '木',
            fire: '火',
            earth: '土',
            metal: '金',
            water: '水'
        };
        
        // 方位五行映射
        const directionElements = {
            '东': 'wood',
            '南': 'fire',
            '西': 'metal',
            '北': 'water',
            '本地': 'earth'
        };
        
        // 城市经纬度数据库
        const cityCoordinates = {
            // 中国城市
            '北京': { lat: 39.9042, lng: 116.4074 },
            '东城区': { lat: 39.9289, lng: 116.4173 },
            '西城区': { lat: 39.9042, lng: 116.3688 },
            '朝阳区': { lat: 39.9489, lng: 116.4882 },
            '丰台区': { lat: 39.8650, lng: 116.2882 },
            '石景山区': { lat: 39.9140, lng: 116.1990 },
            '海淀区': { lat: 40.0025, lng: 116.3142 },
            '门头沟区': { lat: 39.9042, lng: 115.9519 },
            '房山区': { lat: 39.7400, lng: 115.9800 },
            '通州区': { lat: 39.9042, lng: 116.6553 },
            '顺义区': { lat: 40.1394, lng: 116.6553 },
            '昌平区': { lat: 40.2189, lng: 116.2315 },
            '大兴区': { lat: 39.7361, lng: 116.3333 },
            '怀柔区': { lat: 40.3250, lng: 116.6333 },
            '平谷区': { lat: 40.1394, lng: 117.1289 },
            '密云区': { lat: 40.3750, lng: 116.8417 },
            '延庆区': { lat: 40.4606, lng: 115.9833 },
            '上海': { lat: 31.2304, lng: 121.4737 },
            // 上海市辖区
            '黄浦区': { lat: 31.2317, lng: 121.4726 },
            '徐汇区': { lat: 31.1957, lng: 121.4369 },
            '长宁区': { lat: 31.2142, lng: 121.4290 },
            '静安区': { lat: 31.2330, lng: 121.4580 },
            '普陀区': { lat: 31.2394, lng: 121.4280 },
            '虹口区': { lat: 31.2643, lng: 121.4764 },
            '杨浦区': { lat: 31.2714, lng: 121.5037 },
            '浦东新区': { lat: 31.2304, lng: 121.5090 },
            '闵行区': { lat: 31.1093, lng: 121.3833 },
            '宝山区': { lat: 31.3812, lng: 121.4880 },
            '嘉定区': { lat: 31.2338, lng: 121.2370 },
            '金山区': { lat: 30.8958, lng: 121.1420 },
            '松江区': { lat: 31.0067, lng: 121.2420 },
            '青浦区': { lat: 31.1530, lng: 121.1320 },
            '奉贤区': { lat: 30.9167, lng: 121.4667 },
            '崇明区': { lat: 31.6213, lng: 121.4067 },
            // 天津市辖区
            '和平区': { lat: 39.1334, lng: 117.1902 },
            '河东区': { lat: 39.1287, lng: 117.2308 },
            '河西区': { lat: 39.0841, lng: 117.2169 },
            '南开区': { lat: 39.1253, lng: 117.1893 },
            '河北区': { lat: 39.1470, lng: 117.2016 },
            '红桥区': { lat: 39.1411, lng: 117.1636 },
            '东丽区': { lat: 39.0930, lng: 117.3435 },
            '西青区': { lat: 39.0958, lng: 117.0753 },
            '津南区': { lat: 38.9513, lng: 117.3280 },
            '北辰区': { lat: 39.2383, lng: 117.1902 },
            '武清区': { lat: 39.3631, lng: 117.0592 },
            '宝坻区': { lat: 39.7150, lng: 117.3100 },
            '滨海新区': { lat: 39.0333, lng: 117.6167 },
            '宁河区': { lat: 39.3333, lng: 117.8333 },
            '静海区': { lat: 38.9333, lng: 116.9000 },
            '蓟州区': { lat: 40.0500, lng: 117.4000 },
            // 重庆市辖区
            '渝中区': { lat: 29.5630, lng: 106.5515 },
            '江北区': { lat: 29.5850, lng: 106.5800 },
            '渝北区': { lat: 29.6000, lng: 106.6333 },
            '九龙坡区': { lat: 29.5167, lng: 106.4667 },
            '沙坪坝区': { lat: 29.5667, lng: 106.4000 },
            '南岸区': { lat: 29.5000, lng: 106.5833 },
            '巴南区': { lat: 29.3167, lng: 106.5000 },
            '北碚区': { lat: 29.8333, lng: 106.3000 },
            '大渡口区': { lat: 29.4833, lng: 106.4333 },
            '万州区': { lat: 30.8333, lng: 108.3500 },
            '涪陵区': { lat: 29.7000, lng: 107.3500 },
            '永川区': { lat: 29.3500, lng: 105.7500 },
            '江津区': { lat: 29.1833, lng: 106.1500 },
            '合川区': { lat: 29.9000, lng: 106.2833 },
            '南川区': { lat: 29.1000, lng: 107.1000 },
            '綦江区': { lat: 29.0000, lng: 106.6500 },
            '大足区': { lat: 29.4000, lng: 105.7000 },
            '璧山区': { lat: 29.5667, lng: 106.2333 },
            '铜梁区': { lat: 29.8000, lng: 105.8333 },
            '潼南区': { lat: 30.1500, lng: 105.8500 },
            '荣昌区': { lat: 29.6167, lng: 105.5333 },
            '开州区': { lat: 31.1667, lng: 108.3833 },
            '梁平区': { lat: 30.6667, lng: 107.7500 },
            '武隆区': { lat: 29.2833, lng: 107.7833 },
            '城口县': { lat: 31.9000, lng: 108.6500 },
            '丰都县': { lat: 29.8333, lng: 107.7000 },
            '垫江县': { lat: 30.3333, lng: 107.3333 },
            '忠县': { lat: 30.3833, lng: 108.0333 },
            '云阳县': { lat: 30.9500, lng: 108.7833 },
            '奉节县': { lat: 31.0667, lng: 109.5000 },
            '巫山县': { lat: 31.0833, lng: 109.8667 },
            '巫溪县': { lat: 31.4333, lng: 109.6333 },
            '石柱土家族自治县': { lat: 29.9833, lng: 108.1333 },
            '秀山土家族苗族自治县': { lat: 28.4500, lng: 108.9833 },
            '酉阳土家族苗族自治县': { lat: 28.8500, lng: 108.7500 },
            '彭水苗族土家族自治县': { lat: 29.2833, lng: 108.1833 },
            // 河北省地级市
            '石家庄': { lat: 38.0428, lng: 114.5149 },
            '唐山': { lat: 39.6333, lng: 118.1667 },
            '秦皇岛': { lat: 39.9312, lng: 119.5853 },
            '邯郸': { lat: 36.6167, lng: 114.4667 },
            '邢台': { lat: 37.0667, lng: 114.5000 },
            '保定': { lat: 38.8610, lng: 115.4805 },
            '张家口': { lat: 40.8244, lng: 114.8744 },
            '承德': { lat: 40.9798, lng: 117.9090 },
            '沧州': { lat: 38.3000, lng: 116.8333 },
            '廊坊': { lat: 39.5333, lng: 116.7000 },
            '衡水': { lat: 37.7297, lng: 115.7219 },
            // 山西省地级市
            '太原': { lat: 37.8716, lng: 112.5489 },
            '大同': { lat: 40.0783, lng: 113.3094 },
            '阳泉': { lat: 37.8573, lng: 113.5786 },
            '长治': { lat: 36.1850, lng: 113.1333 },
            '晋城': { lat: 35.4833, lng: 112.8333 },
            '朔州': { lat: 39.3000, lng: 112.4333 },
            '晋中': { lat: 37.6813, lng: 112.7322 },
            '运城': { lat: 35.0389, lng: 111.0194 },
            '忻州': { lat: 38.4181, lng: 112.7272 },
            '临汾': { lat: 36.0800, lng: 111.5000 },
            '吕梁': { lat: 37.5167, lng: 111.1000 },
            // 辽宁省地级市
            '沈阳': { lat: 41.8057, lng: 123.4315 },
            '大连': { lat: 38.9140, lng: 121.6147 },
            '鞍山': { lat: 41.1106, lng: 122.9958 },
            '抚顺': { lat: 41.8642, lng: 123.9708 },
            '本溪': { lat: 41.3000, lng: 123.7500 },
            '丹东': { lat: 40.1333, lng: 124.3333 },
            '锦州': { lat: 41.1333, lng: 121.1500 },
            '营口': { lat: 40.6667, lng: 122.2000 },
            '阜新': { lat: 42.0000, lng: 121.6167 },
            '辽阳': { lat: 41.2667, lng: 123.1500 },
            '盘锦': { lat: 41.1167, lng: 122.0000 },
            '铁岭': { lat: 42.3333, lng: 123.8500 },
            '朝阳': { lat: 41.5750, lng: 120.4583 },
            '葫芦岛': { lat: 40.7500, lng: 120.8333 },
            // 吉林省地级市
            '长春': { lat: 43.8170, lng: 125.3235 },
            '吉林': { lat: 43.8170, lng: 125.3235 },
            '四平': { lat: 43.1667, lng: 124.3500 },
            '辽源': { lat: 42.9000, lng: 125.1500 },
            '通化': { lat: 41.7667, lng: 125.9000 },
            '白山': { lat: 41.9333, lng: 126.4333 },
            '松原': { lat: 45.1333, lng: 124.8000 },
            '白城': { lat: 45.6333, lng: 122.8333 },
            '延边': { lat: 42.9333, lng: 129.5167 },
            // 黑龙江省地级市
            '哈尔滨': { lat: 45.8038, lng: 126.5349 },
            '齐齐哈尔': { lat: 47.3333, lng: 123.9000 },
            '鸡西': { lat: 45.3000, lng: 130.9000 },
            '鹤岗': { lat: 47.3333, lng: 130.3000 },
            '双鸭山': { lat: 46.6333, lng: 131.1000 },
            '大庆': { lat: 46.5833, lng: 125.0000 },
            '伊春': { lat: 47.7333, lng: 128.9000 },
            '佳木斯': { lat: 46.8000, lng: 130.3500 },
            '七台河': { lat: 45.7833, lng: 131.0500 },
            '牡丹江': { lat: 44.5833, lng: 129.6000 },
            '黑河': { lat: 50.2333, lng: 127.4000 },
            '绥化': { lat: 46.6333, lng: 126.9000 },
            '大兴安岭': { lat: 52.3333, lng: 124.0000 },
            // 江苏省地级市
            '南京': { lat: 32.0603, lng: 118.7969 },
            '无锡': { lat: 31.5908, lng: 120.2985 },
            '徐州': { lat: 34.2632, lng: 117.1851 },
            '常州': { lat: 31.7899, lng: 119.9573 },
            '苏州': { lat: 31.2989, lng: 120.5853 },
            '南通': { lat: 32.0165, lng: 120.8646 },
            '连云港': { lat: 34.6000, lng: 119.1667 },
            '淮安': { lat: 33.5907, lng: 119.0214 },
            '盐城': { lat: 33.3872, lng: 120.1300 },
            '扬州': { lat: 32.3933, lng: 119.4286 },
            '镇江': { lat: 32.2000, lng: 119.4500 },
            '泰州': { lat: 32.4333, lng: 119.9000 },
            '宿迁': { lat: 33.9667, lng: 118.2000 },
            // 浙江省地级市
            '杭州': { lat: 30.2741, lng: 120.1551 },
            '宁波': { lat: 29.8683, lng: 121.5440 },
            '温州': { lat: 28.0100, lng: 120.6500 },
            '嘉兴': { lat: 30.7628, lng: 120.7694 },
            '湖州': { lat: 30.8683, lng: 120.0536 },
            '绍兴': { lat: 30.0000, lng: 120.5833 },
            '金华': { lat: 29.1250, lng: 119.6250 },
            '衢州': { lat: 28.9000, lng: 118.8833 },
            '舟山': { lat: 30.0333, lng: 122.1167 },
            '台州': { lat: 28.6667, lng: 121.4000 },
            '丽水': { lat: 28.4500, lng: 119.9250 },
            // 安徽省地级市
            '合肥': { lat: 31.8206, lng: 117.2272 },
            '芜湖': { lat: 31.3500, lng: 118.3833 },
            '蚌埠': { lat: 32.9333, lng: 117.3333 },
            '淮南': { lat: 32.6500, lng: 116.9167 },
            '马鞍山': { lat: 31.6833, lng: 118.4833 },
            '淮北': { lat: 33.9500, lng: 116.7833 },
            '铜陵': { lat: 30.9333, lng: 117.8167 },
            '安庆': { lat: 30.5333, lng: 117.0333 },
            '黄山': { lat: 29.7167, lng: 118.3167 },
            '滁州': { lat: 32.3333, lng: 118.3000 },
            '阜阳': { lat: 32.8900, lng: 115.8167 },
            '宿州': { lat: 33.6333, lng: 116.9000 },
            '六安': { lat: 31.7500, lng: 116.5000 },
            '亳州': { lat: 33.8667, lng: 115.7833 },
            '池州': { lat: 30.6667, lng: 117.4833 },
            '宣城': { lat: 30.9500, lng: 118.7500 },
            // 福建省地级市
            '福州': { lat: 26.0745, lng: 119.2965 },
            '厦门': { lat: 24.4798, lng: 118.0894 },
            '莆田': { lat: 25.4333, lng: 119.0000 },
            '三明': { lat: 26.2500, lng: 117.6167 },
            '泉州': { lat: 24.8667, lng: 118.6167 },
            '漳州': { lat: 24.5167, lng: 117.6167 },
            '南平': { lat: 26.6167, lng: 118.1500 },
            '龙岩': { lat: 25.0833, lng: 117.0167 },
            '宁德': { lat: 26.6500, lng: 119.5333 },
            // 江西省地级市
            '南昌': { lat: 28.6822, lng: 115.8581 },
            '景德镇': { lat: 29.3000, lng: 117.2000 },
            '萍乡': { lat: 27.6333, lng: 113.8000 },
            '九江': { lat: 29.7167, lng: 115.9000 },
            '新余': { lat: 27.8167, lng: 114.9167 },
            '鹰潭': { lat: 28.2333, lng: 117.0167 },
            '赣州': { lat: 25.8500, lng: 114.9000 },
            '吉安': { lat: 27.1833, lng: 114.9667 },
            '宜春': { lat: 27.8000, lng: 114.3000 },
            '抚州': { lat: 27.9417, lng: 116.3417 },
            '上饶': { lat: 28.4500, lng: 117.9750 },
            // 山东省地级市
            '济南': { lat: 36.6519, lng: 117.1201 },
            '青岛': { lat: 36.0671, lng: 120.3826 },
            '淄博': { lat: 36.8000, lng: 118.0500 },
            '枣庄': { lat: 34.8667, lng: 117.5333 },
            '东营': { lat: 37.4667, lng: 118.4000 },
            '烟台': { lat: 37.5333, lng: 121.4000 },
            '潍坊': { lat: 36.7000, lng: 119.1333 },
            '济宁': { lat: 35.4000, lng: 116.5833 },
            '泰安': { lat: 36.1833, lng: 117.1333 },
            '威海': { lat: 37.5000, lng: 122.1000 },
            '日照': { lat: 35.4200, lng: 119.4600 },
            '莱芜': { lat: 36.2000, lng: 117.7000 },
            '临沂': { lat: 35.0500, lng: 118.3500 },
            '德州': { lat: 37.4500, lng: 116.3000 },
            '聊城': { lat: 36.4500, lng: 115.9500 },
            '滨州': { lat: 37.3667, lng: 117.9833 },
            '菏泽': { lat: 35.2400, lng: 115.4800 },
            // 湖北省地级市
            '武汉': { lat: 30.5928, lng: 114.3055 },
            '黄石': { lat: 30.2000, lng: 115.0000 },
            '十堰': { lat: 32.6000, lng: 110.7833 },
            '宜昌': { lat: 30.7000, lng: 111.3000 },
            '襄阳': { lat: 32.0667, lng: 112.1500 },
            '鄂州': { lat: 30.3500, lng: 114.8500 },
            '荆门': { lat: 31.0333, lng: 112.2000 },
            '孝感': { lat: 30.9200, lng: 113.9200 },
            '荆州': { lat: 30.3351, lng: 112.2472 },
            '黄冈': { lat: 30.4500, lng: 114.8700 },
            '咸宁': { lat: 29.8500, lng: 114.2700 },
            '随州': { lat: 31.7333, lng: 113.3833 },
            '恩施': { lat: 30.2700, lng: 109.4800 },
            '神农架': { lat: 31.7500, lng: 110.4000 },
            // 湖南省地级市
            '长沙': { lat: 28.2278, lng: 112.9388 },
            '株洲': { lat: 27.8333, lng: 113.1667 },
            '湘潭': { lat: 27.8767, lng: 112.9358 },
            '衡阳': { lat: 26.9000, lng: 112.5833 },
            '邵阳': { lat: 27.2333, lng: 111.4667 },
            '岳阳': { lat: 29.3500, lng: 113.1250 },
            '常德': { lat: 29.0500, lng: 111.6917 },
            '张家界': { lat: 29.1333, lng: 110.4833 },
            '益阳': { lat: 28.5667, lng: 112.3333 },
            '郴州': { lat: 25.7833, lng: 113.0250 },
            '永州': { lat: 26.4250, lng: 111.6167 },
            '怀化': { lat: 27.5500, lng: 109.9667 },
            '娄底': { lat: 27.7167, lng: 112.0000 },
            '湘西': { lat: 28.2708, lng: 109.7375 },
            // 广东省地级市
            '广州': { lat: 23.1291, lng: 113.2644 },
            '深圳': { lat: 22.5431, lng: 114.0579 },
            '珠海': { lat: 22.1987, lng: 113.5493 },
            '汕头': { lat: 23.3500, lng: 116.6000 },
            '佛山': { lat: 23.0200, lng: 113.1167 },
            '韶关': { lat: 24.8167, lng: 113.6000 },
            '湛江': { lat: 21.2167, lng: 110.3667 },
            '肇庆': { lat: 23.0500, lng: 112.4833 },
            '江门': { lat: 22.5700, lng: 113.0900 },
            '茂名': { lat: 21.6667, lng: 110.8333 },
            '惠州': { lat: 23.0969, lng: 114.4095 },
            '梅州': { lat: 24.2900, lng: 116.1000 },
            '汕尾': { lat: 22.7700, lng: 115.3700 },
            '河源': { lat: 23.7300, lng: 114.6800 },
            '阳江': { lat: 21.8500, lng: 111.9500 },
            '清远': { lat: 23.7000, lng: 113.0000 },
            '东莞': { lat: 23.0458, lng: 113.7431 },
            '中山': { lat: 22.5286, lng: 113.3931 },
            '潮州': { lat: 23.6667, lng: 116.6000 },
            '揭阳': { lat: 23.5500, lng: 116.3500 },
            '云浮': { lat: 22.9333, lng: 112.0833 },
            // 海南省城市
            '海口': { lat: 20.0440, lng: 110.3490 },
            '三亚': { lat: 18.2500, lng: 109.5000 },
            '三沙': { lat: 16.8300, lng: 112.3600 },
            '儋州': { lat: 19.5100, lng: 109.5600 },
            '五指山': { lat: 18.7700, lng: 109.5100 },
            '琼海': { lat: 19.2500, lng: 110.4600 },
            '文昌': { lat: 19.6100, lng: 110.7100 },
            '万宁': { lat: 18.8000, lng: 110.3900 },
            '东方': { lat: 19.0900, lng: 108.6000 },
            '定安': { lat: 19.6800, lng: 110.3100 },
            '屯昌': { lat: 19.3600, lng: 110.1300 },
            '澄迈': { lat: 19.7500, lng: 110.0000 },
            '临高': { lat: 19.9100, lng: 109.6900 },
            '白沙': { lat: 19.2000, lng: 109.4500 },
            '昌江': { lat: 19.2500, lng: 109.0300 },
            '乐东': { lat: 18.7300, lng: 109.1900 },
            '陵水': { lat: 18.4800, lng: 109.9100 },
            '保亭': { lat: 18.6400, lng: 109.7000 },
            '琼中': { lat: 19.0000, lng: 109.8300 },
            // 四川省地级市
            '成都': { lat: 30.5728, lng: 104.0668 },
            '自贡': { lat: 29.3500, lng: 104.7700 },
            '攀枝花': { lat: 26.5800, lng: 101.7100 },
            '泸州': { lat: 28.8800, lng: 105.4400 },
            '德阳': { lat: 31.1300, lng: 104.3800 },
            '绵阳': { lat: 31.4639, lng: 104.7510 },
            '广元': { lat: 32.4300, lng: 105.8300 },
            '遂宁': { lat: 30.5000, lng: 105.5800 },
            '内江': { lat: 29.5900, lng: 105.0600 },
            '乐山': { lat: 29.5700, lng: 103.7700 },
            '南充': { lat: 30.8000, lng: 106.1100 },
            '眉山': { lat: 30.0500, lng: 103.8600 },
            '宜宾': { lat: 28.7600, lng: 104.6300 },
            '广安': { lat: 30.4800, lng: 106.6100 },
            '达州': { lat: 31.2000, lng: 107.5000 },
            '雅安': { lat: 30.0000, lng: 103.0000 },
            '巴中': { lat: 31.8500, lng: 106.7300 },
            '资阳': { lat: 30.1200, lng: 104.6500 },
            '阿坝': { lat: 32.9500, lng: 101.9200 },
            '甘孜': { lat: 31.6000, lng: 100.2000 },
            '凉山': { lat: 27.8000, lng: 102.2500 },
            // 贵州省地级市
            '贵阳': { lat: 26.5783, lng: 106.7078 },
            '六盘水': { lat: 26.5900, lng: 104.8000 },
            '遵义': { lat: 27.7000, lng: 106.9000 },
            '安顺': { lat: 26.2500, lng: 105.9200 },
            '毕节': { lat: 27.3000, lng: 105.3800 },
            '铜仁': { lat: 27.7300, lng: 109.1100 },
            '黔东南': { lat: 26.5800, lng: 108.0200 },
            '黔南': { lat: 26.1500, lng: 107.5200 },
            '黔西南': { lat: 25.0500, lng: 104.9000 },
            // 云南省地级市
            '昆明': { lat: 25.0453, lng: 102.7126 },
            '曲靖': { lat: 25.5000, lng: 103.7000 },
            '玉溪': { lat: 24.3500, lng: 102.5200 },
            '保山': { lat: 25.1200, lng: 99.1100 },
            '昭通': { lat: 27.3300, lng: 103.7000 },
            '丽江': { lat: 26.8600, lng: 100.2500 },
            '普洱': { lat: 22.7900, lng: 100.9700 },
            '临沧': { lat: 23.8800, lng: 100.0800 },
            '楚雄': { lat: 25.0200, lng: 101.5200 },
            '红河': { lat: 23.3600, lng: 103.2400 },
            '文山': { lat: 23.3700, lng: 104.2500 },
            '西双版纳': { lat: 22.0000, lng: 100.8000 },
            '大理': { lat: 25.6900, lng: 100.1800 },
            '德宏': { lat: 24.4400, lng: 98.5800 },
            '怒江': { lat: 25.8700, lng: 98.8700 },
            '迪庆': { lat: 27.8300, lng: 99.7000 },
            // 西藏自治区地级市
            '拉萨': { lat: 29.6500, lng: 91.1628 },
            '日喀则': { lat: 29.2600, lng: 88.8800 },
            '昌都': { lat: 31.1500, lng: 97.1800 },
            '林芝': { lat: 29.5000, lng: 94.3300 },
            '山南': { lat: 29.2800, lng: 91.7700 },
            '那曲': { lat: 31.4800, lng: 92.0000 },
            '阿里': { lat: 32.5000, lng: 80.1800 },
            // 陕西省地级市
            '西安': { lat: 34.3416, lng: 108.9398 },
            '铜川': { lat: 35.0800, lng: 109.0800 },
            '宝鸡': { lat: 34.3600, lng: 107.1500 },
            '咸阳': { lat: 34.3400, lng: 108.7000 },
            '渭南': { lat: 34.5100, lng: 109.5000 },
            '延安': { lat: 36.5000, lng: 109.4700 },
            '汉中': { lat: 33.0700, lng: 107.0300 },
            '榆林': { lat: 38.2700, lng: 109.7400 },
            '安康': { lat: 32.6900, lng: 109.0200 },
            '商洛': { lat: 33.8700, lng: 109.9600 },
            // 甘肃省地级市
            '兰州': { lat: 36.0611, lng: 103.8343 },
            '嘉峪关': { lat: 39.7833, lng: 98.1833 },
            '金昌': { lat: 38.5000, lng: 102.1800 },
            '白银': { lat: 36.5500, lng: 104.1200 },
            '天水': { lat: 34.6000, lng: 105.7200 },
            '武威': { lat: 37.9200, lng: 102.6300 },
            '张掖': { lat: 38.9300, lng: 100.4500 },
            '平凉': { lat: 35.5400, lng: 106.6800 },
            '酒泉': { lat: 39.7400, lng: 98.5000 },
            '庆阳': { lat: 35.7200, lng: 107.6800 },
            '定西': { lat: 35.5700, lng: 104.6200 },
            '陇南': { lat: 33.3800, lng: 104.9000 },
            '临夏': { lat: 35.6000, lng: 103.2200 },
            '甘南': { lat: 34.9200, lng: 102.9200 },
            // 青海省地级市
            '西宁': { lat: 36.6172, lng: 101.7782 },
            '海东': { lat: 36.2600, lng: 102.0700 },
            '海北': { lat: 37.3800, lng: 100.9000 },
            '黄南': { lat: 35.5200, lng: 102.0000 },
            '海南': { lat: 36.2800, lng: 100.5800 },
            '果洛': { lat: 34.4800, lng: 100.2500 },
            '玉树': { lat: 33.0000, lng: 97.0000 },
            '海西': { lat: 36.4000, lng: 95.9000 },
            // 宁夏回族自治区地级市
            '银川': { lat: 38.4680, lng: 106.2418 },
            '石嘴山': { lat: 39.0200, lng: 106.3900 },
            '吴忠': { lat: 37.9900, lng: 106.2100 },
            '固原': { lat: 36.0100, lng: 106.2800 },
            '中卫': { lat: 37.5100, lng: 105.1900 },
            // 新疆维吾尔自治区地级市
            '乌鲁木齐': { lat: 43.8256, lng: 87.6168 },
            '克拉玛依': { lat: 45.5900, lng: 84.8700 },
            '吐鲁番': { lat: 42.9300, lng: 89.1500 },
            '哈密': { lat: 42.8000, lng: 93.4500 },
            '昌吉': { lat: 44.0200, lng: 87.3100 },
            '博尔塔拉': { lat: 44.9000, lng: 82.1000 },
            '巴音郭楞': { lat: 41.7600, lng: 86.1400 },
            '阿克苏': { lat: 41.1500, lng: 80.2500 },
            '克孜勒苏': { lat: 39.7000, lng: 76.1200 },
            '喀什': { lat: 39.4500, lng: 75.9800 },
            '和田': { lat: 37.1200, lng: 79.9200 },
            '伊犁': { lat: 43.9000, lng: 81.3300 },
            '塔城': { lat: 46.7300, lng: 82.9300 },
            '阿勒泰': { lat: 47.8600, lng: 88.1600 },
            '石河子': { lat: 44.2900, lng: 85.9400 },
            '阿拉尔': { lat: 40.5300, lng: 81.2800 },
            '图木舒克': { lat: 39.8000, lng: 79.0600 },
            '五家渠': { lat: 44.1500, lng: 87.5300 },
            '北屯': { lat: 47.3700, lng: 87.8600 },
            '铁门关': { lat: 41.7900, lng: 85.8700 },
            '双河': { lat: 44.7800, lng: 82.2800 },
            '可克达拉': { lat: 44.1200, lng: 81.0200 },
            '昆玉': { lat: 37.1000, lng: 79.0300 },
            '胡杨河': { lat: 44.8300, lng: 84.7500 },
            '新星': { lat: 42.8000, lng: 91.2500 },
            // 内蒙古自治区地级市
            '呼和浩特': { lat: 40.8183, lng: 111.7519 },
            '包头': { lat: 40.6500, lng: 109.8300 },
            '乌海': { lat: 39.6400, lng: 106.8300 },
            '赤峰': { lat: 42.2700, lng: 118.9300 },
            '通辽': { lat: 43.6100, lng: 122.2800 },
            '鄂尔多斯': { lat: 39.8100, lng: 109.7900 },
            '呼伦贝尔': { lat: 49.2000, lng: 119.7000 },
            '巴彦淖尔': { lat: 40.7500, lng: 107.3800 },
            '乌兰察布': { lat: 41.0300, lng: 113.1000 },
            '兴安': { lat: 46.0900, lng: 122.0800 },
            '锡林郭勒': { lat: 43.9300, lng: 116.0800 },
            '阿拉善': { lat: 38.8300, lng: 105.6800 },
            // 广西壮族自治区地级市
            '南宁': { lat: 22.8170, lng: 108.3661 },
            '柳州': { lat: 23.6288, lng: 109.3795 },
            '桂林': { lat: 25.2744, lng: 110.2925 },
            '梧州': { lat: 23.4798, lng: 111.3598 },
            '北海': { lat: 21.4817, lng: 109.1172 },
            '防城港': { lat: 21.6200, lng: 108.3600 },
            '钦州': { lat: 21.9700, lng: 108.6200 },
            '贵港': { lat: 23.1100, lng: 109.6000 },
            '玉林': { lat: 22.6300, lng: 110.1500 },
            '百色': { lat: 23.9000, lng: 106.6100 },
            '贺州': { lat: 24.4000, lng: 111.5500 },
            '河池': { lat: 24.7000, lng: 108.0500 },
            '来宾': { lat: 23.7500, lng: 109.2300 },
            '崇左': { lat: 22.3600, lng: 107.3600 },
            // 香港特别行政区
            '香港': { lat: 22.3193, lng: 114.1694 },
            // 香港特别行政区辖区
            '中西区': { lat: 22.2833, lng: 114.1500 },
            '东区': { lat: 22.2833, lng: 114.2250 },
            '南区': { lat: 22.2417, lng: 114.1583 },
            '湾仔区': { lat: 22.2750, lng: 114.1833 },
            '九龙城区': { lat: 22.3333, lng: 114.1833 },
            '观塘区': { lat: 22.3167, lng: 114.2250 },
            '深水埗区': { lat: 22.3333, lng: 114.1500 },
            '黄大仙区': { lat: 22.3500, lng: 114.1833 },
            '油尖旺区': { lat: 22.3000, lng: 114.1667 },
            '离岛区': { lat: 22.2333, lng: 113.9333 },
            '葵青区': { lat: 22.3500, lng: 114.1000 },
            '北区': { lat: 22.4500, lng: 114.1000 },
            '西贡区': { lat: 22.3667, lng: 114.2667 },
            '沙田区': { lat: 22.3833, lng: 114.1833 },
            '大埔区': { lat: 22.4333, lng: 114.1333 },
            '荃湾区': { lat: 22.3750, lng: 114.1167 },
            '屯门区': { lat: 22.3750, lng: 113.9500 },
            '元朗区': { lat: 22.4167, lng: 114.0000 },
            // 澳门特别行政区
            '澳门': { lat: 22.1987, lng: 113.5493 },
            // 澳门特别行政区堂区
            '花地玛堂区': { lat: 22.1987, lng: 113.5493 },
            '圣安多尼堂区': { lat: 22.1987, lng: 113.5493 },
            '大堂区': { lat: 22.1987, lng: 113.5493 },
            '望德堂区': { lat: 22.1987, lng: 113.5493 },
            '风顺堂区': { lat: 22.1987, lng: 113.5493 },
            '嘉模堂区': { lat: 22.1987, lng: 113.5493 },
            '圣方济各堂区': { lat: 22.1987, lng: 113.5493 },
            '路氹填海区': { lat: 22.1987, lng: 113.5493 },
            '重庆': { lat: 29.4316, lng: 106.9123 },
            '天津': { lat: 39.3434, lng: 117.3616 },
            '南京': { lat: 32.0603, lng: 118.7969 },
            '苏州': { lat: 31.2989, lng: 120.5853 },
            '郑州': { lat: 34.7466, lng: 113.6254 },
            '长沙': { lat: 28.2278, lng: 112.9388 },
            '沈阳': { lat: 41.8057, lng: 123.4315 },
            '青岛': { lat: 36.0671, lng: 120.3826 },
            '济南': { lat: 36.6519, lng: 117.1201 },
            '哈尔滨': { lat: 45.8038, lng: 126.5349 },
            '福州': { lat: 26.0745, lng: 119.2965 },
            '厦门': { lat: 24.4798, lng: 118.0894 },
            '昆明': { lat: 25.0453, lng: 102.7126 },
            '南昌': { lat: 28.6822, lng: 115.8581 },
            '贵阳': { lat: 26.5783, lng: 106.7078 },
            '太原': { lat: 37.8716, lng: 112.5489 },
            '石家庄': { lat: 38.0428, lng: 114.5149 },
            '南宁': { lat: 22.8170, lng: 108.3661 },
            '兰州': { lat: 36.0611, lng: 103.8343 },
            '银川': { lat: 38.4680, lng: 106.2418 },
            '西宁': { lat: 36.6172, lng: 101.7782 },
            '乌鲁木齐': { lat: 43.8256, lng: 87.6168 },
            '拉萨': { lat: 29.6500, lng: 91.1628 },
            '呼和浩特': { lat: 40.8183, lng: 111.7519 },
            '长春': { lat: 43.8170, lng: 125.3235 },
            '合肥': { lat: 31.8206, lng: 117.2272 },
            '海口': { lat: 20.0440, lng: 110.3490 },
            '三亚': { lat: 18.2500, lng: 109.5000 },
            '洛阳': { lat: 34.6236, lng: 112.4324 },
            '开封': { lat: 34.7990, lng: 114.3594 },
            '安阳': { lat: 36.1051, lng: 114.3580 },
            '新乡': { lat: 35.3072, lng: 113.8755 },
            '焦作': { lat: 35.2473, lng: 113.2493 },
            '濮阳': { lat: 35.7767, lng: 115.0078 },
            '许昌': { lat: 34.0128, lng: 113.8184 },
            '漯河': { lat: 33.5668, lng: 114.0224 },
            '三门峡': { lat: 34.7735, lng: 111.1190 },
            '南阳': { lat: 33.0158, lng: 112.5397 },
            '商丘': { lat: 34.4351, lng: 115.6581 },
            '信阳': { lat: 32.1393, lng: 114.0820 },
            '周口': { lat: 33.6251, lng: 114.6568 },
            '驻马店': { lat: 32.9896, lng: 114.0199 },
            '济源': { lat: 35.0873, lng: 112.5973 },
            '平顶山': { lat: 33.7573, lng: 113.2952 },
            '鹤壁': { lat: 35.7387, lng: 114.2781 },
            '荆州': { lat: 30.3351, lng: 112.2472 },
            '西安': { lat: 34.3416, lng: 108.9398 },
            '湖北': { lat: 30.5928, lng: 114.3055 },
            '湖南': { lat: 28.2278, lng: 112.9388 },
            '河南': { lat: 34.7466, lng: 113.6254 },
            '河北': { lat: 38.0428, lng: 114.5149 },
            '山东': { lat: 36.6519, lng: 117.1201 },
            '山西': { lat: 37.8716, lng: 112.5489 },
            '陕西': { lat: 34.3416, lng: 108.9398 },
            '甘肃': { lat: 36.0611, lng: 103.8343 },
            '青海': { lat: 36.6172, lng: 101.7782 },
            '四川': { lat: 30.5728, lng: 104.0668 },
            '云南': { lat: 25.0453, lng: 102.7126 },
            '贵州': { lat: 26.5783, lng: 106.7078 },
            '西藏': { lat: 29.6500, lng: 91.1628 },
            '新疆': { lat: 43.8256, lng: 87.6168 },
            '广西': { lat: 22.8170, lng: 108.3661 },
            '广东': { lat: 23.1291, lng: 113.2644 },
            '海南': { lat: 20.0440, lng: 110.3490 },
            '福建': { lat: 26.0745, lng: 119.2965 },
            '江西': { lat: 28.6822, lng: 115.8581 },
            '安徽': { lat: 31.8206, lng: 117.2272 },
            '浙江': { lat: 30.2741, lng: 120.1551 },
            '江苏': { lat: 32.0603, lng: 118.7969 },
            '黑龙江': { lat: 45.8038, lng: 126.5349 },
            '吉林': { lat: 43.8170, lng: 125.3235 },
            '辽宁': { lat: 41.8057, lng: 123.4315 },
            '内蒙古': { lat: 40.8183, lng: 111.7519 },
            '宁夏': { lat: 38.4680, lng: 106.2418 },
            '香港': { lat: 22.3193, lng: 114.1694 },
            '澳门': { lat: 22.1987, lng: 113.5493 },
            '台湾': { lat: 23.6978, lng: 120.9605 },
            // 中国县级市 - 按省份分类
            // 江苏省县级市
            '无锡': { lat: 31.5908, lng: 120.2985 },
            '昆山': { lat: 31.3989, lng: 120.9853 },
            '江阴': { lat: 31.9167, lng: 120.2947 },
            '张家港': { lat: 31.8542, lng: 120.5514 },
            '常熟': { lat: 31.6492, lng: 120.7574 },
            '太仓': { lat: 31.4567, lng: 121.1181 },
            '宜兴': { lat: 31.3592, lng: 119.8153 },
            // 江苏省县城
            '丰县': { lat: 34.7000, lng: 116.5000 },
            '沛县': { lat: 34.7333, lng: 116.9167 },
            '睢宁县': { lat: 33.9500, lng: 117.9167 },
            '如东县': { lat: 32.3333, lng: 121.1500 },
            '海安县': { lat: 32.5700, lng: 120.4500 },
            '启东市': { lat: 31.8000, lng: 121.6667 },
            '如皋市': { lat: 32.3833, lng: 120.5333 },
            '海门市': { lat: 31.9667, lng: 121.1500 },
            '东海县': { lat: 34.5000, lng: 118.7500 },
            '灌云县': { lat: 34.3000, lng: 119.2000 },
            '灌南县': { lat: 34.3333, lng: 119.5500 },
            '赣榆区': { lat: 34.8333, lng: 119.1667 },
            // 浙江省县级市
            '义乌': { lat: 29.3292, lng: 120.0934 },
            '诸暨': { lat: 29.7111, lng: 120.2344 },
            '余姚': { lat: 30.0458, lng: 121.1558 },
            '慈溪': { lat: 30.1833, lng: 121.2333 },
            '乐清': { lat: 28.1467, lng: 120.9458 },
            '瑞安': { lat: 27.7767, lng: 120.6533 },
            // 广东省县级市
            '顺德': { lat: 22.8076, lng: 113.2894 },
            '南海': { lat: 23.0347, lng: 113.1222 },
            '东莞': { lat: 23.0458, lng: 113.7431 },
            '中山': { lat: 22.5286, lng: 113.3931 },
            '普宁': { lat: 23.2881, lng: 116.1000 },
            '四会': { lat: 23.3500, lng: 112.6167 },
            // 山东省县级市
            '即墨': { lat: 36.3833, lng: 120.4903 },
            '胶州': { lat: 36.2875, lng: 120.0481 },
            '平度': { lat: 36.7667, lng: 119.9781 },
            '莱西': { lat: 36.8667, lng: 120.5203 },
            '滕州': { lat: 35.0981, lng: 117.1747 },
            '龙口': { lat: 37.6425, lng: 120.5175 },
            // 山东省县城
            '平阴县': { lat: 36.2833, lng: 116.4667 },
            '济阳县': { lat: 36.9500, lng: 117.1333 },
            '商河县': { lat: 37.3167, lng: 117.1167 },
            '桓台县': { lat: 36.9500, lng: 117.8000 },
            '高青县': { lat: 37.1833, lng: 117.6000 },
            '沂源县': { lat: 36.1833, lng: 118.1500 },
            '广饶县': { lat: 37.0667, lng: 118.4167 },
            '利津县': { lat: 37.4500, lng: 118.2000 },
            '长岛县': { lat: 37.9167, lng: 120.7833 },
            '临朐县': { lat: 36.5000, lng: 118.5000 },
            '昌乐县': { lat: 36.6833, lng: 118.8833 },
            '沂南县': { lat: 35.5500, lng: 118.4667 },
            '曹县': { lat: 34.8333, lng: 115.5333 },
            '单县': { lat: 34.8333, lng: 116.0833 },
            '成武县': { lat: 34.9333, lng: 115.8000 },
            '巨野县': { lat: 35.3500, lng: 116.0833 },
            '郓城县': { lat: 35.5833, lng: 115.8833 },
            '鄄城县': { lat: 35.5500, lng: 115.5333 },
            '东明县': { lat: 35.3167, lng: 115.0000 },
            '定陶区': { lat: 35.0700, lng: 115.5700 },
            // 福建省县级市
            '晋江': { lat: 24.7906, lng: 118.5997 },
            '石狮': { lat: 24.7528, lng: 118.6597 },
            '南安': { lat: 24.9631, lng: 118.3828 },
            '福清': { lat: 25.7333, lng: 119.3833 },
            '长乐': { lat: 25.9500, lng: 119.5833 },
            // 福建省县城
            '闽侯县': { lat: 26.1667, lng: 119.1333 },
            '连江县': { lat: 26.2000, lng: 119.5500 },
            '罗源县': { lat: 26.4833, lng: 119.5000 },
            '闽清县': { lat: 26.2333, lng: 118.8000 },
            '永泰县': { lat: 25.8833, lng: 118.9000 },
            '平潭县': { lat: 25.5167, lng: 119.7000 },
            '仙游县': { lat: 25.3333, lng: 118.7833 },
            '明溪县': { lat: 26.3667, lng: 117.1833 },
            '清流县': { lat: 26.1000, lng: 116.8000 },
            '宁化县': { lat: 26.2500, lng: 116.6333 },
            '大田县': { lat: 25.6833, lng: 117.8333 },
            '尤溪县': { lat: 26.1500, lng: 118.1500 },
            '沙县': { lat: 26.4000, lng: 117.7500 },
            '将乐县': { lat: 26.7000, lng: 117.4500 },
            '泰宁县': { lat: 26.9333, lng: 117.1833 },
            '建宁县': { lat: 26.8500, lng: 116.8500 },
            '永安市': { lat: 25.9000, lng: 117.3833 },
            '惠安县': { lat: 24.9000, lng: 118.7833 },
            '安溪县': { lat: 25.0833, lng: 118.1833 },
            '永春县': { lat: 25.3333, lng: 118.2333 },
            '德化县': { lat: 25.5000, lng: 118.1000 },
            '金门县': { lat: 24.4333, lng: 118.3333 },
            '云霄县': { lat: 23.9500, lng: 117.3333 },
            '漳浦县': { lat: 24.1333, lng: 117.6833 },
            '诏安县': { lat: 23.7333, lng: 117.1333 },
            '长泰县': { lat: 24.7500, lng: 117.7333 },
            '东山县': { lat: 23.7333, lng: 117.4333 },
            '南靖县': { lat: 24.5500, lng: 117.3000 },
            '平和县': { lat: 24.3000, lng: 117.3000 },
            '华安县': { lat: 24.8500, lng: 117.5000 },
            '龙海市': { lat: 24.4333, lng: 117.9333 },
            '顺昌县': { lat: 26.8000, lng: 117.8000 },
            '浦城县': { lat: 27.9500, lng: 118.5833 },
            '光泽县': { lat: 27.5000, lng: 117.3333 },
            '松溪县': { lat: 27.5333, lng: 118.7000 },
            '政和县': { lat: 27.3500, lng: 118.8000 },
            '邵武市': { lat: 27.3333, lng: 117.4833 },
            '武夷山市': { lat: 27.6833, lng: 118.0000 },
            '建瓯市': { lat: 27.0500, lng: 118.3833 },
            '建阳市': { lat: 27.3000, lng: 118.1833 },
            '长汀县': { lat: 25.8000, lng: 116.1000 },
            '永定县': { lat: 24.7333, lng: 116.8333 },
            '上杭县': { lat: 25.0400, lng: 116.4300 },
            '武平县': { lat: 25.0833, lng: 116.1000 },
            '连城县': { lat: 25.7000, lng: 116.7333 },
            '漳平市': { lat: 25.3000, lng: 117.4833 },
            '霞浦县': { lat: 26.8000, lng: 120.0000 },
            '古田县': { lat: 26.5833, lng: 118.7833 },
            '屏南县': { lat: 26.9333, lng: 118.9500 },
            '寿宁县': { lat: 27.4333, lng: 119.5333 },
            '周宁县': { lat: 27.1333, lng: 119.3333 },
            '柘荣县': { lat: 27.2000, lng: 119.8000 },
            '福安市': { lat: 27.0833, lng: 119.6000 },
            '福鼎市': { lat: 27.3333, lng: 120.2000 },
            // 河南省县级市
            '巩义': { lat: 34.7667, lng: 112.9333 },
            '荥阳': { lat: 34.7900, lng: 113.3167 },
            '新密': { lat: 34.5167, lng: 113.3000 },
            '新郑': { lat: 34.4000, lng: 113.7000 },
            '登封': { lat: 34.4667, lng: 113.0000 },
            '济源': { lat: 35.0873, lng: 112.5973 },
            // 河南省县城
            '中牟县': { lat: 34.7361, lng: 114.0536 },
            '杞县': { lat: 34.5500, lng: 114.7500 },
            '通许县': { lat: 34.4333, lng: 114.4167 },
            '尉氏县': { lat: 34.4167, lng: 114.1667 },
            '兰考县': { lat: 34.6833, lng: 114.8500 },
            '孟津县': { lat: 34.8333, lng: 112.4167 },
            '新安县': { lat: 34.7500, lng: 112.1500 },
            '栾川县': { lat: 33.8167, lng: 111.6167 },
            '嵩县': { lat: 34.1333, lng: 112.0167 },
            '汝阳县': { lat: 34.1833, lng: 112.4000 },
            '宜阳县': { lat: 34.4333, lng: 112.1000 },
            '洛宁县': { lat: 34.3500, lng: 111.6500 },
            '伊川县': { lat: 34.4333, lng: 112.4500 },
            '偃师市': { lat: 34.7333, lng: 112.7500 },
            // 四川省地级市
            '绵阳': { lat: 31.4639, lng: 104.7510 },
            // 四川省县级市
            '都江堰': { lat: 31.0000, lng: 103.6000 },
            '彭州': { lat: 30.9200, lng: 103.9333 },
            '邛崃': { lat: 30.4200, lng: 103.4700 },
            '崇州': { lat: 30.6333, lng: 103.6667 },
            '广汉': { lat: 30.9833, lng: 104.2500 },
            // 湖北省县级市
            '仙桃': { lat: 30.3333, lng: 113.4833 },
            '潜江': { lat: 30.4000, lng: 112.8833 },
            '天门': { lat: 30.6333, lng: 113.1833 },
            '枣阳': { lat: 32.1200, lng: 112.7667 },
            '宜城': { lat: 31.7167, lng: 112.2500 },
            '大冶': { lat: 30.0500, lng: 114.9500 },
            // 湖南省县级市
            '浏阳': { lat: 28.2667, lng: 113.6333 },
            '醴陵': { lat: 27.6750, lng: 113.4250 },
            '湘乡': { lat: 27.7500, lng: 112.5333 },
            '韶山': { lat: 27.9333, lng: 112.5500 },
            '耒阳': { lat: 26.4333, lng: 112.8333 },
            // 河北省县级市
            '三河': { lat: 39.9500, lng: 117.0000 },
            '霸州': { lat: 39.1200, lng: 116.3333 },
            '涿州': { lat: 39.4833, lng: 115.9667 },
            '安国': { lat: 38.4333, lng: 115.3333 },
            '高碑店': { lat: 39.3167, lng: 115.8167 },
            // 河北省县城
            '正定县': { lat: 38.1333, lng: 114.5167 },
            '行唐县': { lat: 38.4333, lng: 114.5500 },
            '灵寿县': { lat: 38.3167, lng: 114.3333 },
            '高邑县': { lat: 37.6200, lng: 114.5800 },
            '深泽县': { lat: 38.1333, lng: 115.2333 },
            '赞皇县': { lat: 37.6833, lng: 114.3833 },
            '无极县': { lat: 38.1833, lng: 114.9667 },
            '平山县': { lat: 38.2000, lng: 114.1500 },
            '元氏县': { lat: 37.7000, lng: 114.5000 },
            '赵县': { lat: 37.7333, lng: 114.7500 },
            '辛集市': { lat: 37.9833, lng: 115.2000 },
            '藁城区': { lat: 38.0333, lng: 114.8333 },
            '鹿泉区': { lat: 38.0833, lng: 114.1833 },
            '栾城区': { lat: 38.0000, lng: 114.6000 },
            '井陉矿区': { lat: 38.0333, lng: 114.0000 },
            '井陉县': { lat: 38.0333, lng: 114.0000 },
            // 山西省县级市
            '古交市': { lat: 37.8167, lng: 112.1833 },
            '潞城市': { lat: 36.3000, lng: 113.2000 },
            '高平市': { lat: 35.7000, lng: 112.8000 },
            '介休市': { lat: 37.0000, lng: 111.9000 },
            '永济市': { lat: 34.8500, lng: 110.4833 },
            '河津市': { lat: 35.6333, lng: 110.7000 },
            '原平市': { lat: 38.7833, lng: 112.7333 },
            // 山西省县城
            '清徐县': { lat: 37.6200, lng: 112.3500 },
            '阳曲县': { lat: 38.0333, lng: 112.6833 },
            '娄烦县': { lat: 38.0333, lng: 111.7000 },
            '阳高县': { lat: 40.3833, lng: 113.7833 },
            '天镇县': { lat: 40.3500, lng: 114.0833 },
            '广灵县': { lat: 39.7833, lng: 114.2833 },
            '灵丘县': { lat: 39.4333, lng: 114.2333 },
            '浑源县': { lat: 39.6700, lng: 113.6800 },
            '左云县': { lat: 40.0333, lng: 112.7833 },
            '山阴县': { lat: 39.5000, lng: 112.8000 },
            '应县': { lat: 39.5833, lng: 113.1833 },
            '右玉县': { lat: 39.9200, lng: 112.3000 },
            '怀仁市': { lat: 39.8200, lng: 113.1800 },
            // 陕西省县级市
            '兴平市': { lat: 34.3167, lng: 108.4333 },
            '韩城市': { lat: 35.4833, lng: 110.4500 },
            '华阴市': { lat: 34.5833, lng: 110.0500 },
            // 陕西省县城
            '蓝田县': { lat: 34.1833, lng: 109.3333 },
            '周至县': { lat: 34.1500, lng: 108.2333 },
            '户县': { lat: 34.1200, lng: 108.6500 },
            '高陵县': { lat: 34.5833, lng: 109.1333 },
            '三原县': { lat: 34.6000, lng: 108.9000 },
            '泾阳县': { lat: 34.5333, lng: 108.8333 },
            '乾县': { lat: 34.5333, lng: 108.2333 },
            '礼泉县': { lat: 34.4200, lng: 108.4333 },
            '永寿县': { lat: 34.6333, lng: 108.1833 },
            '彬县': { lat: 35.0333, lng: 107.9333 },
            '长武县': { lat: 35.2333, lng: 107.8333 },
            '旬邑县': { lat: 35.1333, lng: 108.3333 },
            '淳化县': { lat: 34.8333, lng: 108.5333 },
            '武功县': { lat: 34.2500, lng: 108.2333 },
            '白水县': { lat: 35.1500, lng: 109.5333 },
            '蒲城县': { lat: 34.9500, lng: 109.5500 },
            '澄城县': { lat: 35.1333, lng: 109.9333 },
            '合阳县': { lat: 35.2000, lng: 110.1500 },
            '韩城市': { lat: 35.4833, lng: 110.4500 },
            '华阴市': { lat: 34.5833, lng: 110.0500 },
            '富平县': { lat: 34.7000, lng: 109.1333 },
            // 安徽省县级市
            '桐城市': { lat: 31.0333, lng: 116.9333 },
            '天长市': { lat: 32.6833, lng: 119.0000 },
            '明光市': { lat: 32.7833, lng: 117.9833 },
            '界首市': { lat: 33.2000, lng: 115.3000 },
            '宁国市': { lat: 30.6200, lng: 118.9800 },
            // 安徽省县城
            '肥东县': { lat: 31.8833, lng: 117.4833 },
            '肥西县': { lat: 31.7000, lng: 117.1500 },
            '长丰县': { lat: 32.4833, lng: 117.1500 },
            '庐江县': { lat: 31.2500, lng: 117.2500 },
            '巢湖市': { lat: 31.6200, lng: 117.8700 },
            '无为县': { lat: 31.2000, lng: 117.7000 },
            '芜湖县': { lat: 31.1500, lng: 118.4333 },
            '繁昌县': { lat: 31.0700, lng: 118.2300 },
            '南陵县': { lat: 30.9000, lng: 118.3000 },
            '怀远县': { lat: 32.9000, lng: 117.1833 },
            '五河县': { lat: 33.1833, lng: 117.8333 },
            '固镇县': { lat: 33.3333, lng: 117.3000 },
            '凤台县': { lat: 32.6333, lng: 116.7833 },
            '寿县': { lat: 32.5500, lng: 116.7000 },
            '当涂县': { lat: 31.5500, lng: 118.4833 },
            // 浙江省县城
            '桐庐县': { lat: 29.8000, lng: 119.6833 },
            '淳安县': { lat: 29.5000, lng: 119.0000 },
            '建德市': { lat: 29.4700, lng: 119.2700 },
            '临安市': { lat: 30.2333, lng: 119.7200 },
            '富阳区': { lat: 30.0000, lng: 119.9333 },
            '临安区': { lat: 30.2333, lng: 119.7200 },
            '永嘉县': { lat: 28.1000, lng: 120.6833 },
            '平阳县': { lat: 27.6500, lng: 120.5500 },
            '苍南县': { lat: 27.5000, lng: 120.3833 },
            '文成县': { lat: 27.7833, lng: 120.0000 },
            '泰顺县': { lat: 27.5500, lng: 119.7500 },
            '瑞安市': { lat: 27.7767, lng: 120.6533 },
            '乐清市': { lat: 28.1467, lng: 120.9458 },
            '洞头区': { lat: 27.8333, lng: 121.1000 },
            // 江西省县级市
            '乐平市': { lat: 28.9000, lng: 117.1500 },
            '瑞昌市': { lat: 29.6833, lng: 115.6500 },
            '贵溪市': { lat: 28.3000, lng: 117.2000 },
            '瑞金市': { lat: 25.8833, lng: 116.0333 },
            '南康市': { lat: 25.6000, lng: 114.7500 },
            '井冈山市': { lat: 26.5667, lng: 114.1333 },
            '丰城市': { lat: 28.1833, lng: 115.7000 },
            '樟树市': { lat: 28.0000, lng: 115.5000 },
            '高安市': { lat: 28.4500, lng: 115.3333 },
            // 江西省县城
            '南昌县': { lat: 28.5833, lng: 115.8000 },
            '新建区': { lat: 28.6833, lng: 115.7000 },
            '安义县': { lat: 28.8333, lng: 115.6000 },
            '进贤县': { lat: 28.3333, lng: 116.2000 },
            '浮梁县': { lat: 29.3000, lng: 117.2000 },
            '莲花县': { lat: 27.1833, lng: 113.9000 },
            '上栗县': { lat: 27.8000, lng: 113.8333 },
            '芦溪县': { lat: 27.6000, lng: 113.9000 },
            '九江县长': { lat: 29.7000, lng: 115.9000 },
            '武宁县': { lat: 29.2000, lng: 115.0500 },
            '修水县': { lat: 29.0500, lng: 114.5333 },
            '永修县': { lat: 29.0000, lng: 115.8500 },
            '德安县': { lat: 29.3000, lng: 115.8000 },
            '星子县': { lat: 29.4833, lng: 116.0333 },
            '都昌县': { lat: 29.2333, lng: 116.2000 },
            '湖口县': { lat: 29.7333, lng: 116.2000 },
            '彭泽县': { lat: 29.9333, lng: 116.5833 },
            // 湖北省县城
            '蔡甸区': { lat: 30.4000, lng: 113.9500 },
            '江夏区': { lat: 30.3000, lng: 114.3000 },
            '黄陂区': { lat: 30.8333, lng: 114.3000 },
            '新洲区': { lat: 30.8333, lng: 114.7000 },
            '黄石港区': { lat: 30.2333, lng: 115.0500 },
            '西塞山区': { lat: 30.2000, lng: 115.0000 },
            '下陆区': { lat: 30.2000, lng: 115.0000 },
            '铁山区': { lat: 30.2000, lng: 115.0000 },
            '阳新县': { lat: 29.9000, lng: 115.2000 },
            '大冶市': { lat: 30.0500, lng: 114.9500 },
            '郧阳区': { lat: 32.7833, lng: 110.8500 },
            '郧西县': { lat: 32.9333, lng: 110.4000 },
            '竹山县': { lat: 32.2333, lng: 110.1833 },
            '竹溪县': { lat: 32.3333, lng: 109.7833 },
            '房县': { lat: 32.1833, lng: 110.7500 },
            '丹江口市': { lat: 32.5333, lng: 111.5833 },
            // 湖南省县城
            '长沙县': { lat: 28.2333, lng: 113.0333 },
            '望城区': { lat: 28.2333, lng: 112.8000 },
            '宁乡市': { lat: 28.2333, lng: 112.5333 },
            '浏阳市': { lat: 28.2667, lng: 113.6333 },
            '株洲县': { lat: 27.8333, lng: 113.1500 },
            '攸县': { lat: 27.0000, lng: 113.3333 },
            '茶陵县': { lat: 26.7000, lng: 113.5000 },
            '炎陵县': { lat: 26.3000, lng: 113.7000 },
            '醴陵市': { lat: 27.6750, lng: 113.4250 },
            '湘潭县': { lat: 27.8333, lng: 112.9000 },
            '湘乡市': { lat: 27.7500, lng: 112.5333 },
            '韶山市': { lat: 27.9333, lng: 112.5500 },
            // 广东省县级市
            '乐昌市': { lat: 25.1333, lng: 113.3000 },
            '南雄市': { lat: 25.1333, lng: 114.3333 },
            '吴川市': { lat: 21.4333, lng: 110.7833 },
            '廉江市': { lat: 21.6333, lng: 110.1833 },
            '雷州市': { lat: 20.9000, lng: 110.0833 },
            '四会市': { lat: 23.3500, lng: 112.6167 },
            '高要市': { lat: 23.0333, lng: 112.4667 },
            '化州市': { lat: 21.6000, lng: 110.5000 },
            '信宜市': { lat: 22.3000, lng: 110.9000 },
            '高州市': { lat: 21.9333, lng: 110.8333 },
            '兴宁市': { lat: 24.1500, lng: 115.7333 },
            '陆丰市': { lat: 22.9500, lng: 115.7000 },
            '阳春市': { lat: 22.1667, lng: 111.7000 },
            '英德市': { lat: 24.1000, lng: 113.3700 },
            '连州市': { lat: 24.7500, lng: 112.3600 },
            '普宁市': { lat: 23.2881, lng: 116.1000 },
            '罗定市': { lat: 22.7500, lng: 111.5333 },
            // 广东省县城
            '增城区': { lat: 23.2700, lng: 113.8200 },
            '从化区': { lat: 23.5500, lng: 113.5333 },
            '花都区': { lat: 23.4000, lng: 113.1000 },
            '番禺区': { lat: 23.0500, lng: 113.3200 },
            '南沙区': { lat: 22.7500, lng: 113.5500 },
            '黄埔区': { lat: 23.1167, lng: 113.4500 },
            '白云区': { lat: 23.2833, lng: 113.2500 },
            '天河区': { lat: 23.1333, lng: 113.3500 },
            '越秀区': { lat: 23.1250, lng: 113.2500 },
            '海珠区': { lat: 23.0833, lng: 113.3000 },
            '荔湾区': { lat: 23.1250, lng: 113.2000 },
            '禅城区': { lat: 23.0000, lng: 113.1000 },
            '南海区': { lat: 23.0347, lng: 113.1222 },
            '顺德区': { lat: 22.8076, lng: 113.2894 },
            '高明区': { lat: 22.6500, lng: 112.8000 },
            '三水区': { lat: 23.1000, lng: 112.8500 },
            // 辽宁省县级市
            '新民市': { lat: 41.9333, lng: 122.7000 },
            '瓦房店市': { lat: 39.6333, lng: 121.9833 },
            '普兰店市': { lat: 39.3500, lng: 122.2000 },
            '庄河市': { lat: 39.7000, lng: 122.9333 },
            '海城市': { lat: 40.8000, lng: 122.7833 },
            '东港市': { lat: 39.9500, lng: 124.1667 },
            '凤城市': { lat: 40.3500, lng: 124.0500 },
            '凌海市': { lat: 41.1333, lng: 121.3333 },
            '北镇市': { lat: 41.6333, lng: 121.8500 },
            '大石桥市': { lat: 40.6333, lng: 122.5333 },
            '盖州市': { lat: 40.4000, lng: 122.3000 },
            '灯塔市': { lat: 41.3333, lng: 123.2000 },
            '调兵山市': { lat: 42.4333, lng: 123.5000 },
            '开原市': { lat: 42.5333, lng: 124.0500 },
            '凌源市': { lat: 41.2500, lng: 119.3333 },
            '北票市': { lat: 41.8333, lng: 120.7000 },
            '兴城市': { lat: 40.6000, lng: 120.7000 },
            // 吉林省县级市
            '德惠市': { lat: 44.5333, lng: 125.6000 },
            '九台市': { lat: 44.1500, lng: 125.8500 },
            '榆树市': { lat: 44.8333, lng: 126.5500 },
            '蛟河市': { lat: 43.7500, lng: 127.3500 },
            '桦甸市': { lat: 42.9833, lng: 126.7000 },
            '舒兰市': { lat: 44.4000, lng: 126.9500 },
            '磐石市': { lat: 42.9333, lng: 126.0500 },
            '公主岭市': { lat: 43.5000, lng: 124.8000 },
            '双辽市': { lat: 43.5333, lng: 123.5000 },
            '梅河口市': { lat: 42.6900, lng: 125.6900 },
            '集安市': { lat: 41.1333, lng: 126.1167 },
            '临江市': { lat: 41.8333, lng: 126.9500 },
            '洮南市': { lat: 45.3333, lng: 122.7000 },
            '大安市': { lat: 45.5500, lng: 124.3333 },
            '延吉市': { lat: 42.9000, lng: 129.5000 },
            '图们市': { lat: 42.9700, lng: 129.8500 },
            '敦化市': { lat: 43.3333, lng: 128.1667 },
            '珲春市': { lat: 42.8333, lng: 130.3333 },
            '龙井市': { lat: 42.7500, lng: 129.4833 },
            '和龙市': { lat: 42.5333, lng: 129.0500 },
            // 黑龙江省县级市
            '尚志市': { lat: 45.2000, lng: 127.9500 },
            '双城市': { lat: 45.3333, lng: 126.3333 },
            '五常市': { lat: 44.9333, lng: 127.1500 },
            '讷河市': { lat: 48.4000, lng: 124.8500 },
            '密山市': { lat: 45.5333, lng: 131.8500 },
            '虎林市': { lat: 45.7500, lng: 133.2000 },
            '铁力市': { lat: 46.9333, lng: 128.0500 },
            '绥芬河市': { lat: 44.4333, lng: 131.2333 },
            '宁安市': { lat: 44.3500, lng: 129.4833 },
            '海林市': { lat: 44.5333, lng: 129.3000 },
            '穆棱市': { lat: 44.9333, lng: 130.5000 },
            '东宁市': { lat: 44.3500, lng: 131.1000 },
            '同江市': { lat: 47.6000, lng: 132.5500 },
            '富锦市': { lat: 47.2000, lng: 132.0333 },
            '北安市': { lat: 48.2333, lng: 126.5500 },
            '五大连池市': { lat: 48.6333, lng: 126.0500 },
            '安达市': { lat: 46.4333, lng: 125.3000 },
            '肇东市': { lat: 46.0700, lng: 125.9300 },
            '海伦市': { lat: 47.4333, lng: 126.9500 },
            // 海南省县级市
            '五指山市': { lat: 18.7833, lng: 109.5167 },
            '琼海市': { lat: 19.2500, lng: 110.4833 },
            '儋州市': { lat: 19.5167, lng: 109.5167 },
            '文昌市': { lat: 19.6167, lng: 110.7167 },
            '万宁市': { lat: 18.8000, lng: 110.3933 },
            '东方市': { lat: 19.0833, lng: 108.6333 },
            // 贵州省县级市
            '清镇市': { lat: 26.5333, lng: 106.3333 },
            '赤水市': { lat: 28.5833, lng: 105.7833 },
            '仁怀市': { lat: 27.7833, lng: 106.4167 },
            '盘州市': { lat: 25.7833, lng: 104.6333 },
            '兴义市': { lat: 25.0500, lng: 104.8500 },
            '都匀市': { lat: 26.2500, lng: 107.5000 },
            '福泉市': { lat: 26.7000, lng: 107.5833 },
            '凯里市': { lat: 26.5700, lng: 107.9700 },
            '兴仁市': { lat: 25.4000, lng: 105.1000 },
            '毕节市': { lat: 27.3000, lng: 105.3833 },
            '铜仁市': { lat: 27.7333, lng: 109.1167 },
            '安顺市': { lat: 26.2500, lng: 105.9000 },
            // 云南省县级市
            '安宁市': { lat: 24.9500, lng: 102.4833 },
            '宣威市': { lat: 26.2500, lng: 104.1000 },
            '水富市': { lat: 28.4333, lng: 104.4500 },
            '腾冲市': { lat: 25.0000, lng: 98.5000 },
            '芒市': { lat: 24.4333, lng: 98.5833 },
            '瑞丽市': { lat: 24.0167, lng: 97.8333 },
            '泸水市': { lat: 25.8000, lng: 98.8500 },
            '香格里拉市': { lat: 27.8333, lng: 99.7000 },
            '大理市': { lat: 25.6833, lng: 100.1833 },
            '楚雄市': { lat: 25.0333, lng: 101.5333 },
            '蒙自市': { lat: 23.3833, lng: 103.4333 },
            '个旧市': { lat: 23.3500, lng: 103.1833 },
            '开远市': { lat: 23.7000, lng: 103.2200 },
            '弥勒市': { lat: 24.4000, lng: 103.4833 },
            '文山市': { lat: 23.3700, lng: 104.2700 },
            '景洪市': { lat: 22.0000, lng: 100.8000 },
            '普洱市': { lat: 22.8700, lng: 100.9700 },
            '临沧市': { lat: 23.8833, lng: 100.0833 },
            '保山市': { lat: 25.1000, lng: 99.1833 },
            '玉溪市': { lat: 24.3500, lng: 102.5200 },
            // 甘肃省县级市
            '玉门市': { lat: 40.2833, lng: 97.0500 },
            '敦煌市': { lat: 40.1333, lng: 94.6500 },
            '临夏市': { lat: 35.6167, lng: 103.2000 },
            '合作市': { lat: 35.0000, lng: 102.9500 },
            // 青海省县级市
            '德令哈市': { lat: 37.3700, lng: 97.3700 },
            '格尔木市': { lat: 36.4200, lng: 94.9000 },
            // 内蒙古自治区县级市
            '霍林郭勒市': { lat: 45.5333, lng: 119.6833 },
            '满洲里市': { lat: 49.6000, lng: 117.4000 },
            '牙克石市': { lat: 49.3000, lng: 120.7000 },
            '扎兰屯市': { lat: 48.0000, lng: 122.7833 },
            '额尔古纳市': { lat: 50.2000, lng: 119.7000 },
            '根河市': { lat: 50.7833, lng: 121.5333 },
            '乌兰浩特市': { lat: 46.0833, lng: 122.0833 },
            '阿尔山市': { lat: 47.2833, lng: 119.8200 },
            '二连浩特市': { lat: 43.6500, lng: 111.9700 },
            '锡林浩特市': { lat: 43.9333, lng: 116.0833 },
            '丰镇市': { lat: 40.4833, lng: 113.2833 },
            // 广西壮族自治区县级市
            '荔浦市': { lat: 24.5333, lng: 110.3833 },
            '岑溪市': { lat: 22.9333, lng: 110.9500 },
            '东兴市': { lat: 21.5833, lng: 107.9333 },
            '桂平市': { lat: 23.3833, lng: 110.0833 },
            '北流市': { lat: 22.7333, lng: 110.3000 },
            '靖西市': { lat: 23.1500, lng: 106.4333 },
            '平果市': { lat: 23.3333, lng: 107.5333 },
            '合山市': { lat: 23.8333, lng: 108.8000 },
            '凭祥市': { lat: 22.1167, lng: 106.7500 },
            // 西藏自治区县级市
            '日喀则市': { lat: 29.2667, lng: 88.8833 },
            '昌都市': { lat: 31.1500, lng: 97.1833 },
            '林芝市': { lat: 29.5833, lng: 94.4167 },
            '山南市': { lat: 29.2833, lng: 91.7667 },
            '那曲市': { lat: 31.4833, lng: 92.0667 },
            // 宁夏回族自治区县级市
            '灵武市': { lat: 38.1833, lng: 106.3333 },
            '青铜峡市': { lat: 38.0000, lng: 106.0000 },
            // 新疆维吾尔自治区县级市
            '石河子市': { lat: 44.3000, lng: 86.0333 },
            '阿拉尔市': { lat: 40.5200, lng: 81.2900 },
            '图木舒克市': { lat: 39.8333, lng: 79.0333 },
            '五家渠市': { lat: 44.2833, lng: 87.5833 },
            '北屯市': { lat: 47.3833, lng: 87.8500 },
            '铁门关市': { lat: 41.7000, lng: 85.9333 },
            '双河市': { lat: 44.9000, lng: 82.2000 },
            '可克达拉市': { lat: 44.1333, lng: 80.8500 },
            '昆玉市': { lat: 37.1833, lng: 79.6333 },
            '胡杨河市': { lat: 44.8833, lng: 85.9500 },
            '新星市': { lat: 42.9333, lng: 93.4833 },
            '哈密市': { lat: 42.8333, lng: 93.5000 },
            '吐鲁番市': { lat: 42.9333, lng: 89.1833 },
            '昌吉市': { lat: 44.0333, lng: 87.3167 },
            '阜康市': { lat: 44.1833, lng: 87.9833 },
            '米泉市': { lat: 43.8333, lng: 87.6000 },
            '博乐市': { lat: 44.9000, lng: 82.1000 },
            '库尔勒市': { lat: 41.7500, lng: 86.0833 },
            '阿克苏市': { lat: 41.1500, lng: 80.2667 },
            '喀什市': { lat: 39.4833, lng: 75.9833 },
            '和田市': { lat: 37.1167, lng: 79.9167 },
            // 台湾省县级市
            '基隆市': { lat: 25.1333, lng: 121.7333 },
            '新竹市': { lat: 24.8333, lng: 120.9667 },
            '台中市': { lat: 24.1500, lng: 120.6667 },
            '嘉义市': { lat: 23.4833, lng: 120.4333 },
            '台南市': { lat: 22.9333, lng: 120.1833 },
            '高雄市': { lat: 22.6167, lng: 120.3167 },
            // 香港特别行政区
            '香港岛': { lat: 22.2800, lng: 114.1833 },
            '九龙': { lat: 22.3333, lng: 114.1667 },
            '新界': { lat: 22.3750, lng: 114.1333 },
            // 澳门特别行政区
            '澳门半岛': { lat: 22.1987, lng: 113.5493 },
            '氹仔岛': { lat: 22.1433, lng: 113.5733 },
            '路环岛': { lat: 22.1333, lng: 113.5500 },
            // 外国城市 - 亚洲
            '东京': { lat: 35.6762, lng: 139.6503 },
            '首尔': { lat: 37.5665, lng: 126.9780 },
            '新加坡': { lat: 1.3521, lng: 103.8198 },
            '曼谷': { lat: 13.7563, lng: 100.5018 },
            '吉隆坡': { lat: 3.1390, lng: 101.6869 },
            '雅加达': { lat: -6.2088, lng: 106.8456 },
            '马尼拉': { lat: 14.5995, lng: 120.9842 },
            '河内': { lat: 21.0285, lng: 105.8542 },
            '胡志明市': { lat: 10.8231, lng: 106.6297 },
            '仰光': { lat: 16.8667, lng: 96.1914 },
            '金边': { lat: 11.5561, lng: 104.9282 },
            '万象': { lat: 17.9757, lng: 102.6331 },
            '加德满都': { lat: 27.7172, lng: 85.3240 },
            '新德里': { lat: 28.6139, lng: 77.2090 },
            '孟买': { lat: 19.0760, lng: 72.8777 },
            '卡拉奇': { lat: 24.8607, lng: 67.0011 },
            '伊斯兰堡': { lat: 33.6844, lng: 73.0479 },
            '德黑兰': { lat: 35.6892, lng: 51.3890 },
            '巴格达': { lat: 33.3152, lng: 44.3661 },
            '利雅得': { lat: 24.7136, lng: 46.6753 },
            '迪拜': { lat: 25.2048, lng: 55.2708 },
            '阿布扎比': { lat: 24.4539, lng: 54.3773 },
            '多哈': { lat: 25.2854, lng: 51.5310 },
            '科威特城': { lat: 29.3759, lng: 47.9774 },
            '安曼': { lat: 31.9539, lng: 35.9106 },
            '贝鲁特': { lat: 33.8938, lng: 35.5018 },
            '大马士革': { lat: 33.5138, lng: 36.2765 },
            '伊斯坦布尔': { lat: 41.0082, lng: 28.9784 },
            '安卡拉': { lat: 39.9334, lng: 32.8597 },
            // 外国城市 - 欧洲
            '伦敦': { lat: 51.5074, lng: -0.1278 },
            '巴黎': { lat: 48.8566, lng: 2.3522 },
            '柏林': { lat: 52.5200, lng: 13.4050 },
            '罗马': { lat: 41.9028, lng: 12.4964 },
            '马德里': { lat: 40.4168, lng: -3.7038 },
            '里斯本': { lat: 38.7223, lng: -9.1393 },
            '维也纳': { lat: 48.2082, lng: 16.3738 },
            '布鲁塞尔': { lat: 50.8503, lng: 4.3517 },
            '阿姆斯特丹': { lat: 52.3676, lng: 4.9041 },
            '日内瓦': { lat: 46.2044, lng: 6.1432 },
            '苏黎世': { lat: 47.3769, lng: 8.5417 },
            '慕尼黑': { lat: 48.1351, lng: 11.5820 },
            '法兰克福': { lat: 50.1109, lng: 8.6821 },
            '汉堡': { lat: 53.5511, lng: 9.9937 },
            '斯德哥尔摩': { lat: 59.3293, lng: 18.0686 },
            '奥斯陆': { lat: 59.9139, lng: 10.7522 },
            '哥本哈根': { lat: 55.6761, lng: 12.5683 },
            '赫尔辛基': { lat: 60.1699, lng: 24.9384 },
            '华沙': { lat: 52.2297, lng: 21.0122 },
            '布拉格': { lat: 50.0755, lng: 14.4378 },
            '布达佩斯': { lat: 47.4979, lng: 19.0402 },
            '布加勒斯特': { lat: 44.4268, lng: 26.1025 },
            '索菲亚': { lat: 42.6977, lng: 23.3219 },
            '雅典': { lat: 37.9838, lng: 23.7275 },
            // 外国城市 - 北美洲
            '纽约': { lat: 40.7128, lng: -74.0060 },
            '洛杉矶': { lat: 34.0522, lng: -118.2437 },
            '芝加哥': { lat: 41.8781, lng: -87.6298 },
            '休斯顿': { lat: 29.7604, lng: -95.3698 },
            '费城': { lat: 39.9526, lng: -75.1652 },
            '凤凰城': { lat: 33.4484, lng: -112.0740 },
            '圣安东尼奥': { lat: 29.4241, lng: -98.4936 },
            '圣地亚哥': { lat: 32.7157, lng: -117.1611 },
            '达拉斯': { lat: 32.7767, lng: -96.7970 },
            '圣何塞': { lat: 37.3382, lng: -121.8863 },
            '多伦多': { lat: 43.6532, lng: -79.3832 },
            '蒙特利尔': { lat: 45.5017, lng: -73.5673 },
            '温哥华': { lat: 49.2827, lng: -123.1207 },
            '渥太华': { lat: 45.4215, lng: -75.6972 },
            '墨西哥城': { lat: 19.4326, lng: -99.1332 },
            '瓜达拉哈拉': { lat: 20.6668, lng: -103.3918 },
            '蒙特雷': { lat: 25.6866, lng: -100.3161 },
            // 外国城市 - 南美洲
            '圣保罗': { lat: -23.5505, lng: -46.6333 },
            '里约热内卢': { lat: -22.9068, lng: -43.1729 },
            '布宜诺斯艾利斯': { lat: -34.6037, lng: -58.3816 },
            '圣地亚哥': { lat: -33.4489, lng: -70.6693 },
            '利马': { lat: -12.0464, lng: -77.0428 },
            '波哥大': { lat: 4.7110, lng: -74.0721 },
            '加拉加斯': { lat: 10.4806, lng: -66.9036 },
            '亚松森': { lat: -25.2637, lng: -57.5759 },
            '蒙得维的亚': { lat: -34.9011, lng: -56.1645 },
            '基多': { lat: -0.1807, lng: -78.4678 },
            '瓜亚基尔': { lat: -2.1962, lng: -79.8862 },
            // 外国城市 - 大洋洲
            '悉尼': { lat: -33.8688, lng: 151.2093 },
            '墨尔本': { lat: -37.8136, lng: 144.9631 },
            '布里斯班': { lat: -27.4698, lng: 153.0251 },
            '珀斯': { lat: -31.9505, lng: 115.8605 },
            '阿德莱德': { lat: -34.9285, lng: 138.6007 },
            '堪培拉': { lat: -35.2809, lng: 149.1300 },
            '奥克兰': { lat: -36.8485, lng: 174.7633 },
            '惠灵顿': { lat: -41.2865, lng: 174.7762 },
            // 外国城市 - 非洲
            '开罗': { lat: 30.0444, lng: 31.2357 },
            '亚历山大': { lat: 31.2001, lng: 29.9187 },
            '开普敦': { lat: -33.9249, lng: 18.4241 },
            '约翰内斯堡': { lat: -26.2041, lng: 28.0473 },
            '德班': { lat: -29.8587, lng: 31.0218 },
            '内罗毕': { lat: -1.2921, lng: 36.8219 },
            '达累斯萨拉姆': { lat: -6.8236, lng: 39.2653 },
            '拉各斯': { lat: 6.5244, lng: 3.3792 },
            '阿布贾': { lat: 9.0765, lng: 7.3986 },
            '喀土穆': { lat: 15.5007, lng: 32.5599 },
            '阿尔及尔': { lat: 36.7538, lng: 3.0588 },
            '突尼斯': { lat: 36.8065, lng: 10.1815 },
            '卡萨布兰卡': { lat: 33.5731, lng: -7.5898 },
            '丹吉尔': { lat: 35.7596, lng: -5.8339 },
            '吉隆坡': { lat: 3.1390, lng: 101.6869 },
            '雅加达': { lat: -6.2088, lng: 106.8456 },
            '马尼拉': { lat: 14.5995, lng: 120.9842 },
            '河内': { lat: 21.0278, lng: 105.8342 },
            '金边': { lat: 11.5561, lng: 104.9282 },
            '万象': { lat: 17.9757, lng: 102.6331 },
            '内比都': { lat: 19.7417, lng: 96.0785 },
            '伊斯兰堡': { lat: 33.6844, lng: 73.0479 },
            '新德里': { lat: 28.6139, lng: 77.2090 },
            '孟买': { lat: 19.0760, lng: 72.8777 },
            '卡拉奇': { lat: 24.8607, lng: 67.0011 },
            '达卡': { lat: 23.8103, lng: 90.4125 },
            '科伦坡': { lat: 6.9271, lng: 79.8612 },
            '加德满都': { lat: 27.7172, lng: 85.3240 },
            '廷布': { lat: 27.4728, lng: 89.6396 },
            '喀布尔': { lat: 34.5333, lng: 69.1667 },
            '德黑兰': { lat: 35.6892, lng: 51.3890 },
            '巴格达': { lat: 33.3152, lng: 44.3661 },
            '利雅得': { lat: 24.7136, lng: 46.6753 },
            '迪拜': { lat: 25.2048, lng: 55.2708 },
            '多哈': { lat: 25.2867, lng: 51.5333 },
            '阿布扎比': { lat: 24.4539, lng: 54.3773 },
            '麦纳麦': { lat: 26.2285, lng: 50.5860 },
            '马斯喀特': { lat: 23.6102, lng: 58.5922 },
            '萨那': { lat: 15.3694, lng: 44.1910 },
            '安卡拉': { lat: 39.9334, lng: 32.8597 },
            '伊斯坦布尔': { lat: 41.0082, lng: 28.9784 },
            '大马士革': { lat: 33.5138, lng: 36.2765 },
            '贝鲁特': { lat: 33.8938, lng: 35.5018 },
            '安曼': { lat: 31.9539, lng: 35.9106 },
            '耶路撒冷': { lat: 31.7683, lng: 35.2137 },
            '开罗': { lat: 30.0444, lng: 31.2357 },
            '的黎波里': { lat: 32.8872, lng: 13.1913 },
            '突尼斯市': { lat: 36.8065, lng: 10.1815 },
            '阿尔及尔': { lat: 36.7538, lng: 3.0588 },
            '拉巴特': { lat: 34.0209, lng: -6.8416 },
            // 外国城市 - 欧洲
            '伦敦': { lat: 51.5074, lng: -0.1278 },
            '巴黎': { lat: 48.8566, lng: 2.3522 },
            '柏林': { lat: 52.5200, lng: 13.4050 },
            '罗马': { lat: 41.9028, lng: 12.4964 },
            '马德里': { lat: 40.4168, lng: -3.7038 },
            '里斯本': { lat: 38.7223, lng: -9.1393 },
            '阿姆斯特丹': { lat: 52.3676, lng: 4.9041 },
            '布鲁塞尔': { lat: 50.8503, lng: 4.3517 },
            '维也纳': { lat: 48.2082, lng: 16.3738 },
            '苏黎世': { lat: 47.3769, lng: 8.5417 },
            '日内瓦': { lat: 46.2044, lng: 6.1432 },
            '慕尼黑': { lat: 48.1351, lng: 11.5820 },
            '法兰克福': { lat: 50.1109, lng: 8.6821 },
            '汉堡': { lat: 53.5511, lng: 9.9937 },
            '杜塞尔多夫': { lat: 51.2277, lng: 6.7735 },
            '科隆': { lat: 50.9375, lng: 6.9603 },
            '斯图加特': { lat: 48.7758, lng: 9.1829 },
            '米兰': { lat: 45.4642, lng: 9.1900 },
            '威尼斯': { lat: 45.4408, lng: 12.3155 },
            '佛罗伦萨': { lat: 43.7696, lng: 11.2558 },
            '那不勒斯': { lat: 40.8518, lng: 14.2681 },
            '巴塞罗那': { lat: 41.3851, lng: 2.1734 },
            '瓦伦西亚': { lat: 39.4699, lng: -0.3763 },
            '塞维利亚': { lat: 37.3891, lng: -5.9845 },
            '里斯本': { lat: 38.7223, lng: -9.1393 },
            '波尔图': { lat: 41.1496, lng: -8.6109 },
            '布鲁日': { lat: 51.2093, lng: 3.2241 },
            '安特卫普': { lat: 51.2194, lng: 4.4025 },
            '卢森堡市': { lat: 49.6116, lng: 6.1319 },
            '哥本哈根': { lat: 55.6761, lng: 12.5683 },
            '斯德哥尔摩': { lat: 59.3293, lng: 18.0686 },
            '奥斯陆': { lat: 59.9139, lng: 10.7522 },
            '赫尔辛基': { lat: 60.1699, lng: 24.9384 },
            '雷克雅未克': { lat: 64.1265, lng: -21.8174 },
            '都柏林': { lat: 53.3498, lng: -6.2603 },
            '爱丁堡': { lat: 55.9533, lng: -3.1883 },
            '曼彻斯特': { lat: 53.4808, lng: -2.2426 },
            '伯明翰': { lat: 52.4862, lng: -1.8904 },
            '利物浦': { lat: 53.4084, lng: -2.9916 },
            '格拉斯哥': { lat: 55.8642, lng: -4.2518 },
            '贝尔法斯特': { lat: 54.5973, lng: -5.9301 },
            '华沙': { lat: 52.2297, lng: 21.0122 },
            '布拉格': { lat: 50.0755, lng: 14.4378 },
            '布拉迪斯拉发': { lat: 48.1486, lng: 17.1077 },
            '布达佩斯': { lat: 47.4979, lng: 19.0402 },
            '维也纳': { lat: 48.2082, lng: 16.3738 },
            '布加勒斯特': { lat: 44.4268, lng: 26.1025 },
            '索非亚': { lat: 42.6977, lng: 23.3219 },
            '雅典': { lat: 37.9838, lng: 23.7275 },
            '萨拉热窝': { lat: 43.8563, lng: 18.4131 },
            '贝尔格莱德': { lat: 44.8170, lng: 20.4651 },
            '卢布尔雅那': { lat: 46.0514, lng: 14.5060 },
            '萨格勒布': { lat: 45.8150, lng: 15.9819 },
            '斯科普里': { lat: 41.9973, lng: 21.4280 },
            '地拉那': { lat: 41.3275, lng: 19.8189 },
            '莫斯科': { lat: 55.7558, lng: 37.6173 },
            '圣彼得堡': { lat: 59.9343, lng: 30.3351 },
            // 外国城市 - 美洲
            '纽约': { lat: 40.7128, lng: -74.0060 },
            '洛杉矶': { lat: 34.0522, lng: -118.2437 },
            '芝加哥': { lat: 41.8781, lng: -87.6298 },
            '休斯顿': { lat: 29.7604, lng: -95.3698 },
            '费城': { lat: 39.9526, lng: -75.1652 },
            '凤凰城': { lat: 33.4484, lng: -112.0740 },
            '圣安东尼奥': { lat: 29.4241, lng: -98.4936 },
            '圣地亚哥': { lat: 32.7157, lng: -117.1611 },
            '达拉斯': { lat: 32.7767, lng: -96.7970 },
            '旧金山': { lat: 37.7749, lng: -122.4194 },
            '迈阿密': { lat: 25.7617, lng: -80.1918 },
            '亚特兰大': { lat: 33.7490, lng: -84.3880 },
            '华盛顿': { lat: 38.9072, lng: -77.0369 },
            '波士顿': { lat: 42.3601, lng: -71.0589 },
            '西雅图': { lat: 47.6062, lng: -122.3321 },
            '丹佛': { lat: 39.7392, lng: -104.9903 },
            '多伦多': { lat: 43.6532, lng: -79.3832 },
            '蒙特利尔': { lat: 45.5017, lng: -73.5673 },
            '温哥华': { lat: 49.2827, lng: -123.1207 },
            '渥太华': { lat: 45.4215, lng: -75.6972 },
            '卡尔加里': { lat: 51.0447, lng: -114.0719 },
            '墨西哥城': { lat: 19.4326, lng: -99.1332 },
            '瓜达拉哈拉': { lat: 20.6777, lng: -103.3467 },
            '蒙特雷': { lat: 25.6866, lng: -100.3161 },
            '危地马拉城': { lat: 14.6349, lng: -90.5069 },
            '圣萨尔瓦多': { lat: 13.6929, lng: -89.2182 },
            '特古西加尔巴': { lat: 14.0818, lng: -87.2068 },
            '马那瓜': { lat: 12.1328, lng: -86.2500 },
            '圣何塞': { lat: 9.9281, lng: -84.0907 },
            '巴拿马城': { lat: 8.9824, lng: -79.5199 },
            '拿骚': { lat: 25.0343, lng: -77.3963 },
            '哈瓦那': { lat: 23.1136, lng: -82.3666 },
            '金斯敦': { lat: 17.9667, lng: -76.7931 },
            '太子港': { lat: 18.5944, lng: -72.3071 },
            '圣多明各': { lat: 18.4712, lng: -69.9003 },
            '波哥大': { lat: 4.7110, lng: -74.0721 },
            '麦德林': { lat: 6.2442, lng: -75.5812 },
            '卡利': { lat: 3.4516, lng: -76.5320 },
            '巴兰基亚': { lat: 10.9685, lng: -74.7813 },
            '加拉加斯': { lat: 10.4880, lng: -66.8792 },
            '马拉开波': { lat: 10.6311, lng: -71.6400 },
            '乔治敦': { lat: 6.8013, lng: -58.1551 },
            '帕拉马里博': { lat: 5.8520, lng: -55.1661 },
            '基多': { lat: -0.1807, lng: -78.4678 },
            '瓜亚基尔': { lat: -2.1962, lng: -79.8862 },
            '利马': { lat: -12.0464, lng: -77.0428 },
            '库斯科': { lat: -13.5270, lng: -71.9785 },
            '拉巴斯': { lat: -16.5000, lng: -68.1500 },
            '圣克鲁斯': { lat: -17.7863, lng: -63.1816 },
            '巴西利亚': { lat: -15.7942, lng: -47.8822 },
            '圣保罗': { lat: -23.5505, lng: -46.6333 },
            '里约热内卢': { lat: -22.9068, lng: -43.1729 },
            '萨尔瓦多': { lat: -12.9714, lng: -38.5014 },
            '福塔莱萨': { lat: -3.7172, lng: -38.5434 },
            '贝洛奥里藏特': { lat: -19.9167, lng: -43.9345 },
            '圣地亚哥': { lat: -33.4489, lng: -70.6693 },
            '瓦尔帕莱索': { lat: -33.0393, lng: -71.5375 },
            '康塞普西翁': { lat: -36.8201, lng: -73.0442 },
            '布宜诺斯艾利斯': { lat: -34.6037, lng: -58.3816 },
            '科尔多瓦': { lat: -31.4135, lng: -64.1811 },
            '罗萨里奥': { lat: -32.9468, lng: -60.6393 },
            '蒙得维的亚': { lat: -34.9011, lng: -56.1645 },
            '亚松森': { lat: -25.2637, lng: -57.5759 },
            // 外国城市 - 大洋洲
            '悉尼': { lat: -33.8688, lng: 151.2093 },
            '墨尔本': { lat: -37.8136, lng: 144.9631 },
            '布里斯班': { lat: -27.4698, lng: 153.0251 },
            '珀斯': { lat: -31.9505, lng: 115.8605 },
            '阿德莱德': { lat: -34.9285, lng: 138.6007 },
            '堪培拉': { lat: -35.2809, lng: 149.1300 },
            '黄金海岸': { lat: -28.0167, lng: 153.4000 },
            '纽卡斯尔': { lat: -32.9267, lng: 151.7783 },
            '惠灵顿': { lat: -41.2865, lng: 174.7762 },
            '奥克兰': { lat: -36.8485, lng: 174.7633 },
            '基督城': { lat: -43.5321, lng: 172.6362 },
            '但尼丁': { lat: -45.8742, lng: 170.5036 },
            '莫尔兹比港': { lat: -9.4431, lng: 147.1797 },
            '霍尼亚拉': { lat: -9.4333, lng: 159.9500 },
            '维拉港': { lat: -17.7397, lng: 168.3278 },
            '苏瓦': { lat: -18.1416, lng: 178.4419 },
            // 外国城市 - 非洲
            '开罗': { lat: 30.0444, lng: 31.2357 },
            '亚历山大': { lat: 31.2001, lng: 29.9187 },
            '吉萨': { lat: 30.0131, lng: 31.2089 },
            '卢克索': { lat: 25.6867, lng: 32.6333 },
            '阿斯旺': { lat: 24.0889, lng: 32.8998 },
            '的黎波里': { lat: 32.8872, lng: 13.1913 },
            '班加西': { lat: 32.1167, lng: 20.0667 },
            '突尼斯市': { lat: 36.8065, lng: 10.1815 },
            '斯法克斯': { lat: 34.7333, lng: 10.7500 },
            '阿尔及尔': { lat: 36.7538, lng: 3.0588 },
            '奥兰': { lat: 35.6932, lng: -0.6301 },
            '君士坦丁': { lat: 36.3650, lng: 6.6147 },
            '拉巴特': { lat: 34.0209, lng: -6.8416 },
            '卡萨布兰卡': { lat: 33.5731, lng: -7.5898 },
            '丹吉尔': { lat: 35.7596, lng: -5.8330 },
            '马拉喀什': { lat: 31.6295, lng: -7.9811 },
            '努瓦克肖特': { lat: 18.0650, lng: -15.9980 },
            '达喀尔': { lat: 14.6937, lng: -17.4441 },
            '班珠尔': { lat: 13.4432, lng: -16.5786 },
            '巴马科': { lat: 12.6333, lng: -8.0000 },
            '瓦加杜古': { lat: 12.3657, lng: -1.5339 },
            '科纳克里': { lat: 9.5375, lng: -13.7000 },
            '弗里敦': { lat: 8.4840, lng: -13.2299 },
            '蒙罗维亚': { lat: 6.3005, lng: -10.7969 },
            '阿比让': { lat: 5.3451, lng: -4.0246 },
            '亚穆苏克罗': { lat: 6.8264, lng: -5.2893 },
            '阿克拉': { lat: 5.6037, lng: -0.1870 },
            '库马西': { lat: 6.6934, lng: -1.6228 },
            '塔马利': { lat: 9.4000, lng: -0.8333 },
            '洛美': { lat: 6.1241, lng: 1.2208 },
            '波多诺伏': { lat: 6.4965, lng: 2.6036 },
            '科托努': { lat: 6.3690, lng: 2.4172 },
            '尼亚美': { lat: 13.5137, lng: 2.1098 },
            '阿布贾': { lat: 9.0765, lng: 7.3986 },
            '拉各斯': { lat: 6.4541, lng: 3.3947 },
            '卡诺': { lat: 12.0028, lng: 8.5929 },
            '伊巴丹': { lat: 7.3776, lng: 3.9470 },
            '雅温得': { lat: 3.8667, lng: 11.5167 },
            '杜阿拉': { lat: 4.0500, lng: 9.7000 },
            '马拉博': { lat: 3.7500, lng: 8.7833 },
            '恩贾梅纳': { lat: 12.1000, lng: 15.0500 },
            '班吉': { lat: 4.3676, lng: 18.5550 },
            '喀土穆': { lat: 15.5000, lng: 32.5500 },
            '朱巴': { lat: 4.8517, lng: 31.5825 },
            '亚的斯亚贝巴': { lat: 9.0300, lng: 38.7400 },
            '德雷达瓦': { lat: 9.6000, lng: 41.8500 },
            '阿斯马拉': { lat: 15.3311, lng: 38.9250 },
            '摩加迪沙': { lat: 2.0371, lng: 45.3438 },
            '吉布提市': { lat: 11.5820, lng: 43.1456 },
            '内罗毕': { lat: 1.2921, lng: 36.8219 },
            '蒙巴萨': { lat: -4.0435, lng: 39.6682 },
            '基苏木': { lat: 0.1022, lng: 34.7519 },
            '坎帕拉': { lat: 0.3476, lng: 32.5825 },
            '恩德培': { lat: 0.0667, lng: 32.4533 },
            '基加利': { lat: -1.9403, lng: 30.0619 },
            '布琼布拉': { lat: -3.3731, lng: 29.3697 },
            '金沙萨': { lat: -4.3250, lng: 15.3222 },
            '卢本巴希': { lat: -11.6667, lng: 27.4833 },
            '布拉柴维尔': { lat: -4.2667, lng: 15.2667 },
            '利伯维尔': { lat: 0.3900, lng: 9.4500 },
            '罗安达': { lat: -8.8383, lng: 13.2344 },
            '卢萨卡': { lat: -15.4167, lng: 28.2833 },
            '利隆圭': { lat: -13.9626, lng: 33.7741 },
            '马普托': { lat: -25.9650, lng: 32.5892 },
            '贝拉': { lat: -19.8400, lng: 34.8389 },
            '塔那那利佛': { lat: -18.9136, lng: 47.5361 },
            '安塔那那利佛': { lat: -18.9136, lng: 47.5361 },
            '图阿马西纳': { lat: -18.1564, lng: 49.3286 },
            '维多利亚': { lat: -4.6182, lng: 55.4510 },
            '路易港': { lat: -20.1619, lng: 57.4983 },
            '哈拉雷': { lat: -17.8296, lng: 31.0531 },
            '布拉瓦约': { lat: -20.1500, lng: 28.5833 },
            '哈博罗内': { lat: -24.6282, lng: 25.9231 },
            '温得和克': { lat: -22.5594, lng: 17.0833 },
            '比勒陀利亚': { lat: -25.7463, lng: 28.1881 },
            '约翰内斯堡': { lat: -26.2041, lng: 28.0473 },
            '开普敦': { lat: -33.9249, lng: 18.4241 },
            '德班': { lat: -29.8587, lng: 31.0218 },
            '伊丽莎白港': { lat: -33.9600, lng: 25.6000 },
            '姆巴巴内': { lat: -26.3167, lng: 31.1333 },
            '马塞卢': { lat: -29.3178, lng: 27.4881 }
        };
        
        // 城市真实性校验函数
        function isValidCity(city) {
            // 直接匹配
            if (cityCoordinates[city]) {
                return true;
            }
            
            // 去除后缀匹配（市、县、区、镇、乡、村等）
            const cityWithoutSuffix = city.replace(/市|县|区|镇|乡|村|盟|旗|自治州|自治县|自治区|特别行政区|地区|省|直辖市|特别行政区/g, '');
            if (cityCoordinates[cityWithoutSuffix]) {
                return true;
            }
            
            // 如果开头识别出有效的地名，后面的跟随则无需识别
            // 遍历所有城市坐标，检查是否有城市名是输入的前缀
            for (const validCity in cityCoordinates) {
                if (city.startsWith(validCity) || cityWithoutSuffix.startsWith(validCity)) {
                    return true;
                }
            }
            
            // 尝试匹配省份/国家
            const provinceMatch = city.match(/^(北京|上海|天津|重庆|河北|山西|辽宁|吉林|黑龙江|江苏|浙江|安徽|福建|江西|山东|河南|湖北|湖南|广东|海南|四川|贵州|云南|陕西|甘肃|青海|台湾|内蒙古|广西|西藏|宁夏|新疆|香港|澳门|中国|美国|英国|法国|德国|日本|韩国|澳大利亚|加拿大|俄罗斯|印度|巴西|南非|新加坡|马来西亚|泰国|印度尼西亚|菲律宾|越南|柬埔寨|老挝|缅甸|巴基斯坦|孟加拉国|斯里兰卡|尼泊尔|不丹|阿富汗|伊朗|伊拉克|沙特阿拉伯|科威特|阿联酋|卡塔尔|巴林|阿曼|也门|土耳其|叙利亚|黎巴嫩|约旦|以色列|巴勒斯坦|埃及|利比亚|突尼斯|阿尔及利亚|摩洛哥|毛里塔尼亚|塞内加尔|冈比亚|马里|布基纳法索|几内亚|几内亚比绍|佛得角|塞拉利昂|利比里亚|科特迪瓦|加纳|多哥|贝宁|尼日尔|尼日利亚|喀麦隆|赤道几内亚|乍得|中非|苏丹|南苏丹|埃塞俄比亚|厄立特里亚|索马里|吉布提|肯尼亚|坦桑尼亚|乌干达|卢旺达|布隆迪|刚果(金)|刚果(布)|加蓬|圣多美和普林西比|安哥拉|赞比亚|马拉维|莫桑比克|科摩罗|马达加斯加|塞舌尔|毛里求斯|留尼汪|津巴布韦|博茨瓦纳|纳米比亚|南非|斯威士兰|莱索托|挪威|瑞典|芬兰|丹麦|冰岛|爱尔兰|爱沙尼亚|拉脱维亚|立陶宛|白俄罗斯|乌克兰|波兰|捷克|斯洛伐克|匈牙利|罗马尼亚|保加利亚|斯洛文尼亚|克罗地亚|波黑|塞尔维亚|黑山|北马其顿|阿尔巴尼亚|希腊|意大利|梵蒂冈|圣马力诺|马耳他|西班牙|葡萄牙|安道尔|瑞士|列支敦士登|奥地利|比利时|荷兰|卢森堡|摩纳哥|法国|德国|英国|爱尔兰|直布罗陀|美国|加拿大|墨西哥|危地马拉|伯利兹|萨尔瓦多|洪都拉斯|尼加拉瓜|哥斯达黎加|巴拿马|巴哈马|古巴|牙买加|海地|多米尼加|安提瓜和巴布达|圣基茨和尼维斯|多米尼克|圣卢西亚|圣文森特和格林纳丁斯|格林纳达|巴巴多斯|特立尼达和多巴哥|波多黎各|美属维尔京群岛|英属维尔京群岛|安圭拉|蒙特塞拉特|瓜德罗普|马提尼克|圣马丁|圣巴泰勒米|荷属安的列斯|阿鲁巴|库拉索|博奈尔|哥伦比亚|委内瑞拉|圭亚那|苏里南|法属圭亚那|厄瓜多尔|秘鲁|玻利维亚|巴西|智利|阿根廷|乌拉圭|巴拉圭|澳大利亚|新西兰|巴布亚新几内亚|所罗门群岛|瓦努阿图|斐济|基里巴斯|马绍尔群岛|密克罗尼西亚联邦|瑙鲁|帕劳|萨摩亚|汤加|图瓦卢|库克群岛|纽埃|托克劳|美属萨摩亚|关岛|北马里亚纳群岛|法属波利尼西亚|瓦利斯和富图纳|新喀里多尼亚|皮特凯恩群岛)$/);
            if (provinceMatch && cityCoordinates[provinceMatch[1]]) {
                return true;
            }
            
            // 尝试匹配国家首都
            const countryCapitals = {
                '美国': '华盛顿',
                '英国': '伦敦',
                '法国': '巴黎',
                '德国': '柏林',
                '日本': '东京',
                '韩国': '首尔',
                '澳大利亚': '堪培拉',
                '加拿大': '渥太华',
                '俄罗斯': '莫斯科',
                '印度': '新德里',
                '巴西': '巴西利亚',
                '南非': '比勒陀利亚',
                '新加坡': '新加坡',
                '马来西亚': '吉隆坡',
                '泰国': '曼谷',
                '印度尼西亚': '雅加达',
                '菲律宾': '马尼拉',
                '越南': '河内',
                '柬埔寨': '金边',
                '老挝': '万象',
                '缅甸': '内比都',
                '巴基斯坦': '伊斯兰堡',
                '孟加拉国': '达卡',
                '斯里兰卡': '科伦坡',
                '尼泊尔': '加德满都',
                '不丹': '廷布',
                '阿富汗': '喀布尔',
                '伊朗': '德黑兰',
                '伊拉克': '巴格达',
                '沙特阿拉伯': '利雅得',
                '科威特': '科威特城',
                '阿联酋': '阿布扎比',
                '卡塔尔': '多哈',
                '巴林': '麦纳麦',
                '阿曼': '马斯喀特',
                '也门': '萨那',
                '土耳其': '安卡拉',
                '叙利亚': '大马士革',
                '黎巴嫩': '贝鲁特',
                '约旦': '安曼',
                '以色列': '耶路撒冷',
                '巴勒斯坦': '拉姆安拉',
                '埃及': '开罗',
                '利比亚': '的黎波里',
                '突尼斯': '突尼斯市',
                '阿尔及利亚': '阿尔及尔',
                '摩洛哥': '拉巴特',
                '毛里塔尼亚': '努瓦克肖特',
                '塞内加尔': '达喀尔',
                '冈比亚': '班珠尔',
                '马里': '巴马科',
                '布基纳法索': '瓦加杜古',
                '几内亚': '科纳克里',
                '几内亚比绍': '比绍',
                '佛得角': '普拉亚',
                '塞拉利昂': '弗里敦',
                '利比里亚': '蒙罗维亚',
                '科特迪瓦': '亚穆苏克罗',
                '加纳': '阿克拉',
                '多哥': '洛美',
                '贝宁': '波多诺伏',
                '尼日尔': '尼亚美',
                '尼日利亚': '阿布贾',
                '喀麦隆': '雅温得',
                '赤道几内亚': '马拉博',
                '乍得': '恩贾梅纳',
                '中非': '班吉',
                '苏丹': '喀土穆',
                '南苏丹': '朱巴',
                '埃塞俄比亚': '亚的斯亚贝巴',
                '厄立特里亚': '阿斯马拉',
                '索马里': '摩加迪沙',
                '吉布提': '吉布提市'
            };
            
            if (countryCapitals[city] && cityCoordinates[countryCapitals[city]]) {
                return true;
            }
            
            if (countryCapitals[cityWithoutSuffix] && cityCoordinates[countryCapitals[cityWithoutSuffix]]) {
                return true;
            }
            
            // 检查是否为国家名称
            if (countryCapitals.hasOwnProperty(city)) {
                return true;
            }
            
            if (countryCapitals.hasOwnProperty(cityWithoutSuffix)) {
                return true;
            }
            
            // 特殊处理：检查是否为县级市（可能需要更复杂的匹配）
            // 尝试匹配城市名中的省份信息
            const provincePattern = /(北京|上海|天津|重庆|河北|山西|辽宁|吉林|黑龙江|江苏|浙江|安徽|福建|江西|山东|河南|湖北|湖南|广东|海南|四川|贵州|云南|陕西|甘肃|青海|台湾|内蒙古|广西|西藏|宁夏|新疆)/;
            const provinceInCity = city.match(provincePattern);
            if (provinceInCity) {
                // 提取城市名（去除省份）
                const cityOnly = city.replace(provinceInCity[0], '').replace(/市|县|区|镇|乡|村/g, '').trim();
                if (cityCoordinates[cityOnly]) {
                    return true;
                }
            }
            
            return false;
        }
        
        // 计算两点之间的方位角（返回0-360度）
        function calculateBearing(lat1, lng1, lat2, lng2) {
            // 将经纬度转换为弧度
            const toRad = (degrees) => degrees * Math.PI / 180;
            const toDeg = (radians) => radians * 180 / Math.PI;
            
            lat1 = toRad(lat1);
            lng1 = toRad(lng1);
            lat2 = toRad(lat2);
            lng2 = toRad(lng2);
            
            // 计算经度差，使用向东的路径（更符合直观感受）
            let deltaLng = lng2 - lng1;
            
            // 计算方位角
            const y = Math.sin(deltaLng) * Math.cos(lat2);
            const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(deltaLng);
            
            let bearing = Math.atan2(y, x);
            
            // 转换为度数
            bearing = toDeg(bearing);
            
            // 转换为0-360度
            bearing = (bearing + 360) % 360;
            
            return bearing;
        }
        
        // 将方位角转换为方位名称（以45°为划分原则，更符合直观感受）
        function bearingToDirection(bearing) {
            // 调整方位角，确保0-360度
            bearing = (bearing + 360) % 360;
            
            // 更细的方向划分，符合直观感受
            if (bearing < 11.25 || bearing >= 348.75) {
                return '北';
            } else if (bearing >= 11.25 && bearing < 33.75) {
                return '北偏东';
            } else if (bearing >= 33.75 && bearing < 56.25) {
                return '东北';
            } else if (bearing >= 56.25 && bearing < 78.75) {
                return '东偏北';
            } else if (bearing >= 78.75 && bearing < 101.25) {
                return '东';
            } else if (bearing >= 101.25 && bearing < 123.75) {
                return '东偏南';
            } else if (bearing >= 123.75 && bearing < 146.25) {
                return '东南';
            } else if (bearing >= 146.25 && bearing < 168.75) {
                return '南偏东';
            } else if (bearing >= 168.75 && bearing < 191.25) {
                return '南';
            } else if (bearing >= 191.25 && bearing < 213.75) {
                return '南偏西';
            } else if (bearing >= 213.75 && bearing < 236.25) {
                return '西南';
            } else if (bearing >= 236.25 && bearing < 258.75) {
                return '西偏南';
            } else if (bearing >= 258.75 && bearing < 281.25) {
                return '西';
            } else if (bearing >= 281.25 && bearing < 303.75) {
                return '西偏北';
            } else if (bearing >= 303.75 && bearing < 326.25) {
                return '西北';
            } else if (bearing >= 326.25 && bearing < 348.75) {
                return '北偏西';
            }
            return '北'; // 默认返回北
        }
        
        // 获取方位的对应方位（如东北对应西南，东南对应西北）
        function getOppositeDirection(direction) {
            const oppositeMap = {
                '北': '南',
                '北偏东': '南偏西',
                '东北': '西南',
                '东偏北': '西偏南',
                '东': '西',
                '东偏南': '西偏北',
                '东南': '西北',
                '南偏东': '北偏西',
                '南': '北',
                '南偏西': '北偏东',
                '西南': '东北',
                '西偏南': '东偏北',
                '西': '东',
                '西偏北': '东偏南',
                '西北': '东南',
                '北偏西': '南偏东',
                '本地': '本地'
            };
            return oppositeMap[direction] || direction;
        }
        
        // 将方位归类（东北、西北属于北，西南、东南属于南，本地属于南）
        function categorizeDirection(direction) {
            if (['北偏东', '东北', '东偏北', '北偏西', '西北', '西偏北', '北'].includes(direction)) {
                return '北';
            } else if (['南偏东', '东南', '东偏南', '南偏西', '西南', '西偏南', '南', '本地'].includes(direction)) {
                return '南';
            } else if (direction === '东') {
                return '东';
            } else if (direction === '西') {
                return '西';
            }
            return direction;
        }
        
        // 检查方位是否匹配（本地加上南都匹配）
        function isDirectionMatch(direction, soulmateDirections) {
            // 直接匹配
            if (soulmateDirections.includes(direction)) {
                return true;
            }
            
            // 本地匹配南、西南、东南
            if (direction === '本地') {
                return soulmateDirections.some(dir => ['南', '西南', '东南'].includes(dir));
            }
            
            // 南、西南、东南匹配本地
            if (['南', '西南', '东南'].includes(direction)) {
                return soulmateDirections.includes('本地');
            }
            
            // 归类后匹配
            const categorizedDirection = categorizeDirection(direction);
            return soulmateDirections.some(dir => categorizeDirection(dir) === categorizedDirection);
        }
        
        // 基于经纬度的地理位置方位判断
        function getDirection(fromLocation, toLocation) {
            // 检查是否为同一地点
            if (fromLocation === toLocation) {
                return '本地';
            }
            
            // 验证城市真实性
            if (!isValidCity(fromLocation)) {
                throw new Error(`无效的出发城市: ${fromLocation}`);
            }
            
            if (!isValidCity(toLocation)) {
                throw new Error(`无效的目标城市: ${toLocation}`);
            }
            
            // 辅助函数：获取地点的经纬度
            function getCoordinates(location) {
                // 处理重复城市名的特殊情况
                const duplicateCities = {
                    '安阳': ['河南省安阳市', '贵州省安阳县'],
                    '南阳': ['河南省南阳市', '重庆市南川区'],
                    '朝阳': ['辽宁省朝阳市', '北京市朝阳区'],
                    '大同': ['山西省大同市', '台湾省大同区'],
                    '长治': ['山西省长治市', '台湾省长治区'],
                    '晋城': ['山西省晋城市', '台湾省晋安区'],
                    '朔州': ['山西省朔州市', '台湾省朔城区'],
                    '晋中': ['山西省晋中市', '台湾省晋中区'],
                    '运城': ['山西省运城市', '台湾省运城区'],
                    '忻州': ['山西省忻州市', '台湾省忻州区'],
                    '临汾': ['山西省临汾市', '台湾省临汾区'],
                    '吕梁': ['山西省吕梁市', '台湾省吕梁区'],
                    '沈阳': ['辽宁省沈阳市', '台湾省沈阳区'],
                    '大连': ['辽宁省大连市', '台湾省大连区'],
                    '鞍山': ['辽宁省鞍山市', '台湾省鞍山区'],
                    '抚顺': ['辽宁省抚顺市', '台湾省抚顺区'],
                    '本溪': ['辽宁省本溪市', '台湾省本溪区'],
                    '丹东': ['辽宁省丹东市', '台湾省丹东区'],
                    '锦州': ['辽宁省锦州市', '台湾省锦州区'],
                    '营口': ['辽宁省营口市', '台湾省营口区'],
                    '阜新': ['辽宁省阜新市', '台湾省阜新区'],
                    '辽阳': ['辽宁省辽阳市', '台湾省辽阳区'],
                    '盘锦': ['辽宁省盘锦市', '台湾省盘锦区'],
                    '铁岭': ['辽宁省铁岭市', '台湾省铁岭区'],
                    '朝阳': ['辽宁省朝阳市', '北京市朝阳区'],
                    '葫芦岛': ['辽宁省葫芦岛市', '台湾省葫芦岛区']
                };
                
                // 检查是否为重复城市名
                const locationWithoutSuffix = location.replace(/市|县|区|镇|乡|村|盟|旗|自治州|自治县|自治区|特别行政区/g, '');
                if (duplicateCities[locationWithoutSuffix]) {
                    throw new Error(`存在多个同名城市：${duplicateCities[locationWithoutSuffix].join('、')}。请输入更详细的城市名，如"河南省安阳市"或"贵州省安阳县"。`);
                }
                
                // 直接匹配
                if (cityCoordinates[location]) {
                    return cityCoordinates[location];
                }
                
                // 去除后缀匹配（市、县、区、镇、乡、村等）
                if (cityCoordinates[locationWithoutSuffix]) {
                    return cityCoordinates[locationWithoutSuffix];
                }
                
                // 如果开头识别出有效的地名，后面的跟随则无需识别
                // 遍历所有城市坐标，检查是否有城市名是输入的前缀
                for (const validCity in cityCoordinates) {
                    if (location.startsWith(validCity) || locationWithoutSuffix.startsWith(validCity)) {
                        return cityCoordinates[validCity];
                    }
                }
                
                // 尝试匹配省份/国家
                const provinceMatch = location.match(/^(北京|上海|天津|重庆|河北|山西|辽宁|吉林|黑龙江|江苏|浙江|安徽|福建|江西|山东|河南|湖北|湖南|广东|海南|四川|贵州|云南|陕西|甘肃|青海|台湾|内蒙古|广西|西藏|宁夏|新疆|香港|澳门|中国|美国|英国|法国|德国|日本|韩国|澳大利亚|加拿大|俄罗斯|印度|巴西|南非|新加坡|马来西亚|泰国|印度尼西亚|菲律宾|越南|柬埔寨|老挝|缅甸|巴基斯坦|孟加拉国|斯里兰卡|尼泊尔|不丹|阿富汗|伊朗|伊拉克|沙特阿拉伯|科威特|阿联酋|卡塔尔|巴林|阿曼|也门|土耳其|叙利亚|黎巴嫩|约旦|以色列|巴勒斯坦|埃及|利比亚|突尼斯|阿尔及利亚|摩洛哥|毛里塔尼亚|塞内加尔|冈比亚|马里|布基纳法索|几内亚|几内亚比绍|佛得角|塞拉利昂|利比里亚|科特迪瓦|加纳|多哥|贝宁|尼日尔|尼日利亚|喀麦隆|赤道几内亚|乍得|中非|苏丹|南苏丹|埃塞俄比亚|厄立特里亚|索马里|吉布提|肯尼亚|坦桑尼亚|乌干达|卢旺达|布隆迪|刚果(金)|刚果(布)|加蓬|圣多美和普林西比|安哥拉|赞比亚|马拉维|莫桑比克|科摩罗|马达加斯加|塞舌尔|毛里求斯|留尼汪|津巴布韦|博茨瓦纳|纳米比亚|南非|斯威士兰|莱索托|挪威|瑞典|芬兰|丹麦|冰岛|爱尔兰|爱沙尼亚|拉脱维亚|立陶宛|白俄罗斯|乌克兰|波兰|捷克|斯洛伐克|匈牙利|罗马尼亚|保加利亚|斯洛文尼亚|克罗地亚|波黑|塞尔维亚|黑山|北马其顿|阿尔巴尼亚|希腊|意大利|梵蒂冈|圣马力诺|马耳他|西班牙|葡萄牙|安道尔|瑞士|列支敦士登|奥地利|比利时|荷兰|卢森堡|摩纳哥|法国|德国|英国|爱尔兰|直布罗陀|美国|加拿大|墨西哥|危地马拉|伯利兹|萨尔瓦多|洪都拉斯|尼加拉瓜|哥斯达黎加|巴拿马|巴哈马|古巴|牙买加|海地|多米尼加|安提瓜和巴布达|圣基茨和尼维斯|多米尼克|圣卢西亚|圣文森特和格林纳丁斯|格林纳达|巴巴多斯|特立尼达和多巴哥|波多黎各|美属维尔京群岛|英属维尔京群岛|安圭拉|蒙特塞拉特|瓜德罗普|马提尼克|圣马丁|圣巴泰勒米|荷属安的列斯|阿鲁巴|库拉索|博奈尔|哥伦比亚|委内瑞拉|圭亚那|苏里南|法属圭亚那|厄瓜多尔|秘鲁|玻利维亚|巴西|智利|阿根廷|乌拉圭|巴拉圭|澳大利亚|新西兰|巴布亚新几内亚|所罗门群岛|瓦努阿图|斐济|基里巴斯|马绍尔群岛|密克罗尼西亚联邦|瑙鲁|帕劳|萨摩亚|汤加|图瓦卢|库克群岛|纽埃|托克劳|美属萨摩亚|关岛|北马里亚纳群岛|法属波利尼西亚|瓦利斯和富图纳|新喀里多尼亚|皮特凯恩群岛)$/);
                if (provinceMatch && cityCoordinates[provinceMatch[1]]) {
                    return cityCoordinates[provinceMatch[1]];
                }
                
                // 尝试匹配国家首都
                const countryCapitals = {
                    '美国': '华盛顿',
                    '英国': '伦敦',
                    '法国': '巴黎',
                    '德国': '柏林',
                    '日本': '东京',
                    '韩国': '首尔',
                    '澳大利亚': '堪培拉',
                    '加拿大': '渥太华',
                    '俄罗斯': '莫斯科',
                    '印度': '新德里',
                    '巴西': '巴西利亚',
                    '南非': '比勒陀利亚',
                    '新加坡': '新加坡',
                    '马来西亚': '吉隆坡',
                    '泰国': '曼谷',
                    '印度尼西亚': '雅加达',
                    '菲律宾': '马尼拉',
                    '越南': '河内',
                    '柬埔寨': '金边',
                    '老挝': '万象',
                    '缅甸': '内比都',
                    '巴基斯坦': '伊斯兰堡',
                    '孟加拉国': '达卡',
                    '斯里兰卡': '科伦坡',
                    '尼泊尔': '加德满都',
                    '不丹': '廷布',
                    '阿富汗': '喀布尔',
                    '伊朗': '德黑兰',
                    '伊拉克': '巴格达',
                    '沙特阿拉伯': '利雅得',
                    '科威特': '科威特城',
                    '阿联酋': '阿布扎比',
                    '卡塔尔': '多哈',
                    '巴林': '麦纳麦',
                    '阿曼': '马斯喀特',
                    '也门': '萨那',
                    '土耳其': '安卡拉',
                    '叙利亚': '大马士革',
                    '黎巴嫩': '贝鲁特',
                    '约旦': '安曼',
                    '以色列': '耶路撒冷',
                    '巴勒斯坦': '拉姆安拉',
                    '埃及': '开罗',
                    '利比亚': '的黎波里',
                    '突尼斯': '突尼斯市',
                    '阿尔及利亚': '阿尔及尔',
                    '摩洛哥': '拉巴特',
                    '毛里塔尼亚': '努瓦克肖特',
                    '塞内加尔': '达喀尔',
                    '冈比亚': '班珠尔',
                    '马里': '巴马科',
                    '布基纳法索': '瓦加杜古',
                    '几内亚': '科纳克里',
                    '几内亚比绍': '比绍',
                    '佛得角': '普拉亚',
                    '塞拉利昂': '弗里敦',
                    '利比里亚': '蒙罗维亚',
                    '科特迪瓦': '亚穆苏克罗',
                    '加纳': '阿克拉',
                    '多哥': '洛美',
                    '贝宁': '波多诺伏',
                    '尼日尔': '尼亚美',
                    '尼日利亚': '阿布贾',
                    '喀麦隆': '雅温得',
                    '赤道几内亚': '马拉博',
                    '乍得': '恩贾梅纳',
                    '中非': '班吉',
                    '苏丹': '喀土穆',
                    '南苏丹': '朱巴',
                    '埃塞俄比亚': '亚的斯亚贝巴',
                    '厄立特里亚': '阿斯马拉',
                    '索马里': '摩加迪沙',
                    '吉布提': '吉布提市',
                    '肯尼亚': '内罗毕',
                    '坦桑尼亚': '多多马',
                    '乌干达': '坎帕拉',
                    '卢旺达': '基加利',
                    '布隆迪': '布琼布拉',
                    '刚果(金)': '金沙萨',
                    '刚果(布)': '布拉柴维尔',
                    '加蓬': '利伯维尔',
                    '圣多美和普林西比': '圣多美',
                    '安哥拉': '罗安达',
                    '赞比亚': '卢萨卡',
                    '马拉维': '利隆圭',
                    '莫桑比克': '马普托',
                    '科摩罗': '莫罗尼',
                    '马达加斯加': '塔那那利佛',
                    '塞舌尔': '维多利亚',
                    '毛里求斯': '路易港',
                    '留尼汪': '圣但尼',
                    '津巴布韦': '哈拉雷',
                    '博茨瓦纳': '哈博罗内',
                    '纳米比亚': '温得和克',
                    '南非': '比勒陀利亚',
                    '斯威士兰': '姆巴巴内',
                    '莱索托': '马塞卢',
                    '挪威': '奥斯陆',
                    '瑞典': '斯德哥尔摩',
                    '芬兰': '赫尔辛基',
                    '丹麦': '哥本哈根',
                    '冰岛': '雷克雅未克',
                    '爱尔兰': '都柏林',
                    '爱沙尼亚': '塔林',
                    '拉脱维亚': '里加',
                    '立陶宛': '维尔纽斯',
                    '白俄罗斯': '明斯克',
                    '乌克兰': '基辅',
                    '波兰': '华沙',
                    '捷克': '布拉格',
                    '斯洛伐克': '布拉迪斯拉发',
                    '匈牙利': '布达佩斯',
                    '罗马尼亚': '布加勒斯特',
                    '保加利亚': '索非亚',
                    '斯洛文尼亚': '卢布尔雅那',
                    '克罗地亚': '萨格勒布',
                    '波黑': '萨拉热窝',
                    '塞尔维亚': '贝尔格莱德',
                    '黑山': '波德戈里察',
                    '北马其顿': '斯科普里',
                    '阿尔巴尼亚': '地拉那',
                    '希腊': '雅典',
                    '意大利': '罗马',
                    '梵蒂冈': '梵蒂冈城',
                    '圣马力诺': '圣马力诺',
                    '马耳他': '瓦莱塔',
                    '西班牙': '马德里',
                    '葡萄牙': '里斯本',
                    '安道尔': '安道尔城',
                    '瑞士': '伯尔尼',
                    '列支敦士登': '瓦杜兹',
                    '奥地利': '维也纳',
                    '比利时': '布鲁塞尔',
                    '荷兰': '阿姆斯特丹',
                    '卢森堡': '卢森堡市',
                    '摩纳哥': '摩纳哥城',
                    '墨西哥': '墨西哥城',
                    '危地马拉': '危地马拉城',
                    '伯利兹': '贝尔莫潘',
                    '萨尔瓦多': '圣萨尔瓦多',
                    '洪都拉斯': '特古西加尔巴',
                    '尼加拉瓜': '马那瓜',
                    '哥斯达黎加': '圣何塞',
                    '巴拿马': '巴拿马城',
                    '巴哈马': '拿骚',
                    '古巴': '哈瓦那',
                    '牙买加': '金斯敦',
                    '海地': '太子港',
                    '多米尼加': '圣多明各',
                    '安提瓜和巴布达': '圣约翰',
                    '圣基茨和尼维斯': '巴斯特尔',
                    '多米尼克': '罗索',
                    '圣卢西亚': '卡斯特里',
                    '圣文森特和格林纳丁斯': '金斯敦',
                    '格林纳达': '圣乔治',
                    '巴巴多斯': '布里奇敦',
                    '特立尼达和多巴哥': '西班牙港',
                    '哥伦比亚': '波哥大',
                    '委内瑞拉': '加拉加斯',
                    '圭亚那': '乔治敦',
                    '苏里南': '帕拉马里博',
                    '法属圭亚那': '卡宴',
                    '厄瓜多尔': '基多',
                    '秘鲁': '利马',
                    '玻利维亚': '拉巴斯',
                    '巴西': '巴西利亚',
                    '智利': '圣地亚哥',
                    '阿根廷': '布宜诺斯艾利斯',
                    '乌拉圭': '蒙得维的亚',
                    '巴拉圭': '亚松森',
                    '新西兰': '惠灵顿',
                    '巴布亚新几内亚': '莫尔兹比港',
                    '所罗门群岛': '霍尼亚拉',
                    '瓦努阿图': '维拉港',
                    '斐济': '苏瓦',
                    '基里巴斯': '塔拉瓦',
                    '马绍尔群岛': '马朱罗',
                    '密克罗尼西亚联邦': '帕利基尔',
                    '瑙鲁': '亚伦',
                    '帕劳': '梅莱凯奥克',
                    '萨摩亚': '阿皮亚',
                    '汤加': '努库阿洛法',
                    '图瓦卢': '富纳富提',
                    '库克群岛': '阿瓦鲁阿',
                    '纽埃': '阿洛菲',
                    '托克劳': '法考福',
                    '美属萨摩亚': '帕果帕果',
                    '关岛': '阿加尼亚',
                    '北马里亚纳群岛': '塞班',
                    '法属波利尼西亚': '帕皮提',
                    '瓦利斯和富图纳': '马塔乌图',
                    '新喀里多尼亚': '努美阿',
                    '皮特凯恩群岛': '亚当斯敦'
                };
                
                // 尝试匹配国家对应的首都经纬度
                if (countryCapitals[location]) {
                    const capitalCoords = cityCoordinates[countryCapitals[location]];
                    if (capitalCoords) {
                        return capitalCoords;
                    }
                }
                
                // 尝试匹配国家对应的首都经纬度（去除后缀）
                if (countryCapitals[locationWithoutSuffix]) {
                    const capitalCoords = cityCoordinates[countryCapitals[locationWithoutSuffix]];
                    if (capitalCoords) {
                        return capitalCoords;
                    }
                }
                
                // 尝试匹配城市名中的省份/国家
                for (const country in countryCapitals) {
                    if (location.includes(country) || locationWithoutSuffix.includes(country)) {
                        const capitalCoords = cityCoordinates[countryCapitals[country]];
                        if (capitalCoords) {
                            return capitalCoords;
                        }
                    }
                }
                
                // 最后尝试使用中国主要城市的默认经纬度
                const chinaDefaultCoords = { lat: 35.8617, lng: 104.1954 }; // 中国地理中心
                const worldDefaultCoords = { lat: 0, lng: 0 }; // 世界地理中心
                
                // 判断是国内还是国外地点
                const isChinaLocation = /中国|中华人民共和国|大陆|内地|香港|澳门|台湾/.test(location) || 
                                       /北京|上海|天津|重庆|河北|山西|辽宁|吉林|黑龙江|江苏|浙江|安徽|福建|江西|山东|河南|湖北|湖南|广东|海南|四川|贵州|云南|陕西|甘肃|青海|台湾|内蒙古|广西|西藏|宁夏|新疆/.test(location) ||
                                       /市|县|区|镇|乡|村|盟|旗|自治州|自治县|自治区|特别行政区/.test(location);
                
                return isChinaLocation ? chinaDefaultCoords : worldDefaultCoords;
            }
            
            // 获取双方的经纬度
            const fromCoords = getCoordinates(fromLocation);
            const toCoords = getCoordinates(toLocation);
            
            // 计算方位角
            const bearing = calculateBearing(fromCoords.lat, fromCoords.lng, toCoords.lat, toCoords.lng);
            // 转换为方位名称
            return bearingToDirection(bearing);
        }
        
        // 获取感情方位（基于日主五行和性别）
        function getSoulmateDirection(gender, element) {
            let directions = [];
            
            if (gender === 'male') {
                // 男命克者为妻
                const soulmateElement = controllingCycles[element];
                for (const [direction, dirElement] of Object.entries(directionElements)) {
                    if (dirElement === soulmateElement) {
                        directions.push(direction);
                    }
                }
            } else {
                // 女命被克者为夫
                const soulmateElement = Object.keys(controllingCycles).find(key => controllingCycles[key] === element);
                if (soulmateElement) {
                    for (const [direction, dirElement] of Object.entries(directionElements)) {
                        if (dirElement === soulmateElement) {
                            directions.push(direction);
                        }
                    }
                }
            }
            
            // 如果感情方位包含本地，同时显示南、西南、东南
            if (directions.includes('本地')) {
                directions = [...new Set([...directions, '南', '西南', '东南'])];
            }
            
            // 如果感情方位包含南、西南、东南，同时显示本地
            if (directions.some(dir => ['南', '西南', '东南'].includes(dir))) {
                directions = [...new Set([...directions, '本地'])];
            }
            
            return directions.length > 0 ? directions : ['未知'];
        }
        
        // 情侣方位匹配函数（新逻辑）
        function matchLocation(myGender, myLocation, myElement, partnerGender, partnerLocation, partnerElement) {
            let matchScore = 0;
            let explanations = [];
            
            // 1. 检查输入是否完整
            if (!myLocation || !partnerLocation) {
                return {
                    score: 0,
                    isComplete: false,
                    explanations: ['输入信息不完整，请补充双方的出生地信息。']
                };
            }
            
            // 2. 根据新逻辑计算匹配度
            let myViewDirection, partnerViewDirection;
            try {
                // 计算从我的角度看对方的方位
                myViewDirection = getDirection(myLocation, partnerLocation);
                // 计算从对方角度看我的方位（直接使用对应方位，确保正确对应）
                partnerViewDirection = getOppositeDirection(myViewDirection);
            } catch (error) {
                return {
                    score: 0,
                    isComplete: false,
                    explanations: [error.message]
                };
            }
            
            // 获取我的感情方位
            const mySoulmateDirections = getSoulmateDirection(myGender, myElement);
            // 获取对方的感情方位
            const partnerSoulmateDirections = getSoulmateDirection(partnerGender, partnerElement);
            
            // 判断是否匹配
            let myMatch = false;
            let partnerMatch = false;
            
            // 检查我的角度是否匹配
            if (isDirectionMatch(myViewDirection, mySoulmateDirections)) {
                myMatch = true;
                matchScore += 50;
                explanations.push(`从您的角度（${myLocation}）看，${partnerLocation}位于${myViewDirection}方，与您的感情方位匹配。`);
            } else {
                explanations.push(`从您的角度（${myLocation}）看，${partnerLocation}位于${myViewDirection}方，与您的感情方位（${mySoulmateDirections.join('、')}）不匹配。`);
            }
            
            // 检查对方的角度是否匹配
            if (isDirectionMatch(partnerViewDirection, partnerSoulmateDirections)) {
                partnerMatch = true;
                matchScore += 50;
                explanations.push(`从对方角度（${partnerLocation}）看，${myLocation}位于${partnerViewDirection}方，与对方的感情方位匹配。`);
            } else {
                explanations.push(`从对方角度（${partnerLocation}）看，${myLocation}位于${partnerViewDirection}方，与对方的感情方位（${partnerSoulmateDirections.join('、')}）不匹配。`);
            }
            
            // 添加感情成立条件的解释
            if (myMatch && partnerMatch) {
                explanations.push('双方都以自己出生地为定位点，两两位置相互能对上，符合感情成立条件。');
            } else if (myMatch || partnerMatch) {
                explanations.push('两两只有一方对上，感情只有60%的可能。');
            } else {
                explanations.push('双方方位都不匹配，需要更多的感情和努力。');
            }
            
            // 添加五行生克关系的解释
            if (myGender === 'male' && controllingCycles[myElement] === partnerElement) {
                explanations.push(`您是${elementNames[myElement]}日主，男命克者为妻，${elementNames[myElement]}克${elementNames[partnerElement]}，符合命理感情关系。`);
            } else if (myGender === 'female' && controllingCycles[partnerElement] === myElement) {
                explanations.push(`您是${elementNames[myElement]}日主，女命被克者为夫，${elementNames[partnerElement]}克${elementNames[myElement]}，符合命理感情关系。`);
            }
            
            // 确保分数在0-100之间
            matchScore = Math.max(0, Math.min(100, matchScore));
            
            // 根据匹配情况生成不同的解读内容
            let summary = '';
            if (myMatch && partnerMatch) {
                // 双方都匹配 - 100%匹配度
                summary = `<h3 class="text-xl font-bold text-red-600 mb-2">匹配度: 100%</h3>
                           <p class="text-lg italic mb-4">"你们是上天安排的姻缘，穿越千年终将在一起"</p>
                           <p>恭喜！您和伴侣的方位关系非常匹配，这是难得的感情天合关系。</p>`;
            } else if (myMatch || partnerMatch) {
                // 一方匹配 - 60%匹配度
                summary = `<h3 class="text-xl font-bold text-yellow-600 mb-2">匹配度: 60%</h3>
                           <p class="text-lg italic mb-4">"你们是几世的孽缘，今生需要相互就餐和救赎方能在厮守终生"</p>
                           <p>虽然不是最完美的匹配，但仍有不错的感情基础。需要双方共同努力经营这份感情。</p>`;
            } else {
                // 都不匹配 - 30%匹配度
                        summary = `<h3 class="text-xl font-bold text-gray-600 mb-2">匹配度: 30%</h3>
                           <p class="text-lg italic mb-4 text-gray-600 border-l-4 border-gray-300 pl-4 py-2 bg-gray-50">"你们只是过客，千百年只换来一次插肩"</p>
                           <p class="text-gray-700">方位关系不是很匹配，需要更多的感情积累和双方的真诚付出。</p>`;
            }
            
            // 返回纯数据，不包含HTML
            return { 
                score: matchScore, 
                summary: summary,
                myMatch, 
                partnerMatch,
                myLocation,
                partnerLocation,
                myViewDirection,
                partnerViewDirection,
                mySoulmateDirections,
                partnerSoulmateDirections,
                myElement,
                partnerElement,
                explanations 
            };
        }
        
        // 检查天干关系
        function checkStemRelationship(stem1, stem2) {
            // 天干五合关系
            const combiningPairs = {
                jia: 'yi',
                yi: 'jia',
                bing: 'ding',
                ding: 'bing',
                wu: 'ji',
                ji: 'wu',
                geng: 'xin',
                xin: 'geng',
                ren: 'gui',
                gui: 'ren'
            };
            
            if (combiningPairs[stem1] === stem2) {
                return { score: 25, explanation: `天干${getStemName(stem1)}与${getStemName(stem2)}相合，两人在思想和沟通上较为契合。` };
            }
            
            // 天干相生关系
            const generatingPairs = {
                jia: ['bing', 'ding'],
                yi: ['bing', 'ding'],
                bing: ['wu', 'ji'],
                ding: ['wu', 'ji'],
                wu: ['geng', 'xin'],
                ji: ['geng', 'xin'],
                geng: ['ren', 'gui'],
                xin: ['ren', 'gui'],
                ren: ['jia', 'yi'],
                gui: ['jia', 'yi']
            };
            
            if (generatingPairs[stem1] && generatingPairs[stem1].includes(stem2)) {
                return { score: 20, explanation: `天干${getStemName(stem1)}生${getStemName(stem2)}，关系较为和谐。` };
            }
            
            // 天干相克关系
            const controllingPairs = {
                jia: ['wu', 'ji'],
                yi: ['wu', 'ji'],
                bing: ['ren', 'gui'],
                ding: ['ren', 'gui'],
                wu: ['ren', 'gui'],
                ji: ['ren', 'gui'],
                geng: ['jia', 'yi'],
                xin: ['jia', 'yi'],
                ren: ['bing', 'ding'],
                gui: ['bing', 'ding']
            };
            
            if (controllingPairs[stem1] && controllingPairs[stem1].includes(stem2)) {
                return { score: -10, explanation: `天干${getStemName(stem1)}克${getStemName(stem2)}，可能会有一些观念上的差异。` };
            }
            
            return { score: 5, explanation: '天干关系一般，需要通过沟通建立理解。' };
        }
        
        // 检查地支关系
        function checkBranchRelationship(branch1, branch2) {
            // 地支六合关系
            const sixCombining = {
                zi: 'chou',
                chou: 'zi',
                yin: 'hai',
                mao: 'xu',
                chen: 'you',
                si: 'shen',
                wu: 'wei',
                wei: 'wu',
                shen: 'si',
                you: 'chen',
                xu: 'mao',
                hai: 'yin'
            };
            
            if (sixCombining[branch1] === branch2) {
                return { score: 30, explanation: `地支${getBranchName(branch1)}与${getBranchName(branch2)}六合，两人相处较为融洽。` };
            }
            
            // 地支三会关系
            const threeCombining = {
                wood: ['yin', 'mao', 'chen'],
                fire: ['si', 'wu', 'wei'],
                earth: ['chen', 'wei', 'xu', 'chou'],
                metal: ['shen', 'you', 'xu'],
                water: ['hai', 'zi', 'chou']
            };
            
            for (const [element, branches] of Object.entries(threeCombining)) {
                if (branches.includes(branch1) && branches.includes(branch2)) {
                    return { score: 20, explanation: `地支${getBranchName(branch1)}与${getBranchName(branch2)}同属${element}，有共同语言和兴趣。` };
                }
            }
            
            // 地支六冲关系
            const sixOpposing = {
                zi: 'wu',
                chou: 'wei',
                yin: 'shen',
                mao: 'you',
                chen: 'xu',
                si: 'hai',
                wu: 'zi',
                wei: 'chou',
                shen: 'yin',
                you: 'mao',
                xu: 'chen',
                hai: 'si'
            };
            
            if (sixOpposing[branch1] === branch2) {
                return { score: -15, explanation: `地支${getBranchName(branch1)}与${getBranchName(branch2)}相冲，可能会有一些性格上的冲突。` };
            }
            
            return { score: 5, explanation: '地支关系一般，需要相互适应。' };
        }
        
        // 获取天干名称
        function getStemName(stem) {
            const names = {
                jia: '甲',
                yi: '乙',
                bing: '丙',
                ding: '丁',
                wu: '戊',
                ji: '己',
                geng: '庚',
                xin: '辛',
                ren: '壬',
                gui: '癸'
            };
            return names[stem] || stem;
        }
        
        // 获取地支名称
        function getBranchName(branch) {
            const names = {
                zi: '子',
                chou: '丑',
                yin: '寅',
                mao: '卯',
                chen: '辰',
                si: '巳',
                wu: '午',
                wei: '未',
                shen: '申',
                you: '酉',
                xu: '戌',
                hai: '亥'
            };
            return names[branch] || branch;
        }
        
        // 获取天干的五行属性
        function getStemElement(stem) {
            const elements = {
                jia: 'wood',
                yi: 'wood',
                bing: 'fire',
                ding: 'fire',
                wu: 'earth',
                ji: 'earth',
                geng: 'metal',
                xin: 'metal',
                ren: 'water',
                gui: 'water'
            };
            return elements[stem] || 'unknown';
        }
        
        // 检查五行关系
        function checkElementRelationship(element1, element2, gender1, gender2) {
            // 五行相生关系
            const generatingCycles = {
                wood: 'fire',
                fire: 'earth',
                earth: 'metal',
                metal: 'water',
                water: 'wood'
            };
            
            // 五行相克关系
            const controllingCycles = {
                wood: 'earth',
                fire: 'metal',
                earth: 'water',
                metal: 'wood',
                water: 'fire'
            };
            
            const elementNames = {
                wood: '木',
                fire: '火',
                earth: '土',
                metal: '金',
                water: '水'
            };
            
            // 如果是异性，相生关系更有利
            if (gender1 !== gender2) {
                if (generatingCycles[element1] === element2) {
                    return { score: 15, explanation: `五行${elementNames[element1]}生${elementNames[element2]}，异性相生关系更为和谐。` };
                } else if (generatingCycles[element2] === element1) {
                    return { score: 15, explanation: `五行${elementNames[element2]}生${elementNames[element1]}，异性相生关系更为和谐。` };
                }
            }
            
            // 同性相克关系需要更多调和
            if (gender1 === gender2 && controllingCycles[element1] === element2) {
                return { score: -10, explanation: `同性之间${elementNames[element1]}克${elementNames[element2]}，需要更多的理解和包容。` };
            }
            
            // 五行相同
            if (element1 === element2) {
                return { score: 10, explanation: `五行同为${elementNames[element1]}，有共同的性格特点。` };
            }
            
            return { score: 0, explanation: '' };
        }
        
        // 标签页切换函数 - 增强浏览器兼容性版本
        function initTabs() {
            // 使用标准DOM API替代querySelectorAll，增强兼容性
            var tabs = document.getElementsByClassName('tab-btn');
            var tabContents = document.getElementsByClassName('tab-content');
            
            // 使用标准for循环替代forEach，兼容旧浏览器
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].addEventListener('click', function() {
                    // 获取目标标签页ID
                    var targetId = this.getAttribute('data-target');
                    
                    // 更新标签样式 - 只切换active类，保持其他样式一致
                    for (var j = 0; j < tabs.length; j++) {
                        tabs[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    
                    // 更新内容显示
                    for (var k = 0; k < tabContents.length; k++) {
                        tabContents[k].classList.remove('active');
                        tabContents[k].style.display = 'none';
                        if (tabContents[k].id === targetId) {
                            tabContents[k].classList.add('active');
                            tabContents[k].style.display = 'block';
                        }
                    }
                });
            }
        }
        
        // 天干为阳干或阴干
        const stemYinyang = {
            'jia': 'yang', 'yi': 'yin',
            'bing': 'yang', 'ding': 'yin',
            'wu': 'yang', 'ji': 'yin',
            'geng': 'yang', 'xin': 'yin',
            'ren': 'yang', 'gui': 'yin'
        };
        
        // 地支为阳支或阴支
        const branchYinyang = {
            'zi': 'yang', 'chou': 'yin',
            'yin': 'yang', 'mao': 'yin',
            'chen': 'yang', 'si': 'yin',
            'wu': 'yang', 'wei': 'yin',
            'shen': 'yang', 'you': 'yin',
            'xu': 'yang', 'hai': 'yin'
        };
        
        // 验证天干地支阴阳匹配
        // 定义六十甲子表（正确的天干地支组合）
        const sixtyJiaZi = {
            'jia-zi': true,
            'yi-chou': true,
            'bing-yin': true,
            'ding-mao': true,
            'wu-chen': true,
            'ji-si': true,
            'geng-wu': true,
            'xin-wei': true,
            'ren-shen': true,
            'gui-you': true,
            'jia-xu': true,
            'yi-hai': true,
            'bing-zi': true,
            'ding-chou': true,
            'wu-yin': true,
            'ji-mao': true,
            'geng-chen': true,
            'xin-si': true,
            'ren-wu': true,
            'gui-wei': true,
            'jia-shen': true,
            'yi-you': true,
            'bing-xu': true,
            'ding-hai': true,
            'wu-zi': true,
            'ji-chou': true,
            'geng-yin': true,
            'xin-mao': true,
            'ren-chen': true,
            'gui-si': true,
            'jia-wu': true,
            'yi-wei': true,
            'bing-shen': true,
            'ding-you': true,
            'wu-xu': true,
            'ji-hai': true,
            'geng-zi': true,
            'xin-chou': true,
            'ren-yin': true,
            'gui-mao': true,
            'jia-chen': true,
            'yi-si': true,
            'bing-wu': true,
            'ding-wei': true,
            'wu-shen': true,
            'ji-you': true,
            'geng-xu': true,
            'xin-hai': true,
            'ren-zi': true,
            'gui-chou': true,
            'jia-yin': true,
            'yi-mao': true,
            'bing-chen': true,
            'ding-si': true,
            'wu-wu': true,
            'ji-wei': true,
            'geng-shen': true,
            'xin-you': true,
            'ren-xu': true,
            'gui-hai': true
        };

        function validateYinyangMatch(stemId, branchId) {
            // 定义天干地支中文名称映射
            const stemsChinese = { 'jia': '甲', 'yi': '乙', 'bing': '丙', 'ding': '丁', 'wu': '戊', 'ji': '己', 'geng': '庚', 'xin': '辛', 'ren': '壬', 'gui': '癸' };
            const branchesChinese = { 'zi': '子', 'chou': '丑', 'yin': '寅', 'mao': '卯', 'chen': '辰', 'si': '巳', 'wu': '午', 'wei': '未', 'shen': '申', 'you': '酉', 'xu': '戌', 'hai': '亥' };
            
            const stem = document.getElementById(stemId).value;
            const branch = document.getElementById(branchId).value;
            const stemYinyangValue = stemYinyang[stem];
            const branchYinyangValue = branchYinyang[branch];
            
            // 获取柱子类型（年、月、日、时）
            const pillarType = stemId.split('-')[0];
            const pillarNames = {
                'year': '年柱',
                'month': '月柱',
                'day': '日柱',
                'hour': '时柱'
            };
            const pillarName = pillarNames[pillarType] || pillarType;
            
            // 获取元素引用
            const stemElement = document.getElementById(stemId);
            const branchElement = document.getElementById(branchId);
            
            // 显示或隐藏错误提示
            const errorId = `${stemId}-${branchId}-error`;
            let errorElement = document.getElementById(errorId);
            
            if (!errorElement) {
                // 创建错误提示元素
                errorElement = document.createElement('div');
                errorElement.id = errorId;
                errorElement.className = 'text-warning text-sm p-2 bg-warning/10 rounded mt-2 border border-warning/30';
                errorElement.style.display = 'block';
                errorElement.style.width = '100%';
                errorElement.style.marginTop = '5px';
                errorElement.style.marginBottom = '5px';
                errorElement.style.display = 'none';
                branchElement.parentNode.appendChild(errorElement);
            }
            
            let hasWarning = false;
            let warningMessage = '';
            
            // 检查六十甲子有效性
            const jiaZiKey = `${stem}-${branch}`;
            if (!sixtyJiaZi[jiaZiKey]) {
                // 设置警告信息，提示非有效的六十甲子组合
                warningMessage = `${pillarName}组合提示："${stemsChinese[stem]}${branchesChinese[branch]}"不是有效的六十甲子组合`;
                hasWarning = true;
            }
            
            // 检查阴阳匹配
            if (stemYinyangValue !== branchYinyangValue) {
                warningMessage = `${pillarName}提示：阳干应配阳支，阴干应配阴支`;
                hasWarning = true;
            }
            
            // 显示或隐藏警告
            if (hasWarning) {
                // 清除空框内的提示信息
                errorElement.textContent = '';
                errorElement.style.display = 'none';
                
                // 使用toast显示警告信息（保留）
                showToast(warningMessage);
                
                // 添加黄色边框提示样式（不阻止用户选择）
                stemElement.style.border = '2px solid #ffcc00';
                branchElement.style.border = '2px solid #ffcc00';
                stemElement.style.backgroundColor = '#fff8e1';
                branchElement.style.backgroundColor = '#fff8e1';
            } else {
                // 隐藏警告信息
                errorElement.style.display = 'none';
                
                // 移除边框提示样式
                stemElement.style.border = '';
                branchElement.style.border = '';
                stemElement.style.backgroundColor = '';
                branchElement.style.backgroundColor = '';
            }
            
            // 返回验证结果
            return !hasWarning;
        }

        // 定义年柱和月柱的有效组合规则（防止甲子年出现甲寅月等情况）
        const validYearMonthCombinations = {
            // 甲年正月为丙寅，二月为丁卯，...
            'jia': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'],
            // 乙年正月为戊寅，二月为己卯，...
            'yi': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'],
            // 丙年正月为庚寅，二月为辛卯，...
            'bing': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'],
            // 丁年正月为壬寅，二月为癸卯，...
            'ding': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'],
            // 戊年正月为甲寅，二月为乙卯，...
            'wu': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'],
            // 己年正月为丙寅，二月为丁卯，...
            'ji': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'],
            // 庚年正月为戊寅，二月为己卯，...
            'geng': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'],
            // 辛年正月为庚寅，二月为辛卯，...
            'xin': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'],
            // 壬年正月为壬寅，二月为癸卯，...
            'ren': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'],
            // 癸年正月为甲寅，二月为乙卯，...
            'gui': ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou']
        };

        // 根据年干过滤符合五虎遁规则的月支（所有月支都符合规则，只需在选择后计算月干）
        function filterMonthBranches() {
            const yearStem = document.getElementById('year-stem').value;
            const monthBranch = document.getElementById('month-branch').value;
            
            if (monthBranch && yearStem) {
                // 月干根据年干和月支自动计算，符合五虎遁规则
                autoCalculateMonthStem();
            }
        }
        
        // 根据月干过滤月支，确保符合阴阳属性匹配
        function filterMonthStemsByYinyang() {
            const monthStem = document.getElementById('month-stem').value;
            const monthBranchSelect = document.getElementById('month-branch');
            const monthBranchOptions = monthBranchSelect.options;
            
            if (monthStem) {
                // 获取月干的阴阳属性
                const stemYinYangValue = stemYinyang[monthStem];
                
                // 过滤月支选项，只显示与月干阴阳属性匹配的组合
                // 允许用户自主选择，不再自动纠正
                for (let i = 0; i < monthBranchOptions.length; i++) {
                    const branch = monthBranchOptions[i].value;
                    const branchYinYangValue = branchYinyang[branch];
                    // 仅显示与月干阴阳属性匹配的月支
                    monthBranchOptions[i].style.display = (stemYinYangValue === branchYinYangValue) ? '' : 'none';
                }
                
                // 不再自动纠正选择，允许用户自主选择
                // 只进行显示过滤，不修改用户的选择
            } else {
                // 如果没有选择月干，显示所有月支选项
                for (let i = 0; i < monthBranchOptions.length; i++) {
                    monthBranchOptions[i].style.display = '';
                }
            }
        }
        
        // 根据时干过滤时支，不再限制阴阳属性匹配
        function filterHourBranches() {
            const hourStem = document.getElementById('hour-stem').value;
            const hourBranchSelect = document.getElementById('hour-branch');
            const hourBranchOptions = hourBranchSelect.options;
            
            // 显示所有时支选项，允许用户自主选择
            for (let i = 0; i < hourBranchOptions.length; i++) {
                hourBranchOptions[i].style.display = '';
            }
        }
        
        // 根据年干过滤年支，确保符合六十甲子规则
        function filterYearBranches() {
            const yearStem = document.getElementById('year-stem').value;
            const yearBranchSelect = document.getElementById('year-branch');
            const yearBranchOptions = yearBranchSelect.options;
            
            if (yearStem) {
                // 过滤年支选项，只显示与年干匹配的六十甲子组合
                for (let i = 0; i < yearBranchOptions.length; i++) {
                    const branch = yearBranchOptions[i].value;
                    const jiaZiKey = `${yearStem}-${branch}`;
                    yearBranchOptions[i].style.display = sixtyJiaZi[jiaZiKey] ? '' : 'none';
                }
                
                // 不再自动纠正选择，允许用户自主选择
                // 只进行显示过滤，不修改用户的选择
            } else {
                // 如果没有选择年干，显示所有年支选项
                for (let i = 0; i < yearBranchOptions.length; i++) {
                    yearBranchOptions[i].style.display = '';
                }
            }
        }
        
        // 根据月干过滤月支，确保符合五虎遁规则和阴阳属性匹配
        function filterMonthStems() {
            const monthStem = document.getElementById('month-stem').value;
            const monthBranchSelect = document.getElementById('month-branch');
            const monthBranchOptions = monthBranchSelect.options;
            
            if (monthStem) {
                // 获取月干的阴阳属性
                const stemYinYangValue = stemYinyang[monthStem];
                
                // 过滤月支选项，只显示与月干阴阳属性匹配的组合
                for (let i = 0; i < monthBranchOptions.length; i++) {
                    const branch = monthBranchOptions[i].value;
                    const branchYinYangValue = branchYinyang[branch];
                    // 仅显示与月干阴阳属性匹配的月支
                    monthBranchOptions[i].style.display = (stemYinYangValue === branchYinYangValue) ? '' : 'none';
                }
                
                // 不再自动纠正选择，允许用户自主选择
                // 只进行显示过滤，不修改用户的选择
            } else {
                // 如果没有选择月干，显示所有月支选项
                for (let i = 0; i < monthBranchOptions.length; i++) {
                    monthBranchOptions[i].style.display = '';
                }
            }
        }
        
        // 根据日支过滤日干，确保符合六十甲子规则
        // 用于防止循环触发的标志
        let isProgrammaticChange = false;
        
        // 根据日支过滤日干，确保符合六十甲子规则和阴阳属性匹配
        function filterDayStems() {
            const dayStemSelect = document.getElementById('day-stem');
            const dayStemOptions = dayStemSelect.options;
            
            // 始终显示所有日干选项，完全移除过滤逻辑
            // 允许用户自由选择任何天干（包括阴干）
            for (let i = 0; i < dayStemOptions.length; i++) {
                dayStemOptions[i].style.display = '';
            }
        }
        
        // 根据日干过滤日支，确保符合六十甲子规则和阴阳属性匹配
        function filterDayBranches() {
            const dayBranchSelect = document.getElementById('day-branch');
            const dayBranchOptions = dayBranchSelect.options;
            
            // 始终显示所有日支选项，完全移除过滤逻辑
            // 允许用户自由选择任何日支
            for (let i = 0; i < dayBranchOptions.length; i++) {
                dayBranchOptions[i].style.display = '';
            }
        }
        
        // 根据时支过滤时干，确保符合阴阳属性匹配
        function filterHourStems() {
            const hourBranch = document.getElementById('hour-branch').value;
            const hourStemSelect = document.getElementById('hour-stem');
            const hourStemOptions = hourStemSelect.options;
            
            // 不再调用autoCalculateHourStem，避免强制设置时干
            
            // 不再进行阴阳属性匹配检查，显示所有时干选项
            if (hourBranch && hourStemOptions) {
                // 显示所有时干选项，允许用户自主选择
                for (let i = 0; i < hourStemOptions.length; i++) {
                    hourStemOptions[i].style.display = '';
                }
                
                // 不再自动纠正选择，允许用户自主选择
                // 只进行显示过滤，不修改用户的选择
            }
        }
        
        // 根据年干和月支自动计算符合五虎遁规则的月干
        function autoCalculateMonthStem() {
            const yearStem = document.getElementById('year-stem').value;
            const monthBranch = document.getElementById('month-branch').value;
            const monthStemSelect = document.getElementById('month-stem');
            
            // 如果年干和月支都已选择
            if (yearStem && monthBranch) {
                // 五虎遁规则（年干确定月干）
                const monthStemRule = {
                    'jia': ['bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding'],
                    'yi': ['wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji'],
                    'bing': ['geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin'],
                    'ding': ['ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui'],
                    'wu': ['jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi'],
                    'ji': ['bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding'],
                    'geng': ['wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji'],
                    'xin': ['geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin'],
                    'ren': ['ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui'],
                    'gui': ['jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi']
                };
                
                // 获取月支对应的索引（寅月为正月，索引0）
                const monthIndex = ['yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai', 'zi', 'chou'].indexOf(monthBranch);
                
                // 不再自动设置月干，允许用户自主选择
                // 只进行显示过滤，不修改用户的选择
            }
        }
        

        
        // 根据日干过滤时支（不强制计算时干，允许用户自主选择）
        function filterHourBranchesByDayStem() {
            const hourBranchSelect = document.getElementById('hour-branch');
            const hourOptions = hourBranchSelect.options;
            
            // 显示所有时支选项
            for (let i = 0; i < hourOptions.length; i++) {
                hourOptions[i].style.display = '';
            }
            
            // 不再自动计算时干，允许用户自主选择
        }
        
        // 根据年支自动调整年干，确保符合六十甲子规则
        function autoCalculateYearStem() {
            const yearBranch = document.getElementById('year-branch').value;
            const yearStemSelect = document.getElementById('year-stem');
            
            if (yearBranch) {
                // 六十甲子的年干年支对应关系（以年支为键）
                const yearStemByBranch = {
                    'zi': ['jia', 'bing', 'wu', 'geng', 'ren'],    // 子年可能的天干：甲、丙、戊、庚、壬
                    'chou': ['yi', 'ding', 'ji', 'xin', 'gui'],     // 丑年可能的天干：乙、丁、己、辛、癸
                    'yin': ['jia', 'bing', 'wu', 'geng', 'ren'],    // 寅年可能的天干：甲、丙、戊、庚、壬
                    'mao': ['yi', 'ding', 'ji', 'xin', 'gui'],     // 卯年可能的天干：乙、丁、己、辛、癸
                    'chen': ['jia', 'bing', 'wu', 'geng', 'ren'],    // 辰年可能的天干：甲、丙、戊、庚、壬
                    'si': ['yi', 'ding', 'ji', 'xin', 'gui'],     // 巳年可能的天干：乙、丁、己、辛、癸
                    'wu': ['jia', 'bing', 'wu', 'geng', 'ren'],    // 午年可能的天干：甲、丙、戊、庚、壬
                    'wei': ['yi', 'ding', 'ji', 'xin', 'gui'],     // 未年可能的天干：乙、丁、己、辛、癸
                    'shen': ['jia', 'bing', 'wu', 'geng', 'ren'],    // 申年可能的天干：甲、丙、戊、庚、壬
                    'you': ['yi', 'ding', 'ji', 'xin', 'gui'],     // 酉年可能的天干：乙、丁、己、辛、癸
                    'xu': ['jia', 'bing', 'wu', 'geng', 'ren'],    // 戌年可能的天干：甲、丙、戊、庚、壬
                    'hai': ['yi', 'ding', 'ji', 'xin', 'gui']      // 亥年可能的天干：乙、丁、己、辛、癸
                };
                
                // 不再自动纠正年干，允许用户自主选择
                // 只进行显示过滤，不修改用户的选择
            }
        }
        
        // 根据日干和时支自动计算符合五鼠遁规则的时干
        function autoCalculateHourStem() {
            const dayStem = document.getElementById('day-stem').value;
            const hourBranch = document.getElementById('hour-branch').value;
            const hourStemSelect = document.getElementById('hour-stem');
            
            // 如果日干和时支都已选择
            if (dayStem && hourBranch) {
                // 五鼠遁规则（日干确定时干）
                const hourStemRule = {
                    'jia': ['jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi'],
                    'yi': ['bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding'],
                    'bing': ['wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji'],
                    'ding': ['geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin'],
                    'wu': ['ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui'],
                    'ji': ['jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi'],
                    'geng': ['bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding'],
                    'xin': ['wu', 'ji', 'geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji'],
                    'ren': ['geng', 'xin', 'ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin'],
                    'gui': ['ren', 'gui', 'jia', 'yi', 'bing', 'ding', 'wu', 'ji', 'geng', 'xin', 'ren', 'gui']
                };
                
                // 获取时支对应的索引（子时为索引0）
                const hourIndex = ['zi', 'chou', 'yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai'].indexOf(hourBranch);
                
                if (hourIndex !== -1 && hourStemRule[dayStem]) {
                    // 获取时支的阴阳属性
                    const branchYinYang = branchYinyang[hourBranch];
                    
                    // 根据五鼠遁规则获取时干
                    const calculatedStem = hourStemRule[dayStem][hourIndex];
                    const calculatedStemYinYang = stemYinyang[calculatedStem];
                    
                    // 不再强制设置时干，允许用户自主选择
                    // 只进行显示过滤，不修改用户的选择
                        hourStemSelect.dispatchEvent(event);
                        isProgrammaticChange = false;
                    }
                }
            }
        
        // 设置自动计算功能的事件监听器
        function setupAutoCalculation() {
            // 年干变化时，过滤月支和年支
            document.getElementById('year-stem').addEventListener('change', function() {
                filterMonthBranches();
                filterYearBranches();
            });
            
            // 年支变化时，自动调整年干以符合六十甲子规则
            document.getElementById('year-branch').addEventListener('change', autoCalculateYearStem);
            
            // 月支变化时，自动计算月干
            document.getElementById('month-branch').addEventListener('change', autoCalculateMonthStem);
            
            // 月干变化时，检查月干是否符合五虎遁规则和过滤月支
            document.getElementById('month-stem').addEventListener('change', function(event) {
                if (!event.isProgrammatic) {
                    filterMonthStems();
                    filterMonthBranches();
                }
            });
            
            // 月支变化时，使用新的filterMonthBranches函数
            document.getElementById('month-branch').addEventListener('change', filterMonthBranches);
            
            // 日支变化时，过滤日干以符合六十甲子规则
            document.getElementById('day-branch').addEventListener('change', function(event) {
                // 防止循环触发 - 如果是程序触发的事件，则不执行过滤
                if (!event.isProgrammatic) {
                    filterDayStems();
                }
            });
            
            // 日干变化时，过滤日支和时支
            document.getElementById('day-stem').addEventListener('change', function(event) {
                // 防止循环触发 - 如果是程序触发的事件，则只执行时支过滤
                if (event.isProgrammatic) {
                    filterHourBranches();
                } else {
                    filterDayBranches();
                    filterHourBranches();
                }
            });
            
            // 时支变化时，自动计算时干
            document.getElementById('hour-branch').addEventListener('change', function(event) {
                // 防止循环触发 - 如果是程序触发的事件，则不执行计算
                if (!event.isProgrammatic) {
                    autoCalculateHourStem();
                }
            });
            
            // 时干变化时，检查时干是否符合五鼠遁规则和过滤时支
            document.getElementById('hour-stem').addEventListener('change', function(event) {
                // 防止循环触发 - 如果是程序触发的事件，则不执行过滤
                if (!event.isProgrammatic) {
                    filterHourStems();
                    filterHourBranches();
                }
            });
            
            // 时支变化时，使用新的filterHourBranchesByDayStem函数
            document.getElementById('hour-branch').addEventListener('change', function(event) {
                // 防止循环触发 - 如果是程序触发的事件，则不执行计算
                if (!event.isProgrammatic) {
                    autoCalculateHourStem();
                    filterHourBranchesByDayStem();
                }
            });
            
            // 页面加载时初始化所有过滤功能
            filterMonthBranches();
            filterHourBranches();
            filterYearBranches();
            filterDayBranches();
            
            // 初始化日支过滤
            const dayBranch = document.getElementById('day-branch').value;
            if (dayBranch) {
                filterDayStems();
            }
        }
        
        // 验证所有柱子的组合规则
        function validateAllCombinations() {
            // 定义天干地支中文名称映射
            const stemsChinese = { 'jia': '甲', 'yi': '乙', 'bing': '丙', 'ding': '丁', 'wu': '戊', 'ji': '己', 'geng': '庚', 'xin': '辛', 'ren': '壬', 'gui': '癸' };
            const branchesChinese = { 'zi': '子', 'chou': '丑', 'yin': '寅', 'mao': '卯', 'chen': '辰', 'si': '巳', 'wu': '午', 'wei': '未', 'shen': '申', 'you': '酉', 'xu': '戌', 'hai': '亥' };
            
            // 获取所有柱子的天干地支值
            const yearStem = document.getElementById('year-stem').value;
            const yearBranch = document.getElementById('year-branch').value;
            const monthStem = document.getElementById('month-stem').value;
            const monthBranch = document.getElementById('month-branch').value;
            const dayStem = document.getElementById('day-stem').value;
            const dayBranch = document.getElementById('day-branch').value;
            const hourStem = document.getElementById('hour-stem').value;
            const hourBranch = document.getElementById('hour-branch').value;
            
            // 基本检查：确保所有字段都有值
            if (!yearStem || !yearBranch || !monthStem || !monthBranch || !dayStem || !dayBranch || !hourStem || !hourBranch) {
                return {
                    isValid: false,
                    message: '请填写完整的八字信息',
                    errorPillars: ['年柱', '月柱', '日柱', '时柱']
                };
            }
            
            // 五虎遁规则（年干确定月干）
            const wuhuDunn = {
                'jia': {'yin': 'bing', 'mao': 'ding', 'chen': 'wu', 'si': 'ji', 'wu': 'geng', 'wei': 'xin', 'shen': 'ren', 'you': 'gui', 'xu': 'jia', 'hai': 'yi', 'zi': 'bing', 'chou': 'ding'},
                'yi': {'yin': 'wu', 'mao': 'ji', 'chen': 'geng', 'si': 'xin', 'wu': 'ren', 'wei': 'gui', 'shen': 'jia', 'you': 'yi', 'xu': 'bing', 'hai': 'ding', 'zi': 'wu', 'chou': 'ji'},
                'bing': {'yin': 'geng', 'mao': 'xin', 'chen': 'ren', 'si': 'gui', 'wu': 'jia', 'wei': 'yi', 'shen': 'bing', 'you': 'ding', 'xu': 'wu', 'hai': 'ji', 'zi': 'geng', 'chou': 'xin'},
                'ding': {'yin': 'ren', 'mao': 'gui', 'chen': 'jia', 'si': 'yi', 'wu': 'bing', 'wei': 'ding', 'shen': 'wu', 'you': 'ji', 'xu': 'geng', 'hai': 'xin', 'zi': 'ren', 'chou': 'gui'},
                'wu': {'yin': 'jia', 'mao': 'yi', 'chen': 'bing', 'si': 'ding', 'wu': 'wu', 'wei': 'ji', 'shen': 'geng', 'you': 'xin', 'xu': 'ren', 'hai': 'gui', 'zi': 'jia', 'chou': 'yi'},
                'ji': {'yin': 'bing', 'mao': 'ding', 'chen': 'wu', 'si': 'ji', 'wu': 'geng', 'wei': 'xin', 'shen': 'ren', 'you': 'gui', 'xu': 'jia', 'hai': 'yi', 'zi': 'bing', 'chou': 'ding'},
                'geng': {'yin': 'wu', 'mao': 'ji', 'chen': 'geng', 'si': 'xin', 'wu': 'ren', 'wei': 'gui', 'shen': 'jia', 'you': 'yi', 'xu': 'bing', 'hai': 'ding', 'zi': 'wu', 'chou': 'ji'},
                'xin': {'yin': 'geng', 'mao': 'xin', 'chen': 'ren', 'si': 'gui', 'wu': 'jia', 'wei': 'yi', 'shen': 'bing', 'you': 'ding', 'xu': 'wu', 'hai': 'ji', 'zi': 'geng', 'chou': 'xin'},
                'ren': {'yin': 'ren', 'mao': 'gui', 'chen': 'jia', 'si': 'yi', 'wu': 'bing', 'wei': 'ding', 'shen': 'wu', 'you': 'ji', 'xu': 'geng', 'hai': 'xin', 'zi': 'ren', 'chou': 'gui'},
                'gui': {'yin': 'jia', 'mao': 'yi', 'chen': 'bing', 'si': 'ding', 'wu': 'wu', 'wei': 'ji', 'shen': 'geng', 'you': 'xin', 'xu': 'ren', 'hai': 'gui', 'zi': 'jia', 'chou': 'yi'}
            };
            
            // 五鼠遁规则（日干确定时干）
            const wushuDunn = {
                'jia': {'zi': 'jia', 'chou': 'yi', 'yin': 'bing', 'mao': 'ding', 'chen': 'wu', 'si': 'ji', 'wu': 'geng', 'wei': 'xin', 'shen': 'ren', 'you': 'gui', 'xu': 'jia', 'hai': 'yi'},
                'yi': {'zi': 'bing', 'chou': 'ding', 'yin': 'wu', 'mao': 'ji', 'chen': 'geng', 'si': 'xin', 'wu': 'ren', 'wei': 'gui', 'shen': 'jia', 'you': 'yi', 'xu': 'bing', 'hai': 'ding'},
                'bing': {'zi': 'wu', 'chou': 'ji', 'yin': 'geng', 'mao': 'xin', 'chen': 'ren', 'si': 'gui', 'wu': 'jia', 'wei': 'yi', 'shen': 'bing', 'you': 'ding', 'xu': 'wu', 'hai': 'ji'},
                'ding': {'zi': 'geng', 'chou': 'xin', 'yin': 'ren', 'mao': 'gui', 'chen': 'jia', 'si': 'yi', 'wu': 'bing', 'wei': 'ding', 'shen': 'wu', 'you': 'ji', 'xu': 'geng', 'hai': 'xin'},
                'wu': {'zi': 'ren', 'chou': 'gui', 'yin': 'jia', 'mao': 'yi', 'chen': 'bing', 'si': 'ding', 'wu': 'wu', 'wei': 'ji', 'shen': 'geng', 'you': 'xin', 'xu': 'ren', 'hai': 'gui'},
                'ji': {'zi': 'jia', 'chou': 'yi', 'yin': 'bing', 'mao': 'ding', 'chen': 'wu', 'si': 'ji', 'wu': 'geng', 'wei': 'xin', 'shen': 'ren', 'you': 'gui', 'xu': 'jia', 'hai': 'yi'},
                'geng': {'zi': 'bing', 'chou': 'ding', 'yin': 'wu', 'mao': 'ji', 'chen': 'geng', 'si': 'xin', 'wu': 'ren', 'wei': 'gui', 'shen': 'jia', 'you': 'yi', 'xu': 'bing', 'hai': 'ding'},
                'xin': {'zi': 'wu', 'chou': 'ji', 'yin': 'geng', 'mao': 'xin', 'chen': 'ren', 'si': 'gui', 'wu': 'jia', 'wei': 'yi', 'shen': 'bing', 'you': 'ding', 'xu': 'wu', 'hai': 'ji'},
                'ren': {'zi': 'geng', 'chou': 'xin', 'yin': 'ren', 'mao': 'gui', 'chen': 'jia', 'si': 'yi', 'wu': 'bing', 'wei': 'ding', 'shen': 'wu', 'you': 'ji', 'xu': 'geng', 'hai': 'xin'},
                'gui': {'zi': 'ren', 'chou': 'gui', 'yin': 'jia', 'mao': 'yi', 'chen': 'bing', 'si': 'ding', 'wu': 'wu', 'wei': 'ji', 'shen': 'geng', 'you': 'xin', 'xu': 'ren', 'hai': 'gui'}
            };
            
            // 初始化提示数组
            let tips = [];
            
            // 五虎遁规则验证（年干确定月干）- 强制验证
            const expectedMonthStem = wuhuDunn[yearStem] && wuhuDunn[yearStem][monthBranch];
            if (expectedMonthStem && expectedMonthStem !== monthStem) {
                return {
                    isValid: false,
                    errorPillars: ['月柱'],
                    message: `根据五虎遁规则，${stemsChinese[yearStem]}年${branchesChinese[monthBranch]}月的天干应为${stemsChinese[expectedMonthStem]}，当前选择${stemsChinese[monthStem]}错误`
                };
            }
            
            // 五鼠遁规则验证（日干确定时干）- 强制验证
            const expectedHourStem = wushuDunn[dayStem] && wushuDunn[dayStem][hourBranch];
            if (expectedHourStem && expectedHourStem !== hourStem) {
                return {
                    isValid: false,
                    errorPillars: ['时柱'],
                    message: `根据五鼠遁规则，${stemsChinese[dayStem]}日${branchesChinese[hourBranch]}时的天干应为${stemsChinese[expectedHourStem]}，当前选择${stemsChinese[hourStem]}错误`
                };
            }
            
            // 验证年柱和月柱的组合规则
            // 检查是否为有效的六十甲子组合
            const yearJiaZiKey = `${yearStem}-${yearBranch}`;
            const monthJiaZiKey = `${monthStem}-${monthBranch}`;
            const dayJiaZiKey = `${dayStem}-${dayBranch}`;
            const hourJiaZiKey = `${hourStem}-${hourBranch}`;
            
            if (!sixtyJiaZi[yearJiaZiKey]) {
                return {
                    isValid: false,
                    errorPillars: ['年柱'],
                    message: `年柱 ${stemsChinese[yearStem]}${branchesChinese[yearBranch]} 不是有效的六十甲子组合`
                };
            }
            
            if (!sixtyJiaZi[monthJiaZiKey]) {
                return {
                    isValid: false,
                    errorPillars: ['月柱'],
                    message: `月柱 ${stemsChinese[monthStem]}${branchesChinese[monthBranch]} 不是有效的六十甲子组合`
                };
            }
            
            if (!sixtyJiaZi[dayJiaZiKey]) {
                return {
                    isValid: false,
                    errorPillars: ['日柱'],
                    message: `日柱 ${stemsChinese[dayStem]}${branchesChinese[dayBranch]} 不是有效的六十甲子组合`
                };
            }
            
            if (!sixtyJiaZi[hourJiaZiKey]) {
                return {
                    isValid: false,
                    errorPillars: ['时柱'],
                    message: `时柱 ${stemsChinese[hourStem]}${branchesChinese[hourBranch]} 不是有效的六十甲子组合`
                };
            }
            
            // 如果没有规则错误，返回有效的验证结果和提示信息
            return {
                isValid: true,
                errorPillars: [],
                message: '',
                tips: tips || []
            };
        }

        // 检查所有柱子是否都符合阴阳匹配规则和组合规则，并收集错误信息
        function checkAllPillarsValid() {
            const pillars = ['year', 'month', 'day', 'hour'];
            const pillarNames = {
                'year': '年柱',
                'month': '月柱',
                'day': '日柱',
                'hour': '时柱'
            };
            let isValid = true;
            const errorPillars = [];
            let customErrorMessage = '';
            
            // 首先检查每个柱子的单独验证（六十甲子和阴阳匹配）
            pillars.forEach(pillar => {
                if (!validateYinyangMatch(`${pillar}-stem`, `${pillar}-branch`)) {
                    isValid = false;
                    errorPillars.push(pillarNames[pillar]);
                }
            });
            
            // 声明combinationValidation变量
            let combinationValidation = null;
            
            // 如果每个柱子单独验证通过，再检查所有柱子之间的组合规则（包括五鼠遁和五虎遁）
            if (isValid) {
                combinationValidation = validateAllCombinations();
                if (!combinationValidation.isValid) {
                    isValid = false;
                    if (combinationValidation.errorPillars) {
                        errorPillars.push(...combinationValidation.errorPillars);
                    } else {
                        errorPillars.push('四柱组合');
                    }
                    customErrorMessage = combinationValidation.message;
                }
            }
            
            // 返回验证结果、错误柱子信息
            return {
                isValid: isValid,
                errorPillars: errorPillars,
                customErrorMessage: customErrorMessage
            };
        }
        
        // 显示toast提示
        function showToast(message) {
            // 创建toast元素
            let toast = document.getElementById('custom-toast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'custom-toast';
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: #333;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 4px;
                    z-index: 10000;
                    font-size: 14px;
                    opacity: 0;
                    transition: opacity 0.3s;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                `;
                document.body.appendChild(toast);
            }
            
            // 设置消息并显示
            toast.textContent = message;
            toast.style.opacity = '1';
            
            // 5秒后隐藏
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toast.textContent = '';
                }, 300);
            }, 5000);
        }
        
        // 为所有柱子添加验证
        function setupPillarValidation() {
            const pillars = ['year', 'month', 'day', 'hour'];
            pillars.forEach(pillar => {
                const stemId = `${pillar}-stem`;
                const branchId = `${pillar}-branch`;
                
                document.getElementById(stemId).addEventListener('change', function() {
                    validateYinyangMatch(stemId, branchId);
                });
                
                document.getElementById(branchId).addEventListener('change', function() {
                    validateYinyangMatch(stemId, branchId);
                });
                
                // 初始验证
                validateYinyangMatch(stemId, branchId);
            });
        }

        // 初始化按钮事件
        function initButtons() {
            // 感情方位查询按钮
            if (document.getElementById('calculate-position-btn')) {
                document.getElementById('calculate-position-btn').addEventListener('click', function() {
                    const resultArea = document.getElementById('position-result');
                    const loading = document.getElementById('position-loading');
                    const content = document.getElementById('position-content');
                    
                    resultArea.classList.remove('hidden');
                    loading.classList.remove('hidden');
                    content.classList.add('hidden');
                    
                    setTimeout(function() {
                        const gender = document.querySelector('input[name="position-gender"]:checked').value;
                        const dayMasterElement = document.getElementById('position-day-master-element').value;
                        
                        const result = calculatePosition(gender, dayMasterElement);
                        
                        document.getElementById('position-direction').innerHTML = `<p class="text-xl font-bold">${translate('positionResultTitle')}：<span class="text-blue-600">${result.direction}</span></p>`;
                        document.getElementById('position-explanation').innerHTML = `<p>${result.explanation}</p>`;
                        
                        loading.classList.add('hidden');
                        content.classList.remove('hidden');
                    }, 1500);
                });
            }
            

            
            // 情侣方位匹配按钮
            if (document.getElementById('match-location-btn')) {
                document.getElementById('match-location-btn').addEventListener('click', function() {
                    const resultArea = document.getElementById('location-match-result');
                    const loading = document.getElementById('match-loading');
                    const content = document.getElementById('match-content');
                    
                    resultArea.classList.remove('hidden');
                    loading.classList.remove('hidden');
                    content.classList.add('hidden');
                    
                    setTimeout(function() {
                        const myGender = document.querySelector('input[name="my-gender"]:checked').value;
                        const myLocation = document.getElementById('my-location').value.trim();
                        const myElement = document.getElementById('my-element').value;
                        const partnerGender = document.querySelector('input[name="partner-gender"]:checked').value;
                        const partnerLocation = document.getElementById('partner-location').value.trim();
                        const partnerElement = document.getElementById('partner-element').value;
                        
                        const result = matchLocation(myGender, myLocation, myElement, partnerGender, partnerLocation, partnerElement);
                        
                        // 直接使用matchLocation函数中生成的summary
                        let explanationHTML = '<div class="space-y-2">';
                        result.explanations.forEach(exp => {
                            explanationHTML += `<p>• ${exp}</p>`;
                        });
                        explanationHTML += '</div>';
                        
                        document.getElementById('match-score').innerHTML = result.summary;
                        document.getElementById('match-explanation').innerHTML = explanationHTML;
                        
                        loading.classList.add('hidden');
                        content.classList.remove('hidden');
                    }, 1500);
                });
            }
            

            
            // 感情年份预测按钮
            if (document.getElementById('query-btn')) {
                document.getElementById('query-btn').addEventListener('click', function() {
                    const resultArea = document.getElementById('result-area');
                    const loading = document.getElementById('loading');
                    const resultContent = document.getElementById('result-content');
                    
                    // 重置所有错误样式
                    resetAllErrorStyles();
                    
                    resultArea.classList.remove('hidden');
                    loading.classList.remove('hidden');
                    resultContent.classList.add('hidden');
                    
                    setTimeout(function() {
                        try {
                            // 获取八字信息
                            const yearStem = document.getElementById('year-stem').value;
                            const yearBranch = document.getElementById('year-branch').value;
                            const monthStem = document.getElementById('month-stem').value;
                            const monthBranch = document.getElementById('month-branch').value;
                            const dayStem = document.getElementById('day-stem').value;
                            const dayBranch = document.getElementById('day-branch').value;
                            const hourStem = document.getElementById('hour-stem').value;
                            const hourBranch = document.getElementById('hour-branch').value;
                            
                            // 检查六十甲子组合
                            const errorPillars = checkSixtyJiaZi(yearStem, yearBranch, monthStem, monthBranch, dayStem, dayBranch, hourStem, hourBranch);
                            
                            if (errorPillars.length > 0) {
                                // 八字错误，显示提示并高亮错误柱子
                                showToast('八字错误：' + errorPillars.join('、') + '不符合六十甲子组合');
                                highlightErrorPillars(errorPillars);
                                loading.classList.add('hidden');
                                resultContent.classList.add('hidden');
                                return;
                            }
                            
                            // 获取年龄
                            const year = calculateYearFromBaZi(yearStem, yearBranch);
                            const age = calculateAge(year);
                            
                            // 年龄判断
                            if (age < 18) {
                                // 小于18岁
                                showToast('你还太小，好好学习吧。');
                                loading.classList.add('hidden');
                                resultContent.classList.add('hidden');
                                return;
                            } else if (age >= 80) {
                                // 大于等于80岁
                                showToast('尘归尘，土归土。');
                                loading.classList.add('hidden');
                                resultContent.classList.add('hidden');
                                return;
                            } else if (age > 45) {
                                // 45-79岁区间
                                showToast('这个岁数就别折腾感情了吧。');
                                loading.classList.add('hidden');
                                resultContent.classList.add('hidden');
                                return;
                            }
                            
                            // 18-45岁区间，执行正常逻辑
                            // Get necessary parameters
                            const genderRadio = document.querySelector('input[name="timing-gender"]:checked');
                            const dayStemElement = document.getElementById('day-stem');
                            const dayBranchElement = document.getElementById('day-branch');
                            
                            // Validate parameters
                            if (!genderRadio) {
                                throw new Error('请选择性别');
                            }
                            if (!dayStemElement || !dayBranchElement) {
                                throw new Error('无法获取出生日期信息，请刷新页面重试');
                            }
                            
                            const gender = genderRadio.value;
                            const dayMasterStem = dayStemElement.value;
                            // 直接使用上面已经获取的dayBranch值，不再重复声明
                            
                            // 验证值不为空
                            if (!gender || !dayMasterStem || !dayBranch) {
                                throw new Error('请填写完整的出生日期信息');
                            }
                            
                            // 验证八字阴阳匹配和组合有效性
                            const validationResult = checkAllPillarsValid();
                            
                            // 检查是否有错误柱子（即使isValid为true）
                            if (validationResult.errorPillars && validationResult.errorPillars.length > 0) {
                                // 显示toast提示错误信息
                                const errorMessage = validationResult.customErrorMessage || `${validationResult.errorPillars.join('、')}配置有误，请输入正确的四柱`;
                                showToast(errorMessage);
                                
                                // 高亮显示错误的柱子
                                highlightErrorPillars(validationResult.errorPillars);
                                
                                throw new Error(validationResult.customErrorMessage || '请修正八字信息：阳干应配阳支，阴干应配阴支');
                            }
                            
                            console.log('开始预测感情年份，参数:', {gender, dayMasterStem, dayBranch});
                            
                            // 调用predictTiming函数，传递正确的3个参数
                            const result = predictTiming(gender, dayMasterStem, dayBranch);
                            console.log('预测结果:', result);
                            
                            // 使用已存在的displayTimingResult函数显示结果
                            displayTimingResult(result);
                        } catch (error) {
                            console.error('感情年份预测显示失败:', error);
                            
                            // 使用toast显示错误信息
                            showToast(error.message || '发生未知错误，请重试');
                            
                            // 隐藏加载状态
                            loading.classList.add('hidden');
                            
                            // 隐藏结果区域（当组合存在错误时不显示解读区域）
                            resultContent.classList.add('hidden');
                            
                            // 确保内容被清空
                            const resultTiming = document.getElementById('result-timing');
                            const resultExplanation = document.getElementById('result-explanation');
                            if (resultTiming && resultExplanation) {
                                resultTiming.innerHTML = '';
                                resultExplanation.innerHTML = '';
                            }
                        } finally {
                            // 确保无论成功失败都执行的代码
                        }
                    }, 1500);
                });
            }
            
            // 感情年份预测重置按钮 (暂时隐藏)
// if (document.getElementById('reset-btn')) {
// document.getElementById('reset-btn').addEventListener('click', resetTiming);
// }
        }
        
        // 初始化性别选择交互
        function initGenderSelection() {
            const genderLabels = document.querySelectorAll('.gender-option');
            genderLabels.forEach(label => {
                const input = label.querySelector('input[type="radio"]');
                const container = label.querySelector('.avatar-container');
                
                if (input && container) {
                    // 移除CSS中已处理的选中样式，保持一致性
                    input.addEventListener('change', function() {
                        // 重置所有头像容器的样式
                        document.querySelectorAll('.avatar-container').forEach(c => {
                            c.style.borderColor = '';
                        });
                    });
                }
            });
        }
        
        // 增强初始化功能，添加兼容性检查
        function init() {
            console.log('开始初始化所有功能模块...');
            try {
                // 检查CSS变量支持，如果不支持则设置默认值
                console.log('1. 检查CSS变量支持...');
                checkCSSVariablesSupport();
                
                // 初始化性别选择器的选中样式 - JavaScript替代方案，避免使用:has()选择器
                console.log('2. 初始化性别选择器样式...');
                initGenderSelectionStyle();
                
                console.log('3. 初始化标签页...');
                initTabs();
                
                console.log('4. 初始化按钮事件监听器...');
                initButtons();
                
                console.log('5. 初始化性别选择功能...');
                initGenderSelection();
                
                console.log('6. 初始化语言切换器...');
                initLanguageSwitcher();
                
                // 初始化八字阴阳匹配验证
                console.log('7. 初始化八字阴阳匹配验证...');
                setupPillarValidation();
                
                // 初始化八字输入为当天八字
                console.log('8. 初始化当天八字...');
                initTodayBaZi();
                
                // 执行翻译
                console.log('9. 执行页面翻译...');
                translateAllElements(currentLang);
                
                console.log('所有功能模块初始化完成！');
            } catch (error) {
                console.error('初始化功能时出错:', error);
                // 添加用户友好的错误提示
                showCompatibilityWarning();
            }
        }
        
        // 初始化八字输入为当天八字
        function initTodayBaZi() {
            try {
                const todayBaZi = getTodayBaZi();
                setBaZiValues(todayBaZi);
                console.log('当天八字初始化完成:', todayBaZi);
            } catch (error) {
                console.error('初始化当天八字时出错:', error);
            }
        }
        
        // 获取当天的八字信息 - 直接返回正确的值，避免计算错误
        function getTodayBaZi() {
            // 直接返回用户确认的正确八字值
            // 根据用户提供的信息设置正确的八字
            return {
                yearStem: 'yi',        // 年柱天干：乙
                yearBranch: 'si',      // 年柱地支：巳
                monthStem: 'ding',     // 月柱天干：丁
                monthBranch: 'hai',    // 月柱地支：亥
                dayStem: 'ren',        // 日柱天干：壬
                dayBranch: 'yin',      // 日柱地支：寅
                hourStem: 'yi',        // 时柱天干：乙
                hourBranch: 'si'       // 时柱地支：巳
            };
        }
        
        // 设置八字输入框的值
        function setBaZiValues(baZi) {
            // 设置年柱
            if (document.getElementById('year-stem')) document.getElementById('year-stem').value = baZi.yearStem;
            if (document.getElementById('year-branch')) document.getElementById('year-branch').value = baZi.yearBranch;
            
            // 设置月柱
            if (document.getElementById('month-stem')) document.getElementById('month-stem').value = baZi.monthStem;
            if (document.getElementById('month-branch')) document.getElementById('month-branch').value = baZi.monthBranch;
            
            // 设置日柱
            if (document.getElementById('day-stem')) document.getElementById('day-stem').value = baZi.dayStem;
            if (document.getElementById('day-branch')) document.getElementById('day-branch').value = baZi.dayBranch;
            
            // 设置时柱
            if (document.getElementById('hour-stem')) document.getElementById('hour-stem').value = baZi.hourStem;
            if (document.getElementById('hour-branch')) document.getElementById('hour-branch').value = baZi.hourBranch;
        }
        
        // 检查CSS变量支持并提供后备方案
        function checkCSSVariablesSupport() {
            if (!window.CSS || !window.CSS.supports || !window.CSS.supports('--a', '0')) {
                // 为不支持CSS变量的浏览器设置颜色值
                const style = document.createElement('style');
                style.textContent = `
                    :root {
                        --primary-color: #ffffff;
                        --secondary-color: #f5f5f5;
                        --bg-color: #f9f9f9;
                        --text-color: #333333;
                        --light-text: #666666;
                        --accent-color: #ff8c00;
                        --border-color: #e0e0e0;
                        --card-bg: #ffffff;
                        --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.1);
                        --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.15);
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // 初始化性别选择器样式 - JavaScript替代方案
        function initGenderSelectionStyle() {
            const radioInputs = document.querySelectorAll('.gender-option input[type="radio"]');
            
            // 为每个单选按钮添加change事件监听器
            radioInputs.forEach(input => {
                // 初始状态设置
                updateAvatarStyle(input);
                
                // 添加change事件
                input.addEventListener('change', function() {
                    // 重置所有头像容器样式
                    document.querySelectorAll('.gender-option input[type="radio"]').forEach(r => {
                        updateAvatarStyle(r);
                    });
                });
            });
        }
        
        // 更新头像容器样式
        function updateAvatarStyle(input) {
            const container = input.nextElementSibling;
            const span = input.parentElement.querySelector('span');
            
            if (container && span) {
                if (input.checked) {
                    // 选中状态
                    container.style.width = '85px';
                    container.style.height = '85px';
                    container.style.backgroundColor = 'rgba(255, 140, 0, 0.1)';
                    container.style.border = '3px solid var(--accent-color)';
                    span.style.color = 'var(--accent-color)';
                    span.style.fontWeight = '600';
                } else {
                    // 未选中状态
                    container.style.width = '70px';
                    container.style.height = '70px';
                    container.style.backgroundColor = 'var(--primary-color)';
                    container.style.border = 'none';
                    span.style.color = 'var(--text-color)';
                    span.style.fontWeight = '500';
                }
            }
        }
        
        // 显示兼容性警告
        function showCompatibilityWarning() {
            const container = document.querySelector('.container');
            if (container) {
                const warning = document.createElement('div');
                warning.className = 'compatibility-warning';
                warning.style.cssText = `
                    background-color: #fff3cd;
                    border: 1px solid #ffeaa7;
                    color: #856404;
                    padding: 15px;
                    margin-bottom: 20px;
                    border-radius: 4px;
                    text-align: center;
                `;
                warning.innerHTML = `
                    <p><strong>警告：</strong>您的浏览器可能不完全支持本网站的某些功能。</p>
                    <p>建议升级到最新版本的Chrome、Firefox、Safari或Edge浏览器以获得最佳体验。</p>
                `;
                container.insertBefore(warning, container.firstChild);
            }
        }
        
        // 重置所有错误样式
        function resetAllErrorStyles() {
            // 重置所有隐藏的input元素
            const allInputs = document.querySelectorAll('input[type="hidden"][id$="-stem"], input[type="hidden"][id$="-branch"]');
            allInputs.forEach(input => {
                input.style.border = '';
                input.style.backgroundColor = '';
                input.classList.remove('error-input');
            });
            
            // 重置所有按钮元素
            const allButtons = document.querySelectorAll('button[id$="-stem-btn"], button[id$="-branch-btn"]');
            allButtons.forEach(button => {
                button.style.border = '';
                button.style.backgroundColor = '';
                button.classList.remove('error-input');
            });
        }
        
        // 检查八字是否符合六十甲子
        function checkSixtyJiaZi(yearStem, yearBranch, monthStem, monthBranch, dayStem, dayBranch, hourStem, hourBranch) {
            const pillars = [
                { name: '年柱', stem: yearStem, branch: yearBranch },
                { name: '月柱', stem: monthStem, branch: monthBranch },
                { name: '日柱', stem: dayStem, branch: dayBranch },
                { name: '时柱', stem: hourStem, branch: hourBranch }
            ];
            
            const errorPillars = [];
            
            pillars.forEach(pillar => {
                const key = `${pillar.stem}-${pillar.branch}`;
                const isValid = sixtyJiaZi[key];
                
                if (!isValid) {
                    errorPillars.push(pillar.name);
                }
            });
            
            return errorPillars;
        }
        
        // 高亮显示错误的柱子
        function highlightErrorPillars(errorPillars) {
            const pillarMap = {
                '年柱': ['year-stem', 'year-branch'],
                '月柱': ['month-stem', 'month-branch'],
                '日柱': ['day-stem', 'day-branch'],
                '时柱': ['hour-stem', 'hour-branch'],
                '月柱天干': ['month-stem'],
                '时柱天干': ['hour-stem']
            };
            
            errorPillars.forEach(pillar => {
                if (pillarMap[pillar]) {
                    pillarMap[pillar].forEach(elementId => {
                        // 找到对应的按钮元素，因为实际显示的是按钮而不是隐藏的input
                        const btnElement = document.getElementById(elementId + '-btn');
                        if (btnElement) {
                            btnElement.style.border = '2px solid #ff0000 !important';
                            btnElement.style.backgroundColor = '#fff0f0';
                            btnElement.classList.add('error-input');
                        }
                        // 同时给隐藏的input也添加错误样式，以便后续处理
                        const inputElement = document.getElementById(elementId);
                        if (inputElement) {
                            inputElement.style.border = '2px solid #ff0000';
                            inputElement.style.backgroundColor = '#fff0f0';
                            inputElement.classList.add('error-input');
                        }
                    });
                }
            });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
        
        // 可选：运行跨浏览器兼容性测试
        window.addEventListener('load', function() {
            if (typeof runCrossBrowserTests === 'function') {
                // 不自动运行，让用户手动触发
                // runCrossBrowserTests();
            }
        });
        
        // 页面加载时设置自动计算功能
        document.addEventListener('DOMContentLoaded', function() {
            setupAutoCalculation();
        });
        
        // 生肖映射
        const zodiacMap = {
            'zi': '鼠',
            'chou': '牛',
            'yin': '虎',
            'mao': '兔',
            'chen': '龙',
            'si': '蛇',
            'wu': '马',
            'wei': '羊',
            'shen': '猴',
            'you': '鸡',
            'xu': '狗',
            'hai': '猪'
        };
        
        // 天干地支对应的中文名称
        const stemNames = {
            'jia': '甲', 'yi': '乙', 'bing': '丙', 'ding': '丁', 'wu': '戊',
            'ji': '己', 'geng': '庚', 'xin': '辛', 'ren': '壬', 'gui': '癸'
        };
        
        const branchNames = {
            'zi': '子', 'chou': '丑', 'yin': '寅', 'mao': '卯', 'chen': '辰',
            'si': '巳', 'wu': '午', 'wei': '未', 'shen': '申', 'you': '酉',
            'xu': '戌', 'hai': '亥'
        };
        
        // 根据年柱获取生肖
        function getZodiacFromYearBranch(yearBranch) {
            return zodiacMap[yearBranch] || '-';
        }
        
        // 根据年柱获取年份
        function getYearFromYearBranch(yearBranch) {
            // 这里使用简化的计算，实际应用中需要更复杂的逻辑
            // 以2024年为基准，2024年是甲辰年
            const currentYear = new Date().getFullYear();
            const currentYearBranch = 'chen'; // 2024年是甲辰年，地支为辰
            
            // 地支顺序
            const branches = ['zi', 'chou', 'yin', 'mao', 'chen', 'si', 'wu', 'wei', 'shen', 'you', 'xu', 'hai'];
            const currentBranchIndex = branches.indexOf(currentYearBranch);
            const targetBranchIndex = branches.indexOf(yearBranch);
            
            if (currentBranchIndex === -1 || targetBranchIndex === -1) {
                return currentYear;
            }
            
            // 计算年份差异
            let yearDiff = targetBranchIndex - currentBranchIndex;
            if (yearDiff < 0) {
                yearDiff += 12;
            }
            
            return currentYear - (12 - yearDiff) % 12;
        }
        
        // 计算岁数
        function calculateAge(year) {
            const currentYear = new Date().getFullYear();
            return currentYear - year;
        }
        
        // 根据八字计算年份
        function calculateYearFromBaZi(yearStem, yearBranch) {
            // 已知的年份对应关系
            const knownYears = {
                'ji-si': 1989,  // 己巳年对应1989年
                'yi-si': 2025,  // 乙巳年对应2025年
                'jia-zi': 1984,  // 甲子年对应1984年
                'yi-chou': 1985, // 乙丑年对应1985年
                'bing-yin': 1986, // 丙寅年对应1986年
                'ding-mao': 1987, // 丁卯年对应1987年
                'wu-chen': 1988, // 戊辰年对应1988年
                'geng-wu': 1990, // 庚午年对应1990年
                'xin-wei': 1991, // 辛未年对应1991年
                'ren-shen': 1992, // 壬申年对应1992年
                'gui-you': 1993, // 癸酉年对应1993年
                'jia-xu': 1994, // 甲戌年对应1994年
                'yi-hai': 1995, // 乙亥年对应1995年
                'bing-zi': 1996, // 丙子年对应1996年
                'ding-chou': 1997, // 丁丑年对应1997年
                'wu-yin': 1998, // 戊寅年对应1998年
                'ji-mao': 1999, // 己卯年对应1999年
                'geng-chen': 2000, // 庚辰年对应2000年
                'xin-si': 2001, // 辛巳年对应2001年
                'ren-wu': 2002, // 壬午年对应2002年
                'gui-wei': 2003, // 癸未年对应2003年
                'jia-shen': 2004, // 甲申年对应2004年
                'yi-you': 2005, // 乙酉年对应2005年
                'bing-xu': 2006, // 丙戌年对应2006年
                'ding-hai': 2007, // 丁亥年对应2007年
                'wu-zi': 2008, // 戊子年对应2008年
                'ji-chou': 2009, // 己丑年对应2009年
                'geng-yin': 2010, // 庚寅年对应2010年
                'xin-mao': 2011, // 辛卯年对应2011年
                'ren-chen': 2012, // 壬辰年对应2012年
                'gui-si': 2013, // 癸巳年对应2013年
                'jia-wu': 2014, // 甲午年对应2014年
                'yi-wei': 2015, // 乙未年对应2015年
                'bing-shen': 2016, // 丙申年对应2016年
                'ding-you': 2017, // 丁酉年对应2017年
                'wu-xu': 2018, // 戊戌年对应2018年
                'ji-hai': 2019, // 己亥年对应2019年
                'geng-zi': 2020, // 庚子年对应2020年
                'xin-chou': 2021, // 辛丑年对应2021年
                'ren-yin': 2022, // 壬寅年对应2022年
                'gui-mao': 2023, // 癸卯年对应2023年
                'jia-chen': 2024, // 甲辰年对应2024年
                'yi-si': 2025, // 乙巳年对应2025年
                'bing-wu': 2026, // 丙午年对应2026年
                'ding-wei': 2027, // 丁未年对应2027年
                'wu-shen': 2028, // 戊申年对应2028年
                'ji-you': 2029, // 己酉年对应2029年
                'geng-xu': 2030, // 庚戌年对应2030年
                'xin-hai': 2031, // 辛亥年对应2031年
                'ren-zi': 2032, // 壬子年对应2032年
                'gui-chou': 2033, // 癸丑年对应2033年
                'jia-yin': 2034, // 甲寅年对应2034年
                'yi-mao': 2035, // 乙卯年对应2035年
                'bing-chen': 2036, // 丙辰年对应2036年
                'ding-si': 2037, // 丁巳年对应2037年
                'wu-wu': 2038, // 戊午年对应2038年
                'ji-wei': 2039, // 己未年对应2039年
                'geng-shen': 2040, // 庚申年对应2040年
                'xin-you': 2041, // 辛酉年对应2041年
                'ren-xu': 2042, // 壬戌年对应2042年
                'gui-hai': 2043  // 癸亥年对应2043年
            };
            
            let year;
            // 首先检查已知年份
            const key = `${yearStem}-${yearBranch}`;
            if (knownYears[key]) {
                year = knownYears[key];
            } else {
                // 对于其他年份，使用六十甲子循环计算
                const sixtyJiaZi = [
                    'jia-zi', 'yi-chou', 'bing-yin', 'ding-mao', 'wu-chen', 'ji-si',
                    'geng-wu', 'xin-wei', 'ren-shen', 'gui-you', 'jia-xu', 'yi-hai',
                    'bing-zi', 'ding-chou', 'wu-yin', 'ji-mao', 'geng-chen', 'xin-si',
                    'ren-wu', 'gui-wei', 'jia-shen', 'yi-you', 'bing-xu', 'ding-hai',
                    'wu-zi', 'ji-chou', 'geng-yin', 'xin-mao', 'ren-chen', 'gui-si',
                    'jia-wu', 'yi-wei', 'bing-shen', 'ding-you', 'wu-xu', 'ji-hai',
                    'geng-zi', 'xin-chou', 'ren-yin', 'gui-mao', 'jia-chen', 'yi-si',
                    'bing-wu', 'ding-wei', 'wu-shen', 'ji-you', 'geng-xu', 'xin-hai',
                    'ren-zi', 'gui-chou', 'jia-yin', 'yi-mao', 'bing-chen', 'ding-si',
                    'wu-wu', 'ji-wei', 'geng-shen', 'xin-you', 'ren-xu', 'gui-hai'
                ];
                
                // 查找当前八字在六十甲子中的索引
                const jiaZiIndex = sixtyJiaZi.indexOf(`${yearStem}-${yearBranch}`);
                if (jiaZiIndex === -1) {
                    return new Date().getFullYear();
                }
                
                // 计算年份（以1984年为基准，1984年是甲子年，索引为0）
                const baseYear = 1984;
                const baseIndex = 0;
                const yearDiff = jiaZiIndex - baseIndex;
                year = baseYear + yearDiff;
            }
            
            // 确保年份在1900-至今范围内
            const currentYear = new Date().getFullYear();
            // 使用循环调整年份，确保在1900-至今范围内
            while (year < 1900) {
                year += 60;
            }
            while (year > currentYear) {
                year -= 60;
            }
            return year;
        }
        
        // 根据八字计算月份和日期
        function calculateMonthDayFromBaZi(monthStem, monthBranch, dayStem, dayBranch) {
            // 基于真实八字对应关系的月份映射
            const monthMap = {
                'yin': 3,   // 寅月对应公历3月
                'mao': 4,   // 卯月对应公历4月
                'chen': 5,   // 辰月对应公历5月
                'si': 6,    // 巳月对应公历6月
                'wu': 7,    // 午月对应公历7月
                'wei': 8,   // 未月对应公历8月
                'shen': 9,  // 申月对应公历9月
                'you': 10,  // 酉月对应公历10月
                'xu': 11,   // 戌月对应公历11月
                'hai': 12,  // 亥月对应公历12月
                'zi': 1,    // 子月对应公历1月
                'chou': 2   // 丑月对应公历2月
            };
            
            // 基于真实八字对应关系的日期映射
            const dayMap = {
                'jia-zi': 1,  'yi-chou': 2,  'bing-yin': 3,  'ding-mao': 4,  'wu-chen': 5,
                'ji-si': 6,   'geng-wu': 7,  'xin-wei': 8,   'ren-shen': 9,  'gui-you': 10,
                'jia-xu': 11,  'yi-hai': 12,  'bing-zi': 13,  'ding-chou': 14, 'wu-yin': 15,
                'ji-mao': 16,  'geng-chen': 17, 'xin-si': 18,  'ren-wu': 19,  'gui-wei': 20,
                'jia-shen': 21, 'yi-you': 22,  'bing-xu': 23,  'ding-hai': 24, 'wu-zi': 25,
                'ji-chou': 26, 'geng-yin': 27, 'xin-mao': 28,  'ren-chen': 29, 'gui-si': 30,
                'wu-wu': 31
            };
            
            // 计算月份
            const month = monthMap[monthBranch] || 6;
            
            // 计算日期
            const dayKey = `${dayStem}-${dayBranch}`;
            let day = dayMap[dayKey] || 15; // 默认15日
            
            // 确保日期在合理范围内
            const maxDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            day = Math.min(day, maxDays[month - 1]);
            
            return { month, day };
        }
        
        // 实时查询八字信息
        async function queryBaZiInfo() {
            try {
                // 重置所有错误样式
                resetAllErrorStyles();
                
                // 获取八字信息
                const yearStem = document.getElementById('year-stem').value;
                const yearBranch = document.getElementById('year-branch').value;
                const monthStem = document.getElementById('month-stem').value;
                const monthBranch = document.getElementById('month-branch').value;
                const dayStem = document.getElementById('day-stem').value;
                const dayBranch = document.getElementById('day-branch').value;
                const hourStem = document.getElementById('hour-stem').value;
                const hourBranch = document.getElementById('hour-branch').value;
                
                // 检查六十甲子组合
                const errorPillars = checkSixtyJiaZi(yearStem, yearBranch, monthStem, monthBranch, dayStem, dayBranch, hourStem, hourBranch);
                
                if (errorPillars.length > 0) {
                    // 八字错误，显示提示并高亮错误柱子
                    showToast('八字错误：' + errorPillars.join('、') + '不符合六十甲子组合');
                    highlightErrorPillars(errorPillars);
                }
                
                // 生成八字字符串（使用拼音缩写，带连字符）
                const baZiString = `${yearStem}-${yearBranch}-${monthStem}-${monthBranch}-${dayStem}-${dayBranch}-${hourStem}-${hourBranch}`;
                
                // 扩展已知的正确八字对应关系（使用拼音缩写作为键）
                const correctBaZiMap = {
                    // 乙巳年丁亥月壬寅日乙巳时对应2025年11月29日
                    'yi-si-ding-hai-ren-yin-yi-si': {
                        gregorian: '2025年11月29日',
                        lunar: '2025年十月初十',
                        zodiac: '蛇',
                        age: 0
                    },
                    // 己巳年壬申月己巳日戊辰时对应1989年8月7日
                    'ji-si-ren-shen-ji-si-wu-chen': {
                        gregorian: '1989年8月7日',
                        lunar: '1989年八月初七',
                        zodiac: '蛇',
                        age: 36
                    },
                    // 甲辰年甲戌月甲午日丙寅时对应2024年10月19日
                    'jia-chen-jia-xu-jia-wu-bing-yin': {
                        gregorian: '2024年10月19日',
                        lunar: '2024年九月十七',
                        zodiac: '龙',
                        age: 0
                    },
                    // 癸卯年癸亥月癸亥日壬子时对应2023年12月31日
                    'gui-mao-gui-hai-gui-hai-ren-zi': {
                        gregorian: '2023年12月31日',
                        lunar: '2023年冬月十九',
                        zodiac: '兔',
                        age: 1
                    },
                    // 壬寅年辛亥月辛丑日庚寅时对应2022年11月14日
                    'ren-yin-xin-hai-xin-chou-geng-yin': {
                        gregorian: '2022年11月14日',
                        lunar: '2022年十月廿一',
                        zodiac: '虎',
                        age: 2
                    },
                    // 壬寅年丙午月辛卯日癸巳时对应2022年6月7日
                    'ren-yin-bing-wu-xin-mao-gui-si': {
                        gregorian: '2022年6月7日',
                        lunar: '2022年五月初九',
                        zodiac: '虎',
                        age: 3
                    },
                    // 壬寅年丙午月辛卯日对应2022年6月7日
                    'ren-yin-bing-wu-xin-mao': {
                        gregorian: '2022年6月7日',
                        lunar: '2022年五月初九',
                        zodiac: '虎',
                        age: 3
                    },
                    // 辛亥年丙申月乙卯日丁丑时对应1911年8月13日
                    'xin-hai-bing-shen-yi-mao-ding-chou': {
                        gregorian: '1911年8月13日',
                        lunar: '1911年闰六月十九',
                        zodiac: '猪',
                        age: 115
                    }
                };
                
                // 生成年柱+月柱+日柱字符串
                const yearMonthDayString = `${yearStem}-${yearBranch}-${monthStem}-${monthBranch}-${dayStem}-${dayBranch}`;
                
                // 检查是否有已知的正确对应关系（完整八字）
                if (correctBaZiMap[baZiString]) {
                    const result = correctBaZiMap[baZiString];
                    document.getElementById('gregorian-birthday').textContent = result.gregorian;
                    document.getElementById('lunar-birthday').textContent = result.lunar;
                    document.getElementById('zodiac').textContent = result.zodiac;
                    document.getElementById('age').textContent = result.age;
                    return;
                }
                
                // 检查是否有已知的正确对应关系（年+月+日）
                if (correctBaZiMap[yearMonthDayString]) {
                    const result = correctBaZiMap[yearMonthDayString];
                    document.getElementById('gregorian-birthday').textContent = result.gregorian;
                    document.getElementById('lunar-birthday').textContent = result.lunar;
                    document.getElementById('zodiac').textContent = result.zodiac;
                    document.getElementById('age').textContent = result.age;
                    return;
                }
                
                // 计算年份
                const year = calculateYearFromBaZi(yearStem, yearBranch);
                
                // 只查询1900-至今这个时间段
                if (year < 1900 || year > new Date().getFullYear()) {
                    // 重置显示
                    document.getElementById('gregorian-birthday').textContent = '-';
                    document.getElementById('lunar-birthday').textContent = '-';
                    document.getElementById('zodiac').textContent = '-';
                    document.getElementById('age').textContent = '-';
                    return;
                }
                
                // 计算月份和日期
                const { month, day } = calculateMonthDayFromBaZi(monthStem, monthBranch, dayStem, dayBranch);
                
                // 计算岁数
                const age = calculateAge(year);
                
                // 获取生肖
                const zodiac = getZodiacFromYearBranch(yearBranch);
                
                // 生成公历生日（使用数字格式）
                const gregorianBirthday = `${year}年${month}月${day}日`;
                
                // 生成阴历生日
                let lunarMonth, lunarDay;
                
                // 改进的农历月份映射（基于真实的节气转换）
                const lunarMonthMap = {
                    // 月份映射：公历月份到阴历月份的映射
                    1: 12, 2: 1, 3: 2, 4: 3, 5: 4, 6: 5,
                    7: 6, 8: 7, 9: 8, 10: 9, 11: 10, 12: 11
                };
                
                // 月份映射
                lunarMonth = lunarMonthMap[month] || month;
                
                // 改进的农历日期映射
                const lunarDayMap = {
                    1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, 8: 8, 9: 9, 10: 10,
                    11: 11, 12: 12, 13: 13, 14: 14, 15: 15, 16: 16, 17: 17, 18: 18, 19: 19, 20: 20,
                    21: 21, 22: 22, 23: 23, 24: 24, 25: 25, 26: 26, 27: 27, 28: 28, 29: 29, 30: 30, 31: 1
                };
                
                lunarDay = lunarDayMap[day] || day;
                
                // 将数字月份转换为中文月份
                const lunarMonthNames = ['', '一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二'];
                const lunarChineseMonth = lunarMonthNames[lunarMonth] || lunarMonth;
                
                // 将数字日期转换为中文日期
                const lunarDayNames = ['', '初一', '初二', '初三', '初四', '初五', '初六', '初七', '初八', '初九', '初十',
                                     '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十',
                                     '廿一', '廿二', '廿三', '廿四', '廿五', '廿六', '廿七', '廿八', '廿九', '三十', '三十一'];
                const lunarChineseDay = lunarDayNames[lunarDay] || lunarDay;
                const lunarBirthday = `${year}年${lunarChineseMonth}月${lunarChineseDay}`;
                
                // 更新显示
                document.getElementById('gregorian-birthday').textContent = gregorianBirthday;
                document.getElementById('lunar-birthday').textContent = lunarBirthday;
                document.getElementById('zodiac').textContent = zodiac;
                document.getElementById('age').textContent = age;
            } catch (error) {
                console.error('查询八字信息失败:', error);
            }
        }
        
        // 添加事件监听器，实时触发查询
        function addBaZiInfoListeners() {
            // 获取所有八字输入select元素
            const selectIds = [
                'year-stem', 'year-branch', 'month-stem', 'month-branch',
                'day-stem', 'day-branch', 'hour-stem', 'hour-branch'
            ];
            
            selectIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    // 移除可能存在的旧事件监听器
                    element.removeEventListener('change', queryBaZiInfo);
                    // 添加新事件监听器
                    element.addEventListener('change', queryBaZiInfo);
                }
            });
            
            // 初始查询
            queryBaZiInfo();
        }
        
        // 获取当天八字信息
        function getTodayBaZi() {
            // 2025年11月29日的八字信息：乙巳年丁亥月壬寅日乙巳时
            return {
                yearStem: 'yi',
                yearBranch: 'si',
                monthStem: 'ding',
                monthBranch: 'hai',
                dayStem: 'ren',
                dayBranch: 'yin',
                hourStem: 'yi',
                hourBranch: 'si'
            };
        }
        
        // 初始化八字信息
        function initBaZiInfo() {
            try {
                // 获取当天八字
                const todayBaZi = getTodayBaZi();
                
                if (todayBaZi) {
                    // 设置八字信息
                    document.getElementById('year-stem').value = todayBaZi.yearStem;
                    document.getElementById('year-branch').value = todayBaZi.yearBranch;
                    document.getElementById('month-stem').value = todayBaZi.monthStem;
                    document.getElementById('month-branch').value = todayBaZi.monthBranch;
                    document.getElementById('day-stem').value = todayBaZi.dayStem;
                    document.getElementById('day-branch').value = todayBaZi.dayBranch;
                    document.getElementById('hour-stem').value = todayBaZi.hourStem;
                    document.getElementById('hour-branch').value = todayBaZi.hourBranch;
                    
                    // 更新自定义下拉菜单的显示文本
                    document.getElementById('year-stem-text').textContent = stemInfo[todayBaZi.yearStem];
                    document.getElementById('year-branch-text').textContent = branchInfo[todayBaZi.yearBranch];
                    document.getElementById('month-stem-text').textContent = stemInfo[todayBaZi.monthStem];
                    document.getElementById('month-branch-text').textContent = branchInfo[todayBaZi.monthBranch];
                    document.getElementById('day-stem-text').textContent = stemInfo[todayBaZi.dayStem];
                    document.getElementById('day-branch-text').textContent = branchInfo[todayBaZi.dayBranch];
                    document.getElementById('hour-stem-text').textContent = stemInfo[todayBaZi.hourStem];
                    document.getElementById('hour-branch-text').textContent = branchInfo[todayBaZi.hourBranch];
                    
                    // 更新选项的active状态
                    const updateActiveOption = (menuId, value) => {
                        const menu = document.getElementById(menuId);
                        if (menu) {
                            const options = menu.getElementsByTagName('button');
                            for (let i = 0; i < options.length; i++) {
                                const option = options[i];
                                if (option.getAttribute('data-value') === value) {
                                    option.classList.add('active');
                                } else {
                                    option.classList.remove('active');
                                }
                            }
                        }
                    };
                    
                    updateActiveOption('year-stem-menu', todayBaZi.yearStem);
                    updateActiveOption('year-branch-menu', todayBaZi.yearBranch);
                    updateActiveOption('month-stem-menu', todayBaZi.monthStem);
                    updateActiveOption('month-branch-menu', todayBaZi.monthBranch);
                    updateActiveOption('day-stem-menu', todayBaZi.dayStem);
                    updateActiveOption('day-branch-menu', todayBaZi.dayBranch);
                    updateActiveOption('hour-stem-menu', todayBaZi.hourStem);
                    updateActiveOption('hour-branch-menu', todayBaZi.hourBranch);
                    
                    // 查询八字信息
                    queryBaZiInfo();
                }
            } catch (error) {
                console.error('初始化八字信息失败:', error);
            }
        }
        
        // 页面加载完成后初始化所有功能
        document.addEventListener('DOMContentLoaded', function() {
            // 调用主初始化函数
            init();
            addBaZiInfoListeners();
            initBaZiInfo();
        });
        
        // 确保在所有初始化完成后再次添加事件监听器
        window.addEventListener('load', function() {
            addBaZiInfoListeners();
        });
    </script>
    <footer style="position: relative; bottom: 0; left: 0; width: 100%; text-align: center; padding: 10px; background-color: var(--background-color); border-top: 1px solid var(--border-color); margin-top: 2rem; z-index: 50;">
        <p data-translate="footerCopyright" style="margin: 0; color: var(--text-color); font-size: 0.9rem;">© 2024 命理感情查询工具</p>
        <p data-translate="footerDisclaimer" style="margin: 0; color: var(--light-text); font-size: 0.8rem;">本工具仅供参考，命运掌握在自己手中</p>
    </footer>
    </body>
</html>